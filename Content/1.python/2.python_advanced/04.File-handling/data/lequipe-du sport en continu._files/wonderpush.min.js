/**
 * Copyright 2018 WonderPush
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n=e[1]||"",o=e[3];if(!o)return n;if(t&&"function"==typeof btoa){var r=(a=o,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),i=o.sources.map(function(e){return"/*# sourceURL="+o.sourceRoot+e+" */"});return[n].concat(i).concat([r]).join("\n")}var a;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var o={},r=0;r<this.length;r++){var i=this[r][0];"number"==typeof i&&(o[i]=!0)}for(r=0;r<e.length;r++){var a=e[r];"number"==typeof a[0]&&o[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),t.push(a))}},t}},function(e,t,n){var o;void 0===(o=function(){return function(e){var t=function(){var e=JSON.parse(JSON.stringify(o));return delete e._mergeStoredOptions,delete e._mode,delete e._popup,delete e._hiddenFrame,delete e._syncInit,e},n="[options     ]",o=JSON.parse(JSON.stringify(e._protected.options||{})),r=t();Object.freeze(r),delete e._protected.options;var i=new e._protected.Promise.Deferred;return e._protected.Options=new function(){var a=!1,s={webKey:!0,_mode:!0,_hiddenFrame:!0,_popup:!0};function c(t,r){return a||t in s||e._protected.Helper.warn(n,new e._protected.Errors.InternalOptionsNotYetAvailableError("Option "+t+" read before options get filled")),t in o?o[t]:r}function p(e){delete o[e]}e.preInstantiationPromise.then(function(){e._protected.Storage.getModuleInitializationPromise().then(function(){return e._protected.Storage.isDefaultContainerAvailable()?e._protected.RunModes.Behaviors.ModeServiceWorker||!0===o._mergeStoredOptions?e._protected.Storage.get("options",{webKey:o.webKey}).then(function(n){e._protected.Helper.mergeObjectInplaceRecursive(n,o),!0===(o=n)._mergeStoredOptions&&(r=t(),Object.freeze(r))}):void 0:(a=!0,void i.resolve())}).then(function(){if(e._protected.RunModes.Behaviors.ModeFrame)return e._protected.Storage.set("options",r).then(function(){})}).then(function(){a=!0,e._protected.Helper._debugResolved(),i.resolve()})}),this.get=c,this.getModuleInitializationPromise=function(){return i.promise},this.exportCurrent=t,this.exportInitial=function(){return e._protected.Helper.plainObjectCopy(r)},this.merge=function(t,n){o=e._protected.Options._merge3Way(JSON.parse(JSON.stringify(t||{})),JSON.parse(JSON.stringify(o||{})),JSON.parse(JSON.stringify(n||{})))},this._merge3Way=function(t,n,r){var i=JSON.parse(JSON.stringify(t));return e._protected.Helper.mergeObjectInplaceRecursive(i,JSON.parse(JSON.stringify(o))),e._protected.Helper.mergeObjectInplaceRecursive(i,JSON.parse(JSON.stringify(r))),i},this.isDebug=function(){return!!c("debug",!1)},this.getFrameUrl=function(){return c("frameUrl",e._protected.Constants.FRAME_URL)},this.getServiceWorkerUrl=function(){return c("serviceWorkerUrl",e._protected.Constants.SERVICE_WORKER_URL)},this.getWebKey=function(){return c("webKey")},this.getTranslations=function(){return c("translations")||{}},this.getServiceWorkerScope=function(){return c("serviceWorkerScope")},this.getRedirectionPageUrl=function(t){var n=c("redirectionPageUrl",e._protected.Constants.REDIRECT_URL);return t&&(n=n.replace("${url}",encodeURIComponent(t))),n},this.get_mode=function(){return void 0===c("_mode")?e._protected.gscope.ServiceWorkerGlobalScope?e._protected.RunModes.Modes.ServiceWorker:e._protected.Options.get_hiddenFrame()?e._protected.RunModes.Modes.Frame:e._protected.Options.get_popup()?e._protected.RunModes.Modes.Popup:e._protected.RunModes.Modes.WebSite:c("_mode")},this.remove_mode=function(){return e._protected.Options.remove_hiddenFrame(),e._protected.Options.remove_popup(),p("_mode")},this.get_hiddenFrame=function(){return c("_hiddenFrame")},this.remove_hiddenFrame=function(){return p("_hiddenFrame")},this.get_popup=function(){return c("_popup")},this.remove_popup=function(){return p("_popup")},this.getLanguage=function(){return c("language")}},e._protected.RunModes.setCurrentMode(e._protected.Options.get_mode()),e._protected.Options.remove_mode(),i.promise}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){var e=WonderPushSDK._protected.Options._merge3Way;WonderPushSDK._protected.Options._merge3Way=function(t,n,o){var r=e(t,n,o);return r.plugins=WonderPushSDK._protected.Plugins.mergeOptionsPlugins(t.plugins||{},n.plugins||{},o.plugins||{}),r},WonderPushSDK._protected.Options.getStylesheetUrl=function(){return WonderPushSDK._protected.Options.get("stylesheetUrl")},WonderPushSDK._protected.Options.getCustomDomain=function(){return WonderPushSDK._protected.Options.get("customDomain")},WonderPushSDK._protected.Options.getServiceWorkerUrl=function(){var e=WonderPushSDK._protected.Options.get("serviceWorkerUrl",WonderPushSDK._protected.Constants.SERVICE_WORKER_URL);return e=e.replace("${webKey}",encodeURIComponent(WonderPushSDK._protected.Options.getWebKey()))},WonderPushSDK._protected.Options.getManifestUrl=function(){return WonderPushSDK._protected.Options.get("manifestUrl",WonderPushSDK._protected.Constants.MANIFEST_URL)},WonderPushSDK._protected.Options.getUserId=function(){return WonderPushSDK._protected.Options.get("userId",null)};WonderPushSDK._protected.Options.getApiUrlPrefix=function(){return"https://"+WonderPushSDK._protected.Options.get("_rootApiUrl",WonderPushSDK._protected.Constants.ROOT_API_URL)+"/"+WonderPushSDK._protected.Options.get("_apiVersion",WonderPushSDK._protected.Constants.API_VERSION)},WonderPushSDK._protected.Options.getApplicationVersion=function(){return WonderPushSDK._protected.Options.get("applicationVersion")},WonderPushSDK._protected.Options.getGeolocation=function(){return WonderPushSDK._protected.Options.get("geolocation","auto")},WonderPushSDK._protected.Options.getNotificationIcon=function(){return WonderPushSDK._protected.Options.get("notificationIcon")},WonderPushSDK._protected.Options.getDefaultNotificationUrl=function(){return WonderPushSDK._protected.Options.get("notificationDefaultUrl")},WonderPushSDK._protected.Options.getApplicationName=function(){return WonderPushSDK._protected.Options.get("applicationName",location.hostname)},WonderPushSDK._protected.Options.getOptInOptions=function(){return WonderPushSDK._protected.Options.get("optInOptions",{})},WonderPushSDK._protected.Options.getPlugins=function(){return WonderPushSDK._protected.Options.get("plugins")},WonderPushSDK._protected.Options.getSubscriptionOptions=function(){return WonderPushSDK._protected.Options.get("subscriptionOptions",{})}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){var e,t=!1,n=WonderPushSDK.prototype.SessionState.INIT_UNSTARTED,o=new Promise(function(e,t){var n=function(t){"session"===(t.detail||{}).name&&t.detail.state===WonderPushSDK.this.SessionState.INIT_SUCCESS&&(e(),WonderPushSDK._protected.Events.unlisten(n))};WonderPushSDK._protected.Events.listen(n)}),r=function(){if(!WonderPushSDK._protected.Init.isInitialized()){var e=function(){t=!0,i(WonderPushSDK.this.SessionState.INIT_SUCCESS),WonderPushSDK._protected.RunModes.Behaviors.CoreProperties&&WonderPushSDK._protected.Installation.updateInstallationCoreProperties()},n=function(){i(WonderPushSDK.this.SessionState.INIT_FAILED)};WonderPushSDK._protected.RunModes.Behaviors.AccessToken||WonderPushSDK._protected.Blocker.category("accessToken").add("mode"),WonderPushSDK._protected.Blocker.category("accessToken").add("initNeedsConfig"),WonderPushSDK._protected.Config.getModuleInitializationPromise().then(function(){WonderPushSDK._protected.RunModes.Behaviors.AccessToken&&(i(WonderPushSDK.this.SessionState.INIT_INPROGRESS),WonderPushSDK.instantiationPromise.then(function(){WonderPushSDK._protected.Init.fetchAccessTokenIfNeeded(WonderPushSDK._protected.Options.getUserId(),e,n)})),WonderPushSDK._protected.Blocker.category("accessToken").remove("initNeedsConfig")})}WonderPushSDK._protected.Blocker.category("ready").remove("init")};WonderPushSDK._protected.Init.isInitialized=function(){return t},WonderPushSDK._protected.Init.getSessionState=function(){return n};var i=function(t){e!==(n=t)&&(e=n,WonderPushSDK._protected.Events.fire(WonderPushSDK._protected.Events.WonderPushSessionEvent(WonderPushSDK._protected.Init.getSessionState())),WonderPushSDK._protected.RunModes.Behaviors.ModeFrame&&WonderPushSDK._protected.Init.setSessionStateOnParentWindow(t),t===WonderPushSDK.prototype.SessionState.INIT_SUCCESS&&(WonderPushSDK._protected.RunModes.Behaviors.ModeFrame&&WonderPushSDK._protected.Helper.supportsServiceWorker()&&WonderPushSDK._protected.Init.setSessionStateOnServiceWorker(t),WonderPushSDK._protected.RunModes.Behaviors.ModeServiceWorker&&WonderPushSDK._protected.Init.setSessionStateOnServiceWorkerClients(t)))};WonderPushSDK._protected.Init.setSessionStateOnParentWindow=WonderPushSDK._protected.Integration.proxifyToParentWindow("WonderPushSDK._protected.Init.setSessionStateOnParentWindow",function(e){i(e)}),WonderPushSDK._protected.Init.setSessionStateOnServiceWorker=WonderPushSDK._protected.Integration.proxifyToServiceWorker("WonderPushSDK._protected.Init.setSessionStateOnServiceWorker",function(e){i(e)}),WonderPushSDK._protected.Init.setSessionStateOnServiceWorkerClients=WonderPushSDK._protected.Integration.proxifyToServiceWorkerClients("WonderPushSDK._protected.Init.setSessionStateOnServiceWorkerClients",function(e){i(e)}),WonderPushSDK.prototype.getInitializationPromise=function(){return o},WonderPushSDK._protected.Init.getDeviceId=function(){return WonderPushSDK._protected.Storage.get("deviceId",null).then(function(e){if(e)return e;var t=WonderPushSDK._protected.Helper.uuidv4()+"-"+(+new Date).toString(16);return WonderPushSDK._protected.Storage.set("deviceId",t).then(function(){return t})})},WonderPushSDK._protected.Init.getFederatedDeviceId=function(){return WonderPushSDK._protected.Storage.get("federatedDeviceId",null).then(function(e){return e||(WonderPushSDK._protected.RunModes.Behaviors.ContextWindow?new Promise(function(e){if(WonderPushSDK._protected.Integration.isOnFederatedDomain()){var t=WonderPushSDK._protected.Helper.uuidv4()+"-"+(+new Date).toString(16);e(t)}else e(WonderPushSDK._protected.Federated.call("WonderPushSDK._protected.Init.getFederatedDeviceId",[]))}).then(function(e){return WonderPushSDK._protected.Storage.set("federatedDeviceId",e)._wp_catchNoop().then(function(){return e})}):null)})},WonderPushSDK._protected.Blocker.category("accessToken").wait().then(function(){WonderPushSDK._protected.Init.fetchAccessTokenIfNeeded(WonderPushSDK._protected.Options.getUserId())});var a={},s=function(e,t,n,o){for(var r=0;r<e.length;++r)e[r][t].call(n,o);e.splice(0)};WonderPushSDK._protected.Init.fetchAccessTokenIfNeeded=function(e,t,n){if(WonderPushSDK._protected.RunModes.Behaviors.AccessToken){var o=function(){};"function"!=typeof t&&(t=o),"function"!=typeof n&&(n=o),a[e]||(a[e]=[]),a[e].push({onload:t,onerror:n}),WonderPushSDK._protected.Blocker.category("accessToken").unblocked()&&(t=function(){s(a[e],"onload",this)},n=function(){s(a[e],"onerror",this)},WonderPushSDK._protected.Session.getSession(e).then(function(o){if(o&&o.accessToken&&o.installationId)setTimeout(t,0);else{var r=new WonderPushSDK._protected.Locking.ExpiringUnfairNamedGlobalMutex("fetchAccessToken:userId="+(e||""),3e4);r.tryAcquire().then(function(){var o=new WonderPushSDK._protected.Promise.Deferred;r.renewWhile({interval:15e3,release:!0},o.promise),o.promise._wp_catchNoop(),function(e,t){WonderPushSDK._protected.RunModes.Behaviors.AccessToken?WonderPushSDK._protected.Init.getDeviceId().then(function(n){var o={clientId:WonderPushSDK._protected.Options.getWebKey(),devicePlatform:"Web",deviceId:n,userId:e};o.userId||delete o.userId,WonderPushSDK._protected.Rest.post(e,"/authentication/accessToken",o,void 0,t)},function(e){console.warn("Failed to read deviceId",e),t.onerror&&t.onerror.call(null,e)}):console.error("fetchAccessToken should not be called from this mode")}(e,{onload:function(e){(function(e){var n=function(e){var n=(e=e||{}).token||null,o=(e.data||{}).sid||null,i=(e.data||{}).installationId||null,a=(e.data||{}).userId||null;return n&&i?r.renew().then(function(){var r=[];return e._installation instanceof Object&&r.push(WonderPushSDK._protected.JsonSyncInstallationCustom.receiveStateForUser(a,e._installation.custom||{},!1)),r.push(WonderPushSDK._protected.Session.setSession({accessToken:n,sid:o,installationId:i,userId:a})),Promise.all(r).then(function(){setTimeout(function(){t()},0)})},function(){return Promise.reject()}):Promise.reject("invalid access token")};return"function"==typeof Response&&e instanceof Response?e.json().then(n):n(this.responseJSON)}).call(this,e)._wp_do(o.resolve).catch(function(e){n.call(this,e)})},onerror:function(e){o.reject(e),n.call(this,e)}})},function(){setTimeout(function(){WonderPushSDK._protected.Init.fetchAccessTokenIfNeeded(e,null,null)},2e3)})}}))}else console.error("fetchAccessToken should not be called from this mode")},WonderPushSDK._protected.Blocker.category("ready").add("init"),setTimeout(function(){WonderPushSDK.preInstantiationPromise.then(r)},0)}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o,r;o=[n(6),n(39),n(23),n(24),n(25),n(26),n(27),n(28),n(2),n(29),n(30),n(34),n(35),n(36),n(37),n(3),n(38),n(5),n(40),n(41),n(42),n(44),n(45),n(46),n(47),n(48),n(49),n(50),n(51),n(52),n(53),n(54),n(55),n(61)],void 0===(r=function(e,t,n,o,r,i,a,s,c,p,u,d,l,f,h,g,_,m,v,S,y,E,I,w,b,P,C,O,T,R,A,N,k,D){var x=Array.prototype.slice.call(arguments).slice(1);!function(t){"use strict";if(!t.WonderPush||"WonderPush"!==t.WonderPush.constructor.name){var n=!0,o=void 0,r=[];t.WonderPush?(o=t.WonderPush.initOpts,r=t.WonderPush.q,n=(o||{})._syncInit||!!t.ServiceWorkerGlobalScope):t.WonderPush={init:function(e){o=e},ready:function(e){r.push(e)}},n?i():setTimeout(i,0)}function i(){var n=e(t,"WonderPush",x);if(o)n.init(o);else{var i=function(e){var t={};if(e){"?"===e.charAt(0)&&(e=e.substring(1));for(var n=e.split("&"),o=0;o<n.length;++o){var r=n[o].split("=");r.length>2&&r.push(r.splice(1).join("=")),r[0]=decodeURIComponent(r[0]),r.length<2?r.push(null):r[1]=decodeURIComponent(r[1]),t[r[0]]=r[1]}}return t}(location.search),a=i.wonderpushWebKey,s=i.wonderpushUserId,c=i.wonderpushInitOpts;(a||c)&&(c=c?JSON.parse(c):{},a&&(c.webKey=a),void 0!==s&&(c.userId=s),c._mergeStoredOptions=!0,WonderPush.init(c))}n.ready(function(e){for(var t=0;t<r.length;++t)setTimeout(r[t].bind(null,e),1)})}}(self)}.apply(t,o))||(e.exports=r)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){var e=function(e,t,n){return t=t||{},(n?Promise.resolve(n):WonderPushSDK._protected.Session.getSession(e)).then(function(e){var n=e.lang||WonderPushSDK._protected.gscope.navigator.language;return t.lang=WonderPushSDK._protected.Helper.inArray(n,WonderPushSDK._protected.Constants.VALID_LANGUAGE_CODES)?n:WonderPushSDK._protected.Constants.DEFAULT_LANGUAGE_CODE,e.accessToken&&(t.accessToken=e.accessToken),e.userId&&(t.userId=e.userId),t})},t=function(e){return e&&e.length>0&&"/"!==e.charAt(0)&&(e="/"+e),WonderPushSDK._protected.Options.getApiUrlPrefix()+e},n=function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")};WonderPushSDK.prototype.Rest=new function(){this.get=function(e,t,n,o){return WonderPushSDK._protected.Rest.get(WonderPushSDK._protected.Options.getUserId(),e,t,n,o)},this.post=function(e,t,n,o,r){return WonderPushSDK._protected.Rest.post(WonderPushSDK._protected.Options.getUserId(),e,t,n,o,r)},this.postEventually=function(e,t,n){return WonderPushSDK._protected.Rest.postEventually(WonderPushSDK._protected.Options.getUserId(),e,t,n)},this.postBeacon=function(o,r,i){return WonderPushSDK.prototype.getInitializationPromise().then(function(){return e(WonderPushSDK._protected.Options.getUserId(),r,i).then(function(e){var r=t(o),i=n(e);return navigator.sendBeacon(r,new Blob([i],{type:"application/x-www-form-urlencoded"}))})})},this.delete=function(e,t,n,o){return WonderPushSDK._protected.Rest.delete(WonderPushSDK._protected.Options.getUserId(),e,t,n,o)},this.fetch=function(e,t,n,o){return"GET"===e?this.get(t,n,void 0,{fetch:!0}):"POST"===e?this.post(t,n,o,void 0,{fetch:!0}):"PUT"===e?this.put(t,n,o,void 0,{fetch:!0}):"PATCH"===e?this.patch(t,n,o,void 0,{fetch:!0}):"DELETE"===e?this.delete(t,n,void 0,{fetch:!0}):Promise.reject("Unsupported method "+e+" for fetch")},this.put=function(e,t,n,o,r){return WonderPushSDK._protected.Rest.put(WonderPushSDK._protected.Options.getUserId(),e,t,o,r)},this.patch=function(e,t,n,o,r){return WonderPushSDK._protected.Rest.patch(WonderPushSDK._protected.Options.getUserId(),e,t,o,r)}},WonderPushSDK._protected.Rest=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Rest",new function(){this.destroy=function(){},this.get=function(o,r,i,a,s){return e(o,i).then(function(e){var o=t(r),i=n(e);i&&(o=o+"?"+i);return WonderPushSDK._protected.Request.request("GET",o,"",void 0,{},a,s)})},this.post=function(o,r,i,a,s,c){return e(o,i).then(function(e){var o=t(r),i=n(e);return WonderPushSDK._protected.Request.request("POST",o,i,a,{"Content-type":"application/x-www-form-urlencoded"},s,c)})},this.postEventually=function(o,r,i,a){WonderPushSDK.prototype.getInitializationPromise().then(function(){return e(o,i).then(function(e){var o=t(r),i=n(e);WonderPushSDK._protected.Request.requestEventually("POST",o,i,a,{"Content-type":"application/x-www-form-urlencoded"})})})},this.delete=function(o,r,i,a,s){return e(o,i).then(function(e){var o=t(r),i=n(e);i&&(o=o+"?"+i);return WonderPushSDK._protected.Request.request("DELETE",o,"",void 0,{},a,s)})},this.fetch=function(e,t,n,o,r){return"GET"===t?this.get(e,n,o,void 0,{fetch:!0}):"POST"===t?this.post(e,n,o,r,void 0,{fetch:!0}):"PUT"===t?this.put(e,n,o,r,void 0,{fetch:!0}):"PATCH"===t?this.patch(e,n,o,r,void 0,{fetch:!0}):"DELETE"===t?this.delete(e,n,o,void 0,{fetch:!0}):Promise.reject("Unsupported method "+t+" for fetch")},this.fetchJson=function(e,t,n,o,r){return this.fetch(e,t,n,o,r).then(function(e){return e.json()})},this.put=function(o,r,i,a,s,c){return e(o,i).then(function(e){var o=t(r),i=n(e);return WonderPushSDK._protected.Request.request("PUT",o,i,a,{"Content-type":"application/x-www-form-urlencoded"},s,c)})},this.patch=function(o,r,i,a,s,c){return e(o,i).then(function(e){var o=t(r),i=n(e);return WonderPushSDK._protected.Request.request("PATCH",o,i,a,{"Content-type":"application/x-www-form-urlencoded"},s,c)})}})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o,r;o=[n(8),n(16),n(9),n(10),n(11),n(1),n(12),n(13),n(14),n(15),n(7),n(17),n(18),n(19),n(20),n(21),n(22)],void 0===(r=function(e,t,n,o,r,i,a,s,c,p,u,d,l,f,h,g,_){"use strict";return function(e,m,v,S={}){return new function(){var y=this,E=null,I=[],w=function(e){setTimeout(function(){e(E)},1)};e[m]=this,this.ready=function(e){I.push(e)};var b=new function(){var t=this;function n(){t.this=this}this._protected={gscope:e,sdkName:m},this.constructor=n,this.prototype=n.prototype,this.this=null};t(b);var P=new b._protected.Promise.Deferred;b.preInstantiationPromise=P.promise;var C=new b._protected.Promise.Deferred;b.instantiationPromise=C.promise;var O,T=[];b.readyCallback=function(){A(O)},this.init=function(t){this.init=R,b._protected.options=t,T.push(n(b)),T.push(o(b)),T.push(r(b)),T.push(u(b)),T.push(a(b,S.additionalRunModes)),T.push(i(b)),T.push(p(b)),T.push(s(b)),T.push(c(b)),T.push(f(b)),T.push(h(b)),T.push(d(b)),T.push(l(b)),T.push(g(b)),T.push(_(b)),v.forEach(function(e){"function"==typeof e&&T.push(e(b))}),O=new b.constructor,P.resolve(),Promise.all(T).then(function(){return C.resolve(),b},function(e){return console.error("SDK instantiation failed!",e),C.reject(e),b}).then(function(){b._protected.Options.isDebug()&&(e[m+"SDK"]=b)})};var R=function(){},A=function(e){E=e,y.ready=w,I.forEach(function(e){w(e)}),I=[]};(function(){var e=this.init.bind(this),t=this.ready.bind(this);if("undefined"!=typeof window){var n,o=m.toLowerCase();if(n=document.querySelector('HEAD>META[name="'+o+'-integration"]')){var r=(n.content||n.getAttribute("content")).trim().split(/\s*,\s*/);if(!(r.indexOf("frame")<0&&r.indexOf("popup")<0)){var i=!1;window.addEventListener("message",function(n){if(n.data instanceof Object&&n.data.sdk===m)switch(n.data.type){case"ping":n.ports&&n.ports.length>0&&n.ports[0].postMessage({type:"pong"});break;case"isReady":n.ports&&n.ports.length>0&&n.ports[0].postMessage({type:"readiness",ready:i});break;case"init":e(n.data.initOpts),t(function(){i=!0,n.ports&&n.ports.length>0&&n.ports[0].postMessage({type:"ready"})});break;case"display":for(var o=["text-content","main-content","whole-content"],r=0;r<o.length;++r){var a=o[r];a in n.data&&(document.getElementById(a).innerHTML=n.data[a])}break;case"close":setTimeout(function(){window.close()},n.data.sleep||0)}})}}}}).bind(this)()}}}.apply(t,o))||(e.exports=r)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Helper={browserAndOSCSSClasses:function(){var e=[],t=navigator.userAgent.toLowerCase();return t.indexOf("iphone")>-1&&e.push("iphone"),t.indexOf("ipad")>-1&&e.push("ipad"),t.indexOf("ipod")>-1&&e.push("ipod"),t.indexOf("android")>-1&&e.push("android"),t.indexOf("macintosh")>-1&&e.push("macintosh"),t.indexOf("windows")>-1&&e.push("windows"),t.indexOf("linux")>-1&&e.push("linux"),t.indexOf("chrome")>-1&&e.push("chrome"),t.indexOf("firefox")>-1&&e.push("firefox"),t.indexOf("safari")>-1&&-1===t.indexOf("chrome")&&e.push("safari"),e},inArray:function(e,t){for(var n=0;n<t.length;++n)if(t[n]===e)return!0;return!1},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},uuidv4:function(){var t,n=new Array(31);if(e._protected.gscope.crypto&&crypto.getRandomValues){var o=new Uint8Array(31);for(crypto.getRandomValues(o),t=0;t<31;t++)n[t]=15&o[t]}else for(t=0;t<31;t++)n[t]=16*Math.random()|0;var r=0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=n[r++];return("x"===e?t:3&t|8).toString(16)})},stripObject:function(t){for(var n in t){var o=t[n];if(void 0===o||null===o)delete t[n];else if(o instanceof Object){e._protected.Helper.stripObject(o);var r=!0;for(var i in o){r=!1;break}r&&delete t[n]}}return t},messagePassableValue:function(t){var n=t;return t instanceof Blob||(n=e._protected.Helper.plainObjectCopy(t)),n},plainObjectCopy:function(t){var n=t;if(t instanceof Array){n=[];for(var o=0;o<t.length;++o){var r=t[o];r instanceof Function||n.push(e._protected.Helper.plainObjectCopy(r))}}else if(t instanceof Object){if("undefined"!=typeof PushSubscriptionOptions&&t instanceof PushSubscriptionOptions){for(var i in n={},t)n[i]=e._protected.Helper.plainObjectCopy(t[i]);return n}if(t.toJSON instanceof Function){var a=t.toJSON();return a!==t&&(a=e._protected.Helper.plainObjectCopy(a)),t instanceof PushSubscription&&(a.keys instanceof Object&&("string"==typeof a.keys.auth&&(a.keys.auth=a.keys.auth.replace(/=+$/,"")),"string"==typeof a.keys.p256dh&&(a.keys.p256dh=a.keys.p256dh.replace(/=+$/,""))),t.options instanceof Object&&(a.options=e._protected.Helper.plainObjectCopy(t.options))),a}if(t instanceof Error)return n=e._protected.Helper.assign({},t),["name","message","stack","columnNumber","fileName","lineNumber"].forEach(function(e){void 0!==t[e]&&(n[e]=t[e])}),n;if(t instanceof ArrayBuffer)return e._protected.Helper.arrayBufferToBase64UrlSafe(t);n={},Object.getOwnPropertyNames(t).forEach(function(o){var r=t[o];r instanceof Function||(n[o]=e._protected.Helper.plainObjectCopy(r))})}return n},assign:function(e,t){"use strict";if(Object.assign)return Object.assign.apply(null,arguments);if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),o=1;o<arguments.length;o++){var r=arguments[o];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])}return n},mergeObjectInplaceRecursive:function(t,n){for(var o in n)if(n.hasOwnProperty(o)){var r=t[o],i=n[o];r instanceof Object&&i instanceof Object?e._protected.Helper.mergeObjectInplaceRecursive(r,i):t[o]=i}return t},rawurlencode:function(e){return e=(e+"").toString(),encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")},decodeQueryString:function(e){var t={};if(e){"?"===e.charAt(0)&&(e=e.substring(1));for(var n=e.split("&"),o=0;o<n.length;++o){var r=n[o].split("=");r.length>2&&r.push(r.splice(1).join("=")),r[0]=decodeURIComponent(r[0]),r.length<2?r.push(null):r[1]=decodeURIComponent(r[1]),t[r[0]]=r[1]}}return t},escapeRegExp:function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},fireEvent:function(e,t,n){var o;if("function"==typeof CustomEvent)return o=new CustomEvent(t,{detail:n,bubbles:!0,cancelable:!0}),!e.dispatchEvent(o);if("function"==typeof Event)return(o=new Event(t,{bubbles:!0,cancelable:!0})).detail=n,!e.dispatchEvent(o);if("object"==typeof document&&document.createEventObject)return(o=document.createEventObject()).data=n,e.fireEvent("on"+t,o);throw Error("Cannot instantiate Event for "+t)},listenEvent:function(e,t,n){e.addEventListener(t,n,!1)},unlistenEvent:function(e,t,n){e.removeEventListener(t,n,!1)},supportsServiceWorker:function(){return navigator.serviceWorker&&"function"==typeof navigator.serviceWorker.register},supportsPushManager:function(){return"undefined"!=typeof PushManager},getLocales:function(){var t=[];return e._protected.gscope.document&&(t.push(document.documentElement.getAttribute("lang")),t=(t=t.concat(Array.prototype.slice.call(document.querySelectorAll("HEAD > meta[name=language], HEAD > meta[http-equiv=content-language], HEAD > meta[http-equiv=Content-Language]")).map(function(e){return e.content}))).reduce(function(e,t){return t?e.concat(t.split(",")):e},[])),t.push(navigator.language),t.concat(navigator.languages).map(e._protected.Helper.normalizeLocale).filter(function(e){return!!e}).filter(function(e,t,n){return n.indexOf(e)===t})},normalizeLocale:function(e){if("string"!=typeof e)return null;var t=e.trim().toLowerCase().match(/^([a-z][a-z])(?:[-_]([a-z][a-z]))?$/);return t?t[2]?t[1]+"_"+t[2].toUpperCase():t[1]:null},parseNumber:function(e,t){var n;t=t||navigator.language;try{n=Intl.NumberFormat(t).format("1.1")}catch(e){n=Intl.NumberFormat(navigator.language).format("1.1")}var o=new RegExp("[^-+0-9"+n.charAt(1)+"]","g"),r=e.replace(o,"").replace(n.charAt(1),".");return parseFloat(r)},tryParse:function(e,t){try{return JSON.parse(e)}catch(e){}return t},detectBrowser:function(){var e,t,n,o=navigator.userAgent.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];!e&&/trident/i.test(o[1])&&(e="Internet Explorer",t=(n=/\brv[ :]+([\d\.]+)/g.exec(navigator.userAgent)||[])[1]),!e&&/msie/i.test(o[1])&&(e="Internet Explorer",t=o[2]),!e&&/chrome/i.test(o[1])&&(n=navigator.userAgent.match(/\b(OPR|Edge)\/([\d\.]+)/)||[]).length>0&&(e=n[1],t=n[2]),!e&&o[1]&&(e=o[1],t=o[2]),"OPR"===e&&(e="Opera"),null!==(n=navigator.userAgent.match(/version\/([\d\.]+)/i))&&(t=n[1]);var r=navigator.userAgent.match(/(Linux|iPad|iPhone|Android|Windows|Macintosh)/g)||[],i=null;return-1!==r.indexOf("Android")?i="Android":r.length>0&&(i=r[0]),{name:e,platform:i,version:t}},arrayBufferFromBase64:function(e){return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})},arrayBufferFromBase64UrlSafe:function(t){return e._protected.Helper.arrayBufferFromBase64(t.replace(/-/g,"+").replace(/_/g,"/"))},arrayBufferToBase64:function(e){return btoa(String.fromCharCode.apply(null,new Uint8Array(e)))},arrayBufferToBase64UrlSafe:function(t){return e._protected.Helper.arrayBufferToBase64(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")},compareVersions:function(e,t){var n=function(e){return parseInt(e,10)};e=e.split(".").map(n),t=t.split(".").map(n);for(var o=0;o<Math.max(e.length,t.length);++o){if(o>=e.length)return-1;if(o>=t.length)return 1;if(e[o]<t[o])return-1;if(e[o]>t[o])return 1}return 0},_:void 0};var t={},n=[],o=0,r=function(){},i=function(t){++o;try{var r=new Date,i=console[t];console[t]instanceof Function||(i=console.log);var a=[];return o>1?a.unshift("[REENTRANT]"):a.unshift(e._protected.Helper._log_runMode),a.unshift("["+e._protected.sdkName+"]"),a.unshift("["+r.toLocaleTimeString("en-GB")+"."+("00"+r.getMilliseconds()).slice(-3)+"]"),!Object({debug:!1})["debug-unresolved"]||"trace"!==t&&"debug"!==t?Function.prototype.bind.apply(i,[console].concat(a)):function(){n.push([i,a.concat(Array.prototype.slice.call(arguments))])}}catch(e){return console.log}finally{--o}};Object.defineProperties(e._protected.Helper,{trace:{get:function(){return r}},debug:{get:function(){return r}},_debugResolved:{value:function(){Object({debug:!1})["debug-unresolved"]||(n=void 0)}},log:{get:function(){return i("log")}},info:{get:function(){return i("info")}},warn:{get:function(){return i("warn")}},error:{get:function(){return i("error")}},debugCollapsed:{value:function(n){var o=Array.prototype.slice.call(arguments);o.shift();var r=JSON.stringify(o);n in t&&t[n]===r||(t[n]=r,e._protected.Helper.debug.apply(e._protected.Helper,o))}},_log_runMode:{value:"???????",writable:!0}})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){var e;Function.prototype.bind||(Function.prototype.bind=function(e){var t=Array.prototype.slice.call(arguments,1),n=this,o=function(){},r=function(){return n.apply(this instanceof o?this:e,t.concat(Array.prototype.slice.call(arguments)))};return o.prototype=this.prototype,r.prototype=new o,r}),Object.freeze||(Object.freeze=function(e){return e}),"function"!=typeof Object.create&&(Object.create=(e=function(){},function(t){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof t)throw TypeError("Argument must be an object");e.prototype=t;var n=new e;return e.prototype=null,n}))}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Blocker={};var t={};e._protected.Blocker.clearAllCategories=function(){t={}},e._protected.Blocker.category=function(n){var o=t[n]||new function(t){this.name=t;var n={},o=[],r=function(){o.forEach(function(e){e.resolve()}),o=[]};this.add=function(e){n[e]=!0},this.remove=function(e){delete n[e],this.unblocked()&&r()},this.wait=function(){var t=new e._protected.Promise.Deferred;return o.push(t),this.unblocked()&&r(),t.promise},this.unblocked=function(){for(var e in n)if(n.hasOwnProperty(e))return!1;return!0}}(n);return t[n]=o,o}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e.prototype.Errors=new function(){this.Error=function(t){var n=e._protected.Helper.plainObjectCopy(new Error(t));delete n.name,e._protected.Helper.assign(this,n)},this.Error.prototype=Object.create(Error.prototype,{name:{value:e._protected.sdkName+"SDK.Errors.Error"},constructor:{value:this.Error}}),this.InternalError=function(t){e.prototype.Errors.Error.apply(this,arguments)},this.InternalError.prototype=Object.create(this.Error.prototype,{name:{value:e._protected.sdkName+"SDK.Errors.InternalError"},constructor:{value:this.InternalError}}),this.InvalidArgumentError=function(t){e.prototype.Errors.Error.apply(this,arguments)},this.InvalidArgumentError.prototype=Object.create(this.Error.prototype,{name:{value:e._protected.sdkName+"SDK.Errors.InvalidArgumentError"},constructor:{value:this.InvalidArgumentError}}),this.TimeoutError=function(t){e.prototype.Errors.Error.apply(this,arguments)},this.TimeoutError.prototype=Object.create(this.Error.prototype,{name:{value:"SDK.Errors.TimeoutError"},constructor:{value:this.TimeoutError}}),this.CancellationError=function(t){e.prototype.Errors.Error.apply(this,arguments)},this.CancellationError.prototype=Object.create(this.Error.prototype,{name:{value:"SDK.Errors.CancellationError"},constructor:{value:this.CancellationError}})},e._protected.Errors=new function(){this.InternalOptionsNotYetAvailableError=function(t){e.prototype.Errors.InternalError.apply(this,arguments)},this.InternalOptionsNotYetAvailableError.prototype=Object.create(e.prototype.Errors.InternalError.prototype,{name:{value:e._protected.sdkName+"SDK.Errors.InternalOptionsNotYetAvailableError"},constructor:{value:this.InternalOptionsNotYetAvailableError}}),this.InternalStorageError=function(t){e.prototype.Errors.InternalError.apply(this,arguments)},this.InternalStorageError.prototype=Object.create(e.prototype.Errors.InternalError.prototype,{name:{value:e._protected.sdkName+"SDK.Errors.InternalStorageError"},constructor:{value:this.InternalStorageError}}),this.InternalRPCTargetClosedError=function(t){e.prototype.Errors.InternalError.apply(this,arguments)},this.InternalRPCTargetClosedError.prototype=Object.create(e.prototype.Errors.InternalError.prototype,{name:{value:e._protected.sdkName+"SDK.Errors.InternalRPCTargetClosedError"},constructor:{value:this.InternalRPCTargetClosedError}})}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Constants={},e._protected.Constants.HOME_URL="https://example.com/",e._protected.Constants.CONFIG_URL_PATTERN="https://cdn.example.com/config/webkeys/${webkey}",e._protected.Constants.CONFIG_FETCH_MAX_TRIES=5,e._protected.Constants.SERVICE_WORKER_URL="serviceworker.js",e._protected.Constants.FRAME_URL="index.html",e._protected.Constants.REDIRECT_URL="redirect.html?url=${url}",e._protected.Constants.INTEGRATION_POPUP_DEFAULT_OPTIONS={resizable:0,toolbar:0,location:0,menubar:0,status:0,directories:0,personalbar:0,dependent:"yes",scrollbars:0,center:"window"},e._protected.Constants.WINDOW_LOAD_MAX_PAGELOAD_MS=6e4,e._protected.Constants.WINDOW_LOAD_SLOW_WARN_MS=1e4,e._protected.Constants.WINDOW_LOAD_CHECK_PAGELOADED_INTERVAL_MS_MIN=100,e._protected.Constants.WINDOW_LOAD_CHECK_PAGELOADED_INTERVAL_MS_MAX=1e3,e._protected.Constants.WINDOW_LOAD_CHECK_PAGELOADED_INTERVAL_MS_EXP=1.5,e._protected.Constants.REQUEST_TIMEOUT_MS=2e4,e._protected.Constants.REQUEST_VAULT_ERROR_WAIT_MS=2e4,e._protected.Constants.REQUEST_VAULT_RUNNING_JOB_TIMEOUT_MS=Math.round(1.1*e._protected.Constants.REQUEST_TIMEOUT_MS)+1e3,e._protected.Constants.REQUEST_VAULT_IDLE_WAIT_MS=2e4,e._protected.Constants.INTEGRATION_RPC_CHECK_TARGET_CLOSED_INTERVAL_MS=250,e._protected.Constants.AVAILABLE_LANGUAGES=["en"],e._protected.Constants.I18N_TRANSLATIONS={en:{}},e._protected.Constants.GOOGLE_ANALYTICS_USER_DATA_STORAGE_KEY="analyticsStorageKey",e._protected.Constants.GOOGLE_ANALYTICS_STORAGE_DATABASE_NAME=e._protected.sdkName+"_analytics",e.preInstantiationPromise.then(function(){e._protected.Helper.assign(e._protected.Constants,e.prototype.Constants),Object.freeze(e.prototype.Constants),Object.freeze(e._protected.Constants)})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e,t=[]){var n="[runmodes    ]";e._protected.RunModes=new function(){var t,o;this.Modes={},this.ModeParents={},this.ModeLogTags={},this.Behaviors={},this.BehaviorResolvers={},this.knownMode=function(e){return!!e&&Object.keys(this.Modes).some(function(t){return this.Modes.hasOwnProperty(t)&&this.Modes[t]===e}.bind(this))}.bind(this),this.registerMode=function(t,n,o,r){if(!t)throw new e.prototype.Errors.InternalError("Bad mode const name");if(!n)throw new e.prototype.Errors.InternalError("Bad mode value");if(t in this.Modes||this.knownMode(n))throw new e.prototype.Errors.InternalError("Mode already registered");this.Modes[t]=n,this.ModeLogTags[n]=o,this.knownMode(r)&&(this.ModeParents[n]=r),this.registerBehavior("Mode"+t,function(e){return e===n})}.bind(this),this.registerBehavior=function(t,n){if(!t)throw new e.prototype.Errors.InternalError("Bad behavior name");if(!(n instanceof Function))throw new e.prototype.Errors.InternalError("Bad behavior resolver");if(t in this.Behaviors)throw new e.prototype.Errors.InternalError("Behavior already registered");Object.defineProperty(this.Behaviors,t,{enumerable:!0,get:function(){return this.hasBehavior(t)}.bind(this)}),this.BehaviorResolvers[t]=n}.bind(this),this.setCurrentMode=function(n){if(void 0!==t)throw new e.prototype.Errors.InternalError("Current mode is already set");t=n,o={},e._protected.Helper._log_runMode=this.ModeLogTags[n]}.bind(this),this.getCurrentModeNotForBehaviorTestingPurpose=function(){return t}.bind(this),this.hasBehavior=function(r){if(!(r in o)){for(var i,a=t;void 0!==a&&void 0===i;){try{i=this.BehaviorResolvers[r](a)}catch(o){e._protected.Helper.error(n,"mode:",t,"behavior:",r,"error while resolving value using resolver",this.BehaviorResolvers[r],o)}a=this.ModeParents[a]}void 0===i&&e._protected.Helper.error(n,"mode:",t,"behavior:",r,"resolved value is undefined"),o[r]=i}return o[r]}.bind(this)},e._protected.RunModes.registerMode("WebSite","website","[website]"),e._protected.RunModes.registerMode("Frame","frame","[frame  ]"),e._protected.RunModes.registerMode("ServiceWorker","serviceworker","[sw     ]"),e._protected.RunModes.registerMode("Popup","popup","[popup  ]"),e._protected.RunModes.registerMode("Slave","slave","[slave  ]");for(const n of t)e._protected.RunModes.registerMode(`${n.charAt(0).toUpperCase()}${n.slice(1)}`,n,`[${n}]`);e._protected.RunModes.registerBehavior("ContextWindow",function(){return!!e._protected.gscope.window}),e._protected.RunModes.registerBehavior("ContextServiceWorker",function(){return!!e._protected.gscope.ServiceWorkerGlobalScope}),e._protected.RunModes.registerBehavior("ContextFrame",function(t){return[e._protected.RunModes.Modes.Frame,e._protected.RunModes.Modes.Slave].indexOf(t)>=0}),e._protected.RunModes.registerBehavior("Visible",function(){return e._protected.RunModes.Behaviors.ContextWindow&&!e._protected.RunModes.Behaviors.ContextFrame}),e._protected.RunModes.registerBehavior("AccessToken",function(t){return[e._protected.RunModes.Modes.ServiceWorker,e._protected.RunModes.Modes.Frame].indexOf(t)>=0})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o,r;o=[n(1)],void 0===(r=function(e){return Object({debug:!1}),function(e){var t,n="[storage     ]",o=new e._protected.Promise.Deferred,r=function(t){var o,r,i;t&&t.then?i=t.then(function(e){return o=(r=e)&&r.name,this}.bind(this)):o=t;var a=function(t){e._protected.Helper.warn(t),r&&(r.close(),r=void 0,i=void 0)}.bind(this);this.ready=function(){return i||(i=function(t,o){var r=new e._protected.Promise.Deferred,i=e._protected.gscope.indexedDB.open(t,o),a=!1;return i.onupgradeneeded=function(t){a=!0;var r=t.target.result;if(t.newVersion!==o)throw new e._protected.Errors.InternalStorageError("Updating from version "+t.oldVersion+" to version "+t.newVersion+", but dbVersion in code is "+o);var i=t.oldVersion,s=[];s.push(function(){0===i&&(++i,r.createObjectStore("kv-storage"),r.createObjectStore("mutex")),this.onsuccess()}),s.push(function(){if(i!==o){var r="IndexedDB upgrade chain from version "+t.oldVersion+" to version "+t.newVersion+" broken at version "+i;throw e._protected.Helper.error(n,r),new e._protected.Errors.InternalStorageError(r)}a=!1});for(var c=s.length-2;c>=0;--c){var p=s[c],u=s[c+1];p.onsuccess=u.bind(u),p.onerror=s[s.length-1]}s[0].bind(s[0])()},i.onerror=function(o){e._protected.Helper.error(n,"failed to initialize IndexedDB storage",t,o,i.error),r.reject(i.error)},i.onsuccess=function(t){a&&r.reject(new e._protected.Errors.InternalStorageError("Module storage initialization failed: error encountered or broken upgrade chain"));var n=t.target.result;Promise.resolve(e._protected.Storage.onDbOpen(n)).then(r.resolve.bind(null,n),r.resolve.bind(null,n))},r.promise}(o,1).then(function(e){return(r=e).addEventListener("close",a),r.addEventListener("abort",a),this}.bind(this)))},this.getKeyValueStorageStoreName=function(){return"kv-storage"},this.getMutexStoreName=function(){return"mutex"},this.get=function(e,t){return s({get:{key:e,defaultValue:t}})},this.set=function(e,t){return s({put:{key:e,value:t}})},this.rm=function(e){return s({delete:{key:e}})};var s=function(e){return this.bulk([e]).then(function(e){return e.results.byIndex[0]})}.bind(this);this.bulk=function(t,o){t=t.slice(),o=o||{};var i=new e._protected.Promise.Deferred,a=[],s={},c=Object.keys(t.reduce(function(e,t){return e[t[Object.keys(t)[0]].store||"kv-storage"]=!0,e},{})),p={test:!0,add:!0,put:!0,delete:!0},u=t.find(function(e){return!!p[Object.keys(e)[0]]})?"readwrite":"readonly",d=null;try{d=r.transaction(c,u)}catch(r){if("InvalidStateError"===r.name){e._protected.Helper.warn(n,r);var l=o.tries||1;if(l>=3)return Promise.reject(r);var f=1e3*Math.pow(2,l-1)*(1+.2*Math.random());return e._protected.Helper.info(n,"Reopening IDBDatabase connection in ",f,"ms, cause:",r.message),new Promise(function(e,n){setTimeout(function(){return this.ready().then(function(){return this.bulk.call(this,t,Object.assign({},o,{tries:l+1}))}.bind(this)).then(e,n)},f)})}throw r}var h=c.reduce(function(e,t){return e[t]=d.objectStore(t),e},{}),g=function(n){for(var o=!1,r=function(n){var r,i=t[n],c=Object.keys(i)[0],p=i[c],u=p.store||"kv-storage",l=h[u],f=p.key,_=p.alias||f,m=p.value,v=p.defaultValue;switch(c){case"test":o=!0;case"get":r=l.get(f);break;case"add":r=l.add(m,f);break;case"put":r=l.put(m,f);break;case"delete":r=l.delete(f);break;case"abort":o=!0,d.abort(),r={};break;default:throw new e._protected.Errors.InternalStorageError("Unhandled operation type "+c)}r.onsuccess=function(e){var o=void 0!==e.target.result?e.target.result:v;if(a[n]=o,s[_]=o,"test"===c){var r=p.operationsCb(o);r&&"object"==typeof r&&(r instanceof Array||(r=[r]),r.length>0&&t.splice.apply(t,[n+1,0].concat(r))),g(n+1)}},r.onerror=function(e){e.preventDefault(),a[n]=e,s[_]=e}},i=n;!o&&i<t.length;++i)r(i)};return d.onabort=d.onerror=function(e){i.reject({event:e,results:{byIndex:a,byKey:s}})},d.oncomplete=function(e){i.resolve({event:e,results:{byIndex:a,byKey:s}})},g(0),i.promise},this.listObjectStores=function(){return Array.from(r.objectStoreNames)},this.listKeyValuePairs=function(e){return new Promise(function(t,n){var o=[];try{var i=r.transaction(e);i.objectStore(e).openCursor().onsuccess=function(e){var t=e.target.result;t&&(o.push([t.key,t.value]),t.continue())},i.oncomplete=function(){t(o)},i.onerror=i.onabort=function(e){n(e)}}catch(e){n(e)}})}};return e._protected.Storage=new function(){this.getDatabaseName=function(){return e._protected.sdkName},this.onDbOpen=function(e){};var i,a={},s=function(t){if(!t)return Promise.reject(new e._protected.Errors.InternalStorageError("Missing dbName. Storage not available."));if(a[t])return a[t].ready();var n=a[t]||new e._protected.Storage.Container(t);return n.ready().then(function(){return a[t]=n,n})};t=function(){e._protected.Storage.getDatabaseName()?s(e._protected.Storage.getDatabaseName()).then(function(e){i=e,o.resolve()}).catch(function(e){o.reject(e)}):o.resolve()},this.getModuleInitializationPromise=function(){return o.promise},this.getKeyValueStorageStoreName=function(){return i?i.getKeyValueStorageStoreName():null},this.getMutexStoreName=function(){return i?i.getMutexStoreName():null},this.get=function(t,n,o){return o=o||e._protected.Storage.getDatabaseName(),s(o).then(function(e){return e.get(t,n)})},this.set=function(t,n,o){return o=o||e._protected.Storage.getDatabaseName(),s(o).then(function(e){return e.set(t,n)})},this.rm=function(t,n){return n=n||e._protected.Storage.getDatabaseName(),s(n).then(function(e){return e.rm(t)})},this.bulk=function(t,n){return n=n||e._protected.Storage.getDatabaseName(),s(n).then(function(e){return e.bulk(t)})},this.listObjectStores=function(t){return t=t||e._protected.Storage.getDatabaseName(),s(t).then(function(e){return e.listObjectStores()})},this.deleteDatabase=function(t){return function(t){return new Promise(function(o,r){try{e._protected.Helper.warn(n,"deleting IndexedDB storage",t,"…");var i=e._protected.gscope.indexedDB.deleteDatabase(t);i.onerror=function(o){e._protected.Helper.error(n,"failed to delete IndexedDB storage",t,":",o,i.error),deferred.reject(i.error)},i.onsuccess=function(){e._protected.Helper.warn(n,"deleting IndexedDB storage",t,"succeeded")}}catch(o){e._protected.Helper.error(n,"error while deleting IndexedDB storage",t,":",o),r(o)}})}(t=t||e._protected.Storage.getDatabaseName())},this.listKeyValuePairs=function(t,n){return n=n||e._protected.Storage.getDatabaseName(),s(n).then(function(e){return e.listKeyValuePairs(t)})},this.isDefaultContainerAvailable=function(){return!!i},this.getDefaultContainer=function(){return i},this.Container=r,this.getKeyValueStorageStoreName=function(){return"kv-storage"},this.getMutexStoreName=function(){return"mutex"}},e.preInstantiationPromise.then(t),o.promise}}.apply(t,o))||(e.exports=r)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t,n,o=new e._protected.Promise.Deferred;return e._protected.Locking=new function(){n=function(){e.preInstantiationPromise.then(function(){e._protected.Integration.getModuleInitializationPromise().then(function(){e._protected.Integration.isOnRightDomain()&&(e._protected.Locking=t),e._protected.Storage.getModuleInitializationPromise().then(function(){o.resolve()})})})},this.getModuleInitializationPromise=function(){return o.promise},this.isAvailable=function(){return e._protected.Storage.isDefaultContainerAvailable()},this.ExpiringUnfairNamedGlobalMutex=function(t,n,o){var r=!1,i=null,a=t,s=n,c=o;this.acquire=function(t){if((t=t||{}).interval=t.interval||250,t.ttl=t.ttl||s,0===t.timeout)return this.tryAcquire(t.ttl);if(r)return Promise.resolve();var n=new e._protected.Promise.Deferred,o=+new Date;return e._protected.Promise.setIntervalUntilSettled(n.promise,function(){if(!(t.timeout>0&&+new Date-o>=t.timeout))return this.tryAcquire(t.ttl).then(n.resolve,function(){});n.reject()}.bind(this),t.interval,!0,!1),n.promise},this.tryAcquire=function(t){if(r)return Promise.resolve();var n;t=t||s;var o=function(){return n=+new Date+t,e._protected.Storage.bulk([{add:{store:e._protected.Storage.getMutexStoreName(),key:a,value:{name:a,until:n}}}],c)};return o().catch(function(e){return p().then(function(){return o()})}).then(function(){r=!0,i=n;var e=new Date(i);return e=e.toLocaleTimeString("en-GB")+"."+("00"+e.getMilliseconds()).slice(-3),Promise.resolve()},function(){return r=!1,Promise.reject()})},this.renewWhile=function(t,n){return(t=t||{}).ttl=t.ttl||s,t.interval=t.interval||t.ttl/2,e._protected.Promise.setIntervalUntilSettled(n,function(){return this.renew(t.ttl)}.bind(this),t.interval,!1,!1),t.release&&n._wp_do(function(){this.release()}.bind(this)),n},this.renew=function(t){if(!r)throw new e.prototype.Errors.InternalError("Cannot renew unacquired mutex");i<=+new Date&&console.log("Lock",a,"probably expired",+new Date-i,"ms ago"),t=t||s;var n=+new Date+t;return e._protected.Storage.bulk([{test:{store:e._protected.Storage.getMutexStoreName(),key:a,operationsCb:function(t){return t&&t.name===a&&t.until===i?{put:{store:e._protected.Storage.getMutexStoreName(),key:a,value:{name:a,until:n}}}:(console.warn("Lock",a,"has already expired"),r=!1,void(i=null))}}}],c).then(function(){i=n;var e=new Date(i);e=e.toLocaleTimeString("en-GB")+"."+("00"+e.getMilliseconds()).slice(-3)},function(e){return console.error("Failed to renew lock",a,":",e),Promise.reject()})},this.release=function(){if(!r)throw new e.prototype.Errors.InternalError("Cannot release unacquired mutex");return i<=+new Date&&console.log("Lock",a,"probably expired",+new Date-i,"ms ago"),e._protected.Storage.bulk([{test:{store:e._protected.Storage.getMutexStoreName(),key:a,operationsCb:function(t){return t&&t.name===a&&t.until===i?{delete:{store:e._protected.Storage.getMutexStoreName(),key:a}}:(console.warn("Lock",a,"has already expired"),r=!1,void(i=null))}}}],c).then(function(){r=!1,i=null},function(e){return console.error("Failed to release lock",a,":",e),Promise.reject()})};var p=function(){var t=+new Date,n=!1;return e._protected.Storage.bulk([{test:{store:e._protected.Storage.getMutexStoreName(),key:a,operationsCb:function(o){if(o&&o.name===a&&o.until<t)return n=!0,{delete:{store:e._protected.Storage.getMutexStoreName(),key:a}}}}}],c).then(function(){return n?Promise.resolve():Promise.reject()},function(e){return console.error("Failed to purge expired lock",a," (if any):",e),Promise.reject()})}}},t=e._protected.Locking,e._protected.Locking={getModuleInitializationPromise:t.getModuleInitializationPromise},n(),o.promise}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t=e.readyCallback;delete e.readyCallback,e._protected.Init={};var n=[];e._protected.Init.addWillBecomeReadyCallback=function(e){n.push(e)},e._protected.Blocker.category("ready").add("_init"),e._protected.Blocker.category("ready").wait().then(function(){n.forEach(function(e){e()}),n=[],t()}),e.instantiationPromise.then(function(){e._protected.Blocker.category("ready").remove("_init")})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){if("undefined"!=typeof Promise){var t=function(){};e._protected.Promise={setIntervalUntilSettled:function(t,n,o,r,i){var a=!1,s=function(){a=!0},c=(t.then(s,s),function(){var i;if(!a)return r?i=n():r=!0,Promise.all([i]).then(function(){return Promise.race([t,new e._protected.Promise.DelayedStartPromise(function(e,t){e(c())},o)])._wp_catchNoop()})._wp_catchNoop()});return i?c():setTimeout(c,0),t},DelayedResultPromise:function(e,t){return new Promise(function(n,o){return e(n._wp_delay(t),o._wp_delay(t))})},DelayedStartPromise:function(e,t){return new Promise(function(n,o){var r=this;setTimeout(function(){try{e.call(r,n,o)}catch(e){o(e)}},t)})},Poll:function(t,n,o){var r=new e._protected.Promise.Deferred,i=+new Date,a=function(){if(+new Date-i>n)r.reject(new e.prototype.Errors.TimeoutError);else{var s;try{s=!!t()}catch(e){return void r.reject(e)}s?r.resolve():setTimeout(a,o)}};a(),this.wait=function(){return r.promise},this.cancel=function(){r.reject(new e.prototype.Errors.CancellationError)}},Deferred:function(){try{this.resolve=null,this.reject=null,this.promise=new Promise(function(e,t){this.resolve=e,this.reject=t}.bind(this)),Object.freeze(this)}catch(t){throw new e.prototype.Errors.InternalError("Promise/Deferred is not available")}}},Promise._wp_allTimeout=function(e,t,n){var o={},r=e.map(function(){return n});return Promise.all(e.map(function(e,t){return e.then(function(e){r[t]=e})}))._wp_timeout(t,o).then(function(){return r},function(e){return e===o?Promise.resolve(r):Promise.reject(e)})},Function.prototype._wp_delay=function(e){var t=this;return function(){setTimeout(Function.prototype.bind.apply(t,[this].concat(Array.prototype.slice.call(arguments))),e)}},Promise.prototype._wp_delay=function(t){var n=this;return new e._protected.Promise.DelayedStartPromise(function(e,t){n.then(e,t)},t)},Promise.prototype._wp_timeout=function(t,n,o){return void 0===t?this:Promise.race([this,new e._protected.Promise.DelayedStartPromise(function(e,t){(o?e:t)(n)},t)])},Promise.prototype._wp_do=function(e){return this.then(function(t){try{e()}catch(e){}return Promise.resolve(t)},function(t){try{e()}catch(e){}return Promise.reject(t)})},Promise.prototype._wp_catchNoop=function(){return this.catch(t)}}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Consulate=function(t){var n,o,r,i,a=function(){n=null,o=null,r=!1,i=new e._protected.Promise.Deferred};a(),this.setup=function(t,a){this.isSetup()?console.warn("cannot set up an already setup consulate"):(n=new URL(t).origin,"allow"in(o=document.createElement("IFRAME"))&&(o.allow.supports?o.allow.supports("geolocation")&&o.allow.add("geolocation"):o.allow="geolocation"),o.style.display="none",o.src=t,document.body.appendChild(o),o.addEventListener("load",function(){e._protected.Integration.probeAndInitWindowObject(o.contentWindow,n,a,function(e){r=!0,i.resolve()},{type:"ping"},function(e){return e.data instanceof Object&&"pong"===e.data.type})}))}.bind(this),this.tearDown=function(){this.isSetup()?(document.body.removeChild(o),a()):console.warn("cannot remove consulate that is not set up")}.bind(this),this.isSetup=function(){return!!o},this.isReady=function(){return r},this.getReadyPromise=function(){return i.promise},this.getPostMessageTarget=function(){return o.contentWindow},this.getPostMessageOrigin=function(){return n},this.getIFrame=function(){return o}};var t={};e._protected.Consulate.getConsulate=function(e){return t[e]||null},e._protected.Consulate.createConsulate=function(n){if(t[n])throw new e.prototype.Errors.InternalError("Consulate already created");return t[n]=new e._protected.Consulate(n),t[n]}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t,n="[integration ]",o=new e._protected.Promise.Deferred;"undefined"!=typeof document&&document.currentScript;return e._protected.Integration=new function(){var r,i,a=e._protected.Consulate.createConsulate("frame");t=function(){e._protected.RunModes.Behaviors.ModeWebSite&&s(),e._protected.RunModes.Behaviors.ModeFrame?u():e._protected.RunModes.Behaviors.ModePopup?h():e._protected.RunModes.Behaviors.ModeSlave?_():e._protected.RunModes.Behaviors.ModeWebSite?l():e._protected.RunModes.Behaviors.ModeServiceWorker&&v(),Promise.resolve().then(function(){if(e._protected.RunModes.Behaviors.ModeFrame)return e._protected.Storage.getModuleInitializationPromise().then(function(){return e._protected.Integration.incrementPageViews()})}).catch(function(){}).then(o.resolve)},this.getModuleInitializationPromise=function(){return o.promise},this.getFrameReadyPromise=function(){return a.getReadyPromise()},this.getIFrame=function(){return a.getIFrame()},this.incrementPageViews=function(){return e._protected.RunModes.Behaviors.ModeFrame?e._protected.Storage.getModuleInitializationPromise().then(function(){return e._protected.Storage.bulk([{test:{key:"pageViews",defaultValue:0,operationsCb:function(e){return{put:{key:"pageViews",value:++e}}}}}])}):(console.error("should not be called from this domain"),Promise.resolve())},this.getHomeUrlObject=function(){return new URL(e._protected.Constants.HOME_URL)},this.getHomeHref=function(){return e._protected.Integration.getHomeUrlObject().href},this.getHomeOrigin=function(){return e._protected.Integration.getHomeUrlObject().origin},this.isOnRightDomain=function(){return e._protected.RunModes.Behaviors.ModeServiceWorker?(location.origin,e._protected.Integration.getHomeOrigin(),!0):location.origin===e._protected.Integration.getHomeOrigin()},this.getServiceWorkerUrl=function(){var t=new URL(e._protected.Options.getServiceWorkerUrl(),e._protected.Integration.getHomeHref());return t.protocol="https:",t.href},this.getFrameUrl=function(){var t=new URL(e._protected.Options.getFrameUrl(),e._protected.Integration.getHomeHref());return t.protocol="https:",t.href},this.getRedirectionPageUrl=function(t){var n=new URL(e._protected.Options.getRedirectionPageUrl(t),e._protected.Integration.getHomeHref());return n.protocol="https:",n.href};var s=function(){if(e._protected.RunModes.Behaviors.ModeWebSite){e._protected.Blocker.category("ready").add("hiddenFrame");var t=e._protected.Options.exportInitial();t._mode=e._protected.RunModes.Modes.Frame,t._hiddenFrame=!0,a.setup(e._protected.Integration.getFrameUrl(),t),a.getReadyPromise().then(c)}};this.injectStylesheetLink=function(e){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e,document.head.appendChild(t)},this.injectStylesheetInline=function(e){var t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode(e)),document.head.appendChild(t)};var c=function(t){e._protected.Blocker.category("ready").remove("hiddenFrame")},p=function(t,n,o,r){var i=e._protected.Options.exportInitial();i._mode=e._protected.RunModes.Modes.Popup,i._popup=!0,e._protected.Integration.probeAndInitWindowObject(t,e._protected.Integration.getTargetOrigin(),i,n,o,r)};this.probeAndInitWindowObject=function(t,n,o,r,i,a){if(t){i instanceof Object&&(i.sdk=e._protected.sdkName);var s=e._protected.Constants.WINDOW_LOAD_CHECK_PAGELOADED_INTERVAL_MS_MIN,c=(new Date).getTime(),p=!0,u=function(){(new Date).getTime();var i=new MessageChannel;i.port2.onmessage=function(e){if(e.data instanceof Object)switch(e.data.type){case"ready":r(t),r=function(){}}},t.postMessage({type:"init",sdk:e._protected.sdkName,initOpts:o},n,[i.port1])},d=function(n){var o=new MessageChannel;o.port2.onmessage=function(e){p&&a(e)&&(p=!1,u())},s=Math.min(e._protected.Constants.WINDOW_LOAD_CHECK_PAGELOADED_INTERVAL_MS_MAX,s*e._protected.Constants.WINDOW_LOAD_CHECK_PAGELOADED_INTERVAL_MS_EXP),t.postMessage(i,n,[o.port1]),setTimeout(l,s)},l=function(){if(p)if(t.closed)p=!1,r(!1),r=function(){};else if((new Date).getTime()-c<e._protected.Constants.WINDOW_LOAD_MAX_PAGELOAD_MS)d("*");else{try{t.close()}catch(e){}p=!1,r(!1),r=function(){}}else;};setTimeout(d.bind(null,n),s),setTimeout(function(){if(p){var t=((e._protected.Constants.WINDOW_LOAD_MAX_PAGELOAD_MS-e._protected.Constants.WINDOW_LOAD_SLOW_WARN_MS)/1e3).toFixed(0);console.warn("WonderPush seems to be taking some time to initialize one of its external resource on the domain ",n,".\nIf you see one error or repeated errors (which will stop in about "+t+' seconds) about "postMessage" and "target origin […] not match[ing] the recipient window\'s origin", then you either:\n- have a browser extension blocking that resource;\n- see a broken integration that you would be kind to report.\nIf not, then just wait around, and everything should get loaded soon.')}},e._protected.Constants.WINDOW_LOAD_SLOW_WARN_MS)}else r(null)},this.openPopup=function(t,n){var o=(n=e._protected.Helper.mergeObjectInplaceRecursive(e._protected.Constants.INTEGRATION_POPUP_DEFAULT_OPTIONS,n||{})).width,r=n.height;"window"===n.center?(n.left=(window.innerWidth-o)/2+window.screenX,n.top=(window.innerHeight-r)/2+window.screenY):"screen"===n.center&&(n.left=(screen.width-o)/2+screen.availLeft,n.top=(screen.height-r)/2+screen.availTop),delete n.center;var i=Object.keys(n).map(function(e){return e+"="+n[e]}).join(",");return window.open(t,"__blank",i)},this.openAndInitPopup=function(t,n,o){r=e._protected.Integration.openPopup(t,o),p(r,i=n,{type:"ping"},function(e){return e.data instanceof Object&&"pong"===e.data.type})},this.reloadPopup=function(){e._protected.RunModes.Behaviors.ModePopup?(window.opener.postMessage({type:"reloadPopup",sdk:e._protected.sdkName},"*"),window.location.reload()):console.error("reloadPopup() can only be called from within the popup itself")},this.reinitializePopup=function(t){e._protected.RunModes.Behaviors.ModeWebSite?r===t?p(r,i,{type:"isReady"},function(e){return e.data instanceof Object&&"readiness"===e.data.type&&!e.data.ready}):console.error("reinitializePopup() can only be invoked from the last opened popup"):console.error("reinitializePopup() can only be called from within the popup parent window")},this.getTargetOrigin=function(){return e._protected.Integration.getHomeOrigin()};var u=function(){window.addEventListener("message",d),e._protected.ServiceWorkerClient.addMessageEventListener(y)},d=function(t){if(t.data instanceof Object&&t.data.sdk===e._protected.sdkName)switch(t.data.type){case"callOnCustomDomain":w(t.data.functionName,t.data.args,t.ports[0])._wp_catchNoop()}},l=function(){window.addEventListener("message",f),e._protected.ServiceWorkerClient.addMessageEventListener(y)},f=function(t){if(t.data instanceof Object&&t.origin===e._protected.Integration.getTargetOrigin()&&t.data.sdk===e._protected.sdkName)switch(t.data.type){case"callOnParentWindow":w(t.data.functionName,t.data.args,t.ports[0])._wp_catchNoop();break;case"reloadPopup":e._protected.Integration.reinitializePopup(t.source)}},h=function(){window.addEventListener("message",g)},g=function(t){if(t.data instanceof Object&&t.data.sdk===e._protected.sdkName)switch(t.data.type){case"callOnPopupWindow":w(t.data.functionName,t.data.args,t.ports[0])._wp_catchNoop()}},_=function(){window.addEventListener("message",m)},m=function(t){if(t.data instanceof Object&&t.data.sdk===e._protected.sdkName)switch(t.data.type){case"callOnSlave":w(t.data.functionName,t.data.args,t.ports[0])._wp_catchNoop()}},v=function(){e._protected.ServiceWorker.addMessageEventListener(S)},S=function(t){if(t.data instanceof Object&&t.data.sdk===e._protected.sdkName)switch(t.data.type){case"callOnServiceWorker":t.waitUntil(w(t.data.functionName,t.data.args,t.ports[0])._wp_catchNoop())}},y=function(t){if(t.data instanceof Object&&t.data.sdk===e._protected.sdkName)switch(t.data.type){case"callOnServiceWorkerClients":w(t.data.functionName,t.data.args,t.ports[0])._wp_catchNoop()}},E=function(t){var n=new e.prototype.Errors.InvalidArgumentError("Invalid function name");if(!t)throw n;var o=t.split(".");if(o.length<3)throw n;var r=o[1];if("this"!==r&&"_protected"!==r&&"prototype"!==r)throw n},I=function(t,o,r,i){if(!t||t.postMessage){if(i=i||[],E(r),null===t)return w(r,i);var a=new e._protected.Promise.Deferred,s=new MessageChannel;return"closed"in t&&e._protected.Promise.setIntervalUntilSettled(a.promise,function(){if(t.closed){var n=new e._protected.Errors.InternalRPCTargetClosedError;a.reject(n)}},e._protected.Constants.INTEGRATION_RPC_CHECK_TARGET_CLOSED_INTERVAL_MS,!1,!1),s.port2.onmessageerror=function(s){e._protected.Helper.error(n,"[callOn] raised onmessageerror",s,"(for target:",t,"type:",o,"functionName:",r,"args:",i,")"),a.reject(s)},s.port2.onmessage=function(t){if(t.data instanceof Object)if("returned"in t.data)a.resolve(t.data.returned);else if("error"in t.data&&t.data.error){var n=t.data.error;if(n&&n.name){var o=e._protected.sdkName+"SDK.Errors.",r=Error;if(n.name&&n.name.startsWith(o)&&(r=e.prototype.Errors[n.name.substring(o.length)]||e._protected.Errors[n.name.substring(o.length)]),"function"==typeof r){var i=new r(n.message);i.name===n.name&&(delete n.name,e._protected.Helper.assign(i,n),n=i)}}a.reject(n)}},"undefined"!=typeof ServiceWorker&&t instanceof ServiceWorker||"undefined"!=typeof Client&&t instanceof Client?t.postMessage({sdk:e._protected.sdkName,type:o,functionName:r,args:i},[s.port1]):t.postMessage({sdk:e._protected.sdkName,type:o,functionName:r,args:i},"*",[s.port1]),a.promise}},w=function(t,n,o){n=n||[];for(var r,i=t.split(".").slice(1),a=e,s=0;s<i.length;++s)r=a,a=(a||{})[i[s]];return new e._protected.Promise.DelayedStartPromise(function(e,t){e(a.apply(r,n))},1).then(function(t){return o&&o.postMessage&&o.postMessage({returned:e._protected.Helper.messagePassableValue(t)}),t},function(t){throw o&&o.postMessage&&o.postMessage({error:e._protected.Helper.messagePassableValue(t)}),t})},b=function(e,t,n,o,r){if("function"==typeof n)return function(){var i=!0;r instanceof Function&&(i=r());var a=Array.prototype.slice.call(arguments);return i?e(t,a):new Promise(function(e,t){e(n.apply(o,a))})};if("object"==typeof n){for(var i in n)n.hasOwnProperty(i)&&(n[i]=b(e,t+"."+i,n[i],n,r));return n}return n};this.callOnCustomDomain=function(t,n){return E(t),e._protected.RunModes.Behaviors.ModeWebSite?a.getReadyPromise().then(function(){return I(a.getPostMessageTarget(),"callOnCustomDomain",t,n)}):I(null,"callOnCustomDomain",t,n)},this.proxifyToCustomDomain=function(t,n){return e._protected.RunModes.Behaviors.ModeWebSite?b(e._protected.Integration.callOnCustomDomain,t,n):n},this.callOnParentWindow=function(t,n){var o;return o=e._protected.RunModes.Behaviors.ContextFrame&&window.parent!==window?window.parent:null,I(o,"callOnParentWindow",t,n)},this.proxifyToParentWindow=function(t,n){return e._protected.RunModes.Behaviors.ContextFrame?b(e._protected.Integration.callOnParentWindow,t,n):n},this.callOnPopupWindow=function(e,t,n){return I(e,"callOnPopupWindow",t,n)},this.callOnSlave=function(e,t,n){return I(e,"callOnSlave",t,n)},this.callOnServiceWorker=function(t,n){return E(t),e._protected.RunModes.Behaviors.ContextServiceWorker?I(null,"callOnServiceWorker",t,n):navigator.serviceWorker?navigator.serviceWorker.ready.then(function(){return I(navigator.serviceWorker.controller,"callOnServiceWorker",t,n)}):new Promise((e,t)=>{})},this.proxifyToServiceWorker=function(t,n){return e._protected.RunModes.Behaviors.ContextServiceWorker?n:b(e._protected.Integration.callOnServiceWorker,t,n)},this.callOnServiceWorkerClients=function(t,n){return E(t),e._protected.RunModes.Behaviors.ContextServiceWorker?clients.matchAll().then(function(e){return Promise.all(e.map(function(e){return I(e,"callOnServiceWorkerClients",t,n)}))}):I(null,"callOnServiceWorkerClients",t,n)},this.proxifyToServiceWorkerClients=function(t,n){return e._protected.RunModes.Behaviors.ContextServiceWorker?b(e._protected.Integration.callOnServiceWorkerClients,t,n):n}},e.preInstantiationPromise.then(function(){return e._protected.Options.getModuleInitializationPromise()}).then(function(){return e._protected.Blocker.category("integration").wait()}).then(t),o.promise}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Request=new function(){this.request=function(t,n,o,r,i,a,s){s=s||{},a=a||{};var c=function(e,t){if("function"!=typeof XMLHttpRequest&&"function"!=typeof XDomainRequest)return null;var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest).open(e,t):n=null,n}(t,n);if(!(c&&!0!==s.fetch||"function"!=typeof fetch)){var p={};if(p.method=t||"GET",p.mode="cors",r?p.body=r:o&&(p.body=o),i)for(var u in p.headers=new Headers,i)p.headers.append(u,i[u]);var d=function(){},l="function"==typeof a.onload?a.onload:d,f="function"==typeof a.onerror?a.onerror:d;return fetch(n,p).then(function(e){if(0===e.status||e.status>=200&&e.status<=299)return l(e),e;throw f(e),e},function(e){throw f(e),e})}if(c){if(c.timeout=e._protected.Constants.REQUEST_TIMEOUT_MS,i)for(var u in i)c.setRequestHeader(u,i[u]);a&&["onerror","ontimeout","onabort","onloadend"].forEach(function(e){a[e]&&(c[e]=a[e])}),c.onload=function(){if(a){try{c.responseJSON=e._protected.Helper.tryParse(this.responseText,null)}catch(e){}var t=this.status;t>=200&&t<=299&&a.onload?a.onload.apply(this,arguments):a.onerror&&a.onerror.apply(this,arguments)}},c.onloadend=function(){a.onloadend&&a.onloadend.apply(this,arguments)},"POST"===t||"PATCH"===t?c.send(o):c.send()}},this.requestEventually=function(t,n,o,r,i){if(!e._protected.RunModes.Behaviors.AccessToken)throw new e.prototype.Errors.InternalError("Should not be called in this environment");var a=new e._protected.RequestVaultJob([t,n,o,r,i]);e._protected.RequestVault.run(a)}}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.RequestVault={JOB_STATUS_QUEUED:"queued",JOB_STATUS_RUNNING:"running",JOB_STATUS_PERFORMED:"performed",jobTypes:{},run:function(e){this._queue(e).then(function(){this._execute(e)}.bind(this))},_queue:function(t){var n=Math.floor(1e10*Math.random());return e._protected.Storage.bulk([{test:{key:"requestVaultJobs",defaultValue:{},operationsCb:function(e){for(;n in e;)n=Math.floor(1e10*Math.random());return t._jid=n,e[n]=this.serialize(t),t._jid=null,{put:{key:"requestVaultJobs",value:e}}}.bind(this)}}]).then(function(){t._jid=n})},_update:function(t){return e._protected.Storage.bulk([{test:{key:"requestVaultJobs",defaultValue:{},operationsCb:function(e){return t._jid in e?(e[t._jid]=this.serialize(t),{put:{key:"requestVaultJobs",value:e}}):{abort:{}}}.bind(this)}}]).then(function(){})},_unqueue:function(t){return t instanceof Array||(t=[t]),t.length?e._protected.Storage.bulk([{test:{key:"requestVaultJobs",defaultValue:{},operationsCb:function(e){for(var n=0;n<t.length;++n)job=t[n],job._jid,delete e[job._jid];return{put:{key:"requestVaultJobs",value:e}}}.bind(this)}}]).then(function(){}):Promise.resolve()},_runQueued:function(){var t=new e._protected.Locking.ExpiringUnfairNamedGlobalMutex("requestvault",1e4);return t.tryAcquire().then(function(){var n=+new Date,o=n+e._protected.Constants.REQUEST_VAULT_IDLE_WAIT_MS;return t.renewWhile({release:!0},e._protected.Storage.get("requestVaultJobs",{}).then(function(t){var r=[];for(var i in t)if(t.hasOwnProperty(i)){!0;var a=this.unserialize(t[i]);switch(a.getStatus()){case this.JOB_STATUS_PERFORMED:r.push(a);break;case this.JOB_STATUS_QUEUED:n>=a.getWaitUntilDate()?this._executing[a._jid]||this._execute(a):o=Math.min(o,a.getWaitUntilDate());break;case this.JOB_STATUS_RUNNING:n>=a.getRunningSinceDate()+e._protected.Constants.REQUEST_VAULT_RUNNING_JOB_TIMEOUT_MS&&(this._executing[a._jid]||this._execute(a))}}return this._unqueue(r)}.bind(this)))._wp_do(function(){var e=o-n;e+=100+Math.round(1e3*Math.random()),setTimeout(this._runQueued.bind(this),e)}.bind(this))}.bind(this),function(){var t=Math.round(e._protected.Constants.REQUEST_VAULT_IDLE_WAIT_MS*(1+.2*Math.random()));setTimeout(this._runQueued.bind(this),t)}.bind(this))},_executing:{},_execute:function(t){if(!this._executing[t._jid]&&(t.getStatus()!==this.JOB_STATUS_RUNNING||+new Date>=t.getRunningSinceDate()+e._protected.Constants.REQUEST_VAULT_RUNNING_JOB_TIMEOUT_MS)){this._executing[t._jid]=!0;var n=e._protected.Constants.REQUEST_VAULT_RUNNING_JOB_TIMEOUT_MS,o=new e._protected.Locking.ExpiringUnfairNamedGlobalMutex("requestvault-job-"+t._jid,n);return o.tryAcquire().then(function(){return t.setStatus(this.JOB_STATUS_RUNNING),this._update(t).then(function(){return t.run().then(function(){},function(){})._wp_do(function(){this._update(t)}.bind(this))}.bind(this))._wp_do(function(){return o.release()})}.bind(this),function(){})._wp_do(function(){delete this._executing[t._jid]}.bind(this))}},_init:function(){e._protected.Locking.isAvailable()&&this._runQueued()},serialize:function(e){return e.toJSONObject()},unserialize:function(t){"string"==typeof t&&((t=JSON.parse(t)).v=t.v||1,t.status=t.status||e._protected.RequestVault.JOB_STATUS_QUEUED,t.id=t.id||Math.floor(1e10*Math.random()));var n=t.type;return this.jobTypes[n].fromJSONObject(t)}},e._protected.RequestVaultJob=function(t){var n,o=e._protected.RequestVault.JOB_STATUS_QUEUED,r=+new Date,i=0,a=0,s=this,c={onload:function(){s.setStatus(e._protected.RequestVault.JOB_STATUS_PERFORMED),n.resolve(),n=void 0},onerror:function(t){t&&t.target&&(0===t.target.status||e._protected.Helper.inArray(t.target.status,[500,503]))||"undefined"!=typeof TypeError&&t instanceof TypeError?(s.setWaitUntilDate(e._protected.Constants.REQUEST_VAULT_ERROR_WAIT_MS+ +new Date),s.setStatus(e._protected.RequestVault.JOB_STATUS_QUEUED)):s.setStatus(e._protected.RequestVault.JOB_STATUS_PERFORMED),n.resolve(),n=void 0},ontimeout:function(){s.setWaitUntilDate(e._protected.Constants.REQUEST_VAULT_ERROR_WAIT_MS+ +new Date),s.setStatus(e._protected.RequestVault.JOB_STATUS_QUEUED),n.resolve(),n=void 0},onabort:function(){s.setWaitUntilDate(e._protected.Constants.REQUEST_VAULT_ERROR_WAIT_MS+ +new Date),s.setStatus(e._protected.RequestVault.JOB_STATUS_QUEUED),n.resolve(),n=void 0}},p=t.slice();p.push(c),this._jid=null,this.getStatus=function(){return o},this.setStatus=function(t){0===t&&(t=e._protected.RequestVault.JOB_STATUS_QUEUED),1===t&&(t=e._protected.RequestVault.JOB_STATUS_RUNNING),2===t&&(t=e._protected.RequestVault.JOB_STATUS_PERFORMED),o=t},this.getCreationDate=function(){return r},this.setCreationDate=function(e){r=e},this.getWaitUntilDate=function(){return i},this.setWaitUntilDate=function(e){i=e||0},this.getRunningSinceDate=function(){return a},this.setRunningSinceDate=function(e){a=e||0},this.run=function(){return n||(n=new e._protected.Promise.Deferred,a=+new Date,e._protected.Request.request.apply(e._protected.Request.request,p)),n.promise},this.toJSONObject=function(){return{type:"RequestVaultJob",v:1,id:s._jid,status:o,creationDate:r,waitUntilDate:i,runningSinceDate:a,args:t}}},e._protected.RequestVaultJob.fromJSONObject=function(t){var n=new e._protected.RequestVaultJob(t.args);return n._jid=t.id,n.setStatus(t.status),t.creationDate&&n.setCreationDate(t.creationDate),n.setWaitUntilDate(t.waitUntilDate),n.setRunningSinceDate(t.runningSinceDate),n},e._protected.RequestVault.jobTypes.RequestVaultJob=e._protected.RequestVaultJob,e.preInstantiationPromise.then(function(){e._protected.RunModes.Behaviors.AccessToken&&e._protected.Integration.getModuleInitializationPromise().then(function(){e._protected.RequestVault._init()})})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t;e._protected.ServiceWorkerClient=new function(){var n=[];t=function(){e._protected.Integration.getModuleInitializationPromise().then(function(){e._protected.RunModes.Behaviors.RegisterServiceWorker&&e._protected.Helper.supportsServiceWorker()&&"https:"===location.protocol&&o()})};var o=function(){addEventListener("message",r),navigator.serviceWorker&&navigator.serviceWorker.addEventListener("message",r)};this.registerServiceWorker=function(){var t=e._protected.Integration.getServiceWorkerUrl(),n={scope:e._protected.Options.getServiceWorkerScope()};return navigator.serviceWorker?navigator.serviceWorker.register(t,n).catch(function(e){}).then(function(e){return navigator.serviceWorker.ready}).then(function(e){return e},function(e){if(console.error("Cannot register the ServiceWorker / no ServiceWorker ready",e),e)throw e}):new Promise((e,t)=>{})},this.getPushSubscription=e._protected.Integration.proxifyToCustomDomain("SDK._protected.ServiceWorkerClient.getPushSubscription",function(){return navigator.serviceWorker?navigator.serviceWorker.ready.then(function(e){var t=e.pushManager.getSubscription();return t}):new Promise((e,t)=>{})}),this.getPushSubscriptionFromServiceWorker=e._protected.Integration.proxifyToServiceWorker("SDK._protected.ServiceWorkerClient.getPushSubscriptionFromServiceWorker",function(){if("granted"!==Notification.permission)return Promise.resolve(null);var e=registration.pushManager.getSubscription();return e});var r=function(t){if("undefined"==typeof ServiceWorkerMessageEvent||t instanceof ServiceWorkerMessageEvent){if(t.data instanceof Object&&t.data.sdk!==e._protected.sdkName)switch(t.data.type){case"ping":"ports"in t&&t.ports.length>0&&t.ports[0].postMessage({type:"pong",data:t.data})}n.forEach(function(e){try{e.call(this,t)}catch(e){console.error("ServiceWorkerClient message handler threw",e)}})}};this.addMessageEventListener=function(e){n.push(e)},this.removeMessageEventListener=function(e){var t=n.indexOf(e);t>=0&&n.splice(t,1)}},t()}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){if(e._protected.RunModes.Behaviors.ContextServiceWorker){var t=e._protected.gscope;e._protected.ServiceWorker=new function(){this.addEventListener=t._wp_worker_addEventListener||function(e,n){t.addEventListener(e,function(e){var t=n(e);t instanceof Promise&&e.waitUntil(t)})},this.removeEventListener=t._wp_worker_removeEventListener||function(e,n){t.removeEventListener(e,n)};var n=function(){this.addEventListener("message",function(t){return e.instantiationPromise.then(function(){r(t)})})}.bind(this),o=[],r=function(e){e.data instanceof Object&&(e.data.type,o.forEach(function(t){try{t.call(this,e)}catch(e){console.error("ServiceWorker message handler threw",e)}}))};this.addMessageEventListener=function(e){o.push(e)},this.removeMessageEventListener=function(e){var t=o.indexOf(e);t>=0&&o.splice(t,1)},n()}}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){WonderPushSDK._protected.Time={},WonderPushSDK._protected.Time.getRealTime=function(){return Date.now()}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){WonderPushSDK._protected.Constants.SERVICE_WORKER_URL="wonderpush-worker-loader.min.js?webKey=${webKey}",WonderPushSDK._protected.Constants.FRAME_URL="wonderpush.min.html",WonderPushSDK._protected.Constants.MANIFEST_URL="wonderpush-manifest.json",WonderPushSDK._protected.Constants.REDIRECT_URL="wonderpush-redirect.html?url=${url}",WonderPushSDK.prototype.Constants={},WonderPushSDK.prototype.Constants.SDK_VERSION="1.1.10.4",WonderPushSDK.prototype.Constants.SDK_SHORT_VERSION=WonderPushSDK.prototype.Constants.SDK_VERSION.split(".").slice(0,2).join("."),WonderPushSDK._protected.Constants.ROOT_API_URL="api.wonderpush.com",WonderPushSDK._protected.Constants.API_VERSION="v1",WonderPushSDK._protected.Constants.DEFAULT_LANGUAGE_CODE="en",WonderPushSDK._protected.Constants.VALID_LANGUAGE_CODES=["af","ar","be","bg","bn","ca","cs","da","de","el","en","en_GB","en_US","es","es_ES","es_MX","et","fa","fi","fr","fr_FR","fr_CA","he","hi","hr","hu","id","is","it","ja","ko","lt","lv","mk","ms","nb","nl","pa","pl","pt","pt_PT","pt_BR","ro","ru","sk","sl","sq","sr","sv","sw","ta","th","tl","tr","uk","vi","zh","zh_CN","zh_TW","zh_HK"],WonderPushSDK._protected.Constants.DEFAULT_DOMAIN_SUFFIX=".by.wonderpush.com",WonderPushSDK._protected.Constants.CDN_ROOT_HREF="https://cdn"+WonderPushSDK._protected.Constants.DEFAULT_DOMAIN_SUFFIX+"/",WonderPushSDK._protected.Constants.CONFIG_URL_PATTERN=WonderPushSDK._protected.Constants.CDN_ROOT_HREF+"config/webkeys/${webkey}",WonderPushSDK._protected.Constants.PLUGIN_ROOT_URL=WonderPushSDK._protected.Constants.CDN_ROOT_HREF+"plugins/",WonderPushSDK._protected.Constants.PARTNER_DOMAIN_DEFAULT_URL_SUFFIX="sdk/",WonderPushSDK._protected.Constants.CONFIG_FETCH_WAIT_BEFORE_RETRY_MS=1e4,WonderPushSDK._protected.Constants.CONFIG_FETCH_MAX_TRIES=3,WonderPushSDK._protected.Constants.CONFIG_CACHE_DEFAULT_TTL=432e5,WonderPushSDK._protected.Constants.CONFIG_MISSING_CACHE_TTL=9e5,WonderPushSDK._protected.Constants.GET_DELIVERIES_TRIES=3,WonderPushSDK._protected.Constants.GET_DELIVERIES_ERROR_WAIT_MS=1e4,WonderPushSDK._protected.Constants.GET_DELIVERIES_RANDOM_WAIT_MIN_MS=0,WonderPushSDK._protected.Constants.GET_DELIVERIES_RANDOM_WAIT_MAX_MS=5e3,WonderPushSDK._protected.Constants.GEOLOCATION_SUPPORTED="geolocation"in navigator,WonderPushSDK._protected.Constants.GEOLOCATION_MAXIMUM_AGE=3e5,WonderPushSDK._protected.Constants.GEOLOCATION_OPTIONS_FIRST_FIX={enableHighAccuracy:!1,timeout:0,maximumAge:WonderPushSDK._protected.Constants.GEOLOCATION_MAXIMUM_AGE},WonderPushSDK._protected.Constants.GEOLOCATION_OPTIONS={enableHighAccuracy:!1,timeout:WonderPushSDK._protected.Constants.GEOLOCATION_MAXIMUM_AGE,maximumAge:WonderPushSDK._protected.Constants.GEOLOCATION_MAXIMUM_AGE},WonderPushSDK._protected.Constants.DIFFERENT_SESSION_REGULAR_MIN_TIME_GAP=18e5,WonderPushSDK._protected.Constants.DIFFERENT_SESSION_NOTIFICATION_MIN_TIME_GAP=9e5,WonderPushSDK._protected.Constants.INSTALLATION_CORE_PROPERTIES_CACHE=6048e5,WonderPushSDK._protected.Constants.INSTALLATION_PUSH_TOKEN_CACHE=WonderPushSDK._protected.Constants.INSTALLATION_CORE_PROPERTIES_CACHE,WonderPushSDK._protected.Constants.SW_MAX_PAGELOAD_MS=6e4,WonderPushSDK._protected.Constants.SW_CHECK_PAGELOADED_INTERVAL_MS=250,WonderPushSDK._protected.Constants.SW_PING_TIMEOUT_MS=2e3,WonderPushSDK._protected.Constants.SUBSCRIPTION_SWITCH_ELEMENT_ID_DEFAULT="wonderpush-subscription-switch",WonderPushSDK._protected.Constants.SUBSCRIPTION_MODE_DEFAULT="visits",WonderPushSDK._protected.Constants.SUBSCRIPTION_MIN_VISITS_DEFAULT=2,WonderPushSDK._protected.Constants.SUBSCRIPTION_MIN_PAGES_DEFAULT=3,WonderPushSDK._protected.Constants.SUBSCRIPTION_DELAY_DEFAULT=0,WonderPushSDK._protected.Constants.SUBSCRIPTION_SNOOZE_DEFAULT=6048e5,WonderPushSDK._protected.Constants.POPUP_AUTOCLOSE_SLEEP=3e3,WonderPushSDK._protected.Constants.PUSH_MANAGER_SUBSCRIBE_TOO_LONG=5e3,WonderPushSDK._protected.Constants.ACTION_TRACK_EVENT="trackEvent",WonderPushSDK._protected.Constants.ACTION_UPDATE_INSTALLATION="updateInstallation",WonderPushSDK._protected.Constants.ACTION_RESYNC_INSTALLATION="resyncInstallation",WonderPushSDK._protected.Constants.ACTION__OVERRIDE_NOTIFICATION_RECEIPT="_overrideNotificationReceipt",WonderPushSDK._protected.Constants.PER_USER_INSTALLATION_CUSTOM_PROPERTIES_STORAGE_KEY="perUserInstallationCustomProperties",WonderPushSDK._protected.Constants.JSON_SYNC_MAX_INFLIGHT_TIME=Math.round(1.1*WonderPushSDK._protected.Constants.REQUEST_TIMEOUT_MS)+1e3,WonderPushSDK._protected.Constants.CACHED_INSTALLATION_CUSTOM_PROPERTIES_MIN_DELAY=0,WonderPushSDK._protected.Constants.CACHED_INSTALLATION_CUSTOM_PROPERTIES_MAX_DELAY=0,WonderPushSDK._protected.Constants.FEDERATED_FRAME_URL=WonderPushSDK._protected.Constants.CDN_ROOT_HREF+WonderPushSDK._protected.Constants.PARTNER_DOMAIN_DEFAULT_URL_SUFFIX+WonderPushSDK.prototype.Constants.SDK_VERSION+"/"+WonderPushSDK._protected.Constants.FRAME_URL,WonderPushSDK._protected.Constants.STORELOOP_WEBKEY="d94e437fcebe9b6abd33b391daf02ae151cefd9838ec80d287869abfbcd8e89b",WonderPushSDK._protected.Constants.GOOGLE_ANALYTICS_PROPERTY_ID="UA-56491200-3",WonderPushSDK._protected.Constants.GOOGLE_ANALYTICS_STORAGE_DATABASE_NAME="WP_analytics",WonderPushSDK._protected.Constants.PRESENCE_ANTICIPATED_TIME_MS=3e5,WonderPushSDK._protected.Constants.PRESENCE_UPDATE_SAFETY_MARGIN=6e4}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(){}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t,n="[analytics   ]",o=new e._protected.Promise.Deferred,r={},i={},a=function(e){var t=i[e];t&&r[e]&&(r[e].forEach(function(e){e.resolve(t)}),delete r[e])};return e._protected.Analytics=new function(){var s;this.getModuleInitializationPromise=function(){return o.promise};var c={},p=function(t,n){for(var o=e._protected.Constants.ANALYTICS_EXPERIMENTS||{},r=0;o[t]&&r<o[t].variants.length;r++){if(o[t].variants[r].name===n)return r}return-1};t=function(){if(e._protected.RunModes.Behaviors.Analytics)return e._protected.Analytics.getUserData().then(function(t){return(s=t).experiments&&Object.keys(s.experiments).forEach(function(t){e._protected.Analytics.activateExperimentVariant(t,s.experiments[t])}),e._protected.Blocker.category("analytics").wait()}).then(o.resolve).catch(o.reject);o.resolve()},this.setExperimentVariant=function(t,o){(e._protected.Constants.ANALYTICS_EXPERIMENTS||{})[t]?(s&&s.experiments&&(s.experiments[t]=o),e._protected.Analytics.activateExperimentVariant(t,o),e._protected.Analytics.saveExperimentVariantToDatabase(t,o)):e._protected.Helper.warn(n,"Experiment not found:"+t)},this.activateExperimentVariant=function(t,n){t&&n&&(e._protected.RunModes.Behaviors.ModeFrame&&e._protected.Integration.callOnParentWindow("SDK._protected.Analytics.activateExperimentVariant",[t,n]),i[t]=n,a(t))},this.saveExperimentVariantToDatabase=e._protected.Integration.proxifyToCustomDomain("SDK._protected.Analytics.saveExperimentVariantToDatabase",function(t,n){e._protected.Storage.get(e._protected.Constants.GOOGLE_ANALYTICS_USER_DATA_STORAGE_KEY,{},e._protected.Constants.GOOGLE_ANALYTICS_STORAGE_DATABASE_NAME).then(function(o){var r=o.experiments||{};return r[t]=n,o.experiments=r,e._protected.Storage.set(e._protected.Constants.GOOGLE_ANALYTICS_USER_DATA_STORAGE_KEY,o,e._protected.Constants.GOOGLE_ANALYTICS_STORAGE_DATABASE_NAME)})}),this.getUserData=e._protected.Integration.proxifyToCustomDomain("SDK._protected.Analytics.getUserData",function(){var t;return e._protected.Storage.bulk([{test:{key:e._protected.Constants.GOOGLE_ANALYTICS_USER_DATA_STORAGE_KEY,defaultValue:{},operationsCb:function(n){if(n.cid||(n.cid=e._protected.Helper.uuidv4()),e._protected.RunModes.Behaviors.AnalyticsExperiments){n.experiments||(n.experiments={});var o=e._protected.Constants.ANALYTICS_EXPERIMENTS||{};Object.keys(o).forEach(function(t){n.experiments[t]&&-1<p(t,n.experiments[t])||(n.experiments[t]=function(t){var n=(e._protected.Constants.ANALYTICS_EXPERIMENTS||{})[t];if(n)for(var o=Math.random(),r=0,i=0;i<n.variants.length;i++)if(o<(r+=n.variants[i].weight))return n.variants[i].name}(t))})}return t=n,{put:{key:e._protected.Constants.GOOGLE_ANALYTICS_USER_DATA_STORAGE_KEY,value:n}}}}}],e._protected.Constants.GOOGLE_ANALYTICS_STORAGE_DATABASE_NAME).then(function(){return t})}),this.setCustomDimension=function(e,t){c[e]=t},this.sendEvent=function(t,n,o,r,i){if(!e._protected.RunModes.Behaviors.Analytics)return!1;var a="/events/"+(t||"null")+"/"+(n||"null");if(i||(i=e._protected.Options.getWebKey()),!s.cid)return Promise.reject(new e.prototype.Errors.InternalError("Could not find google CID"));var u="";e._protected.RunModes.Behaviors.AnalyticsExperiments&&(u="exp="+encodeURIComponent(Object.keys(s.experiments).map(function(t){var n=s.experiments[t],o=function(t){var n=e._protected.Constants.ANALYTICS_EXPERIMENTS||{};return n[t]?n[t].identifier:null}(t);if(!n||!o)return"";var r=p(t,n);return-1===r?"":o+"."+r}).join("!")));var d="undefined"!=typeof navigator&&navigator.userAgent||"",l="undefined"!=typeof screen&&screen.availWidth&&screen.availHeight&&screen.availWidth+"x"+screen.availHeight||"",f="undefined"!=typeof window&&window.innerWidth&&window.innerHeight&&window.innerWidth+"x"+window.innerHeight||"",h="undefined"!=typeof document&&document.characterSet||"",g="undefined"!=typeof screen&&screen.colorDepth&&screen.colorDepth+"-bit"||"",_="undefined"!=typeof navigator&&navigator.language&&navigator.language.toLowerCase()||"",m="v=1&cid="+encodeURIComponent(s.cid)+"&tid="+encodeURIComponent(e._protected.Constants.GOOGLE_ANALYTICS_PROPERTY_ID)+(d&&"&ua="+encodeURIComponent(d)||"")+(l&&"&sr="+encodeURIComponent(l)||"")+(f&&"&vp="+encodeURIComponent(f)||"")+(h&&"&de="+encodeURIComponent(h)||"")+(g&&"&sd="+encodeURIComponent(g)||"")+(_&&"&ul="+encodeURIComponent(_)||"")+(i?"&cs="+encodeURIComponent(i):"")+"&"+u+"&"+Object.keys(c).map(function(e){return encodeURIComponent(e.replace("dimension","cd"))+"="+encodeURIComponent(""+c[e])}).join("&"),v="https://www.google-analytics.com/batch",S=[m+"&t=event&ec="+(t?encodeURIComponent(t):"")+"&ea="+(n?encodeURIComponent(n):"")+"&el="+(o?encodeURIComponent(o):"")+(r?"&ev="+r:""),m+"&t=pageview"+(o?"&dt="+encodeURIComponent(o):"")+"&dh="+encodeURIComponent(e._protected.Integration.getHomeUrlObject().hostname)+"&dp="+a].join("\n");if("undefined"!=typeof navigator&&navigator.sendBeacon)return navigator.sendBeacon(v,S);var y=new e._protected.Promise.Deferred;return e._protected.Request.request("POST",v,S,void 0,void 0,{onload:function(){y.resolve()},onerror:function(e){y.reject(e)}},void 0),y.promise},this.onExperiment=function(t){var n=new e._protected.Promise.Deferred;return r[t]=r[t]||[],r[t].push(n),a(t),n.promise}},e.preInstantiationPromise.then(function(){return Promise.all([e._protected.Storage.getModuleInitializationPromise(),e._protected.Integration.getModuleInitializationPromise(),e._protected.Locking.getModuleInitializationPromise()])}).then(t),o.promise}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){WonderPushSDK.prototype.Errors.PermissionError=function(e,t,n){WonderPushSDK.prototype.Errors.Error.call(this,e),this.permission=t,this.state=n},WonderPushSDK.prototype.Errors.PermissionError.prototype=Object.create(WonderPushSDK.prototype.Errors.Error.prototype,{name:{value:"WonderPushSDK.Errors.PermissionError"},constructor:{value:WonderPushSDK.prototype.Errors.PermissionError}}),WonderPushSDK.prototype.Errors.UserCancellationError=function(e){WonderPushSDK.prototype.Errors.Error.apply(this,arguments)},WonderPushSDK.prototype.Errors.UserCancellationError.prototype=Object.create(WonderPushSDK.prototype.Errors.Error.prototype,{name:{value:"WonderPushSDK.Errors.UserCancellationError"},constructor:{value:WonderPushSDK.prototype.Errors.UserCancellationError}}),WonderPushSDK.prototype.Errors.RegistrationInProgressError=function(e){WonderPushSDK.prototype.Errors.Error.apply(this,arguments)},WonderPushSDK.prototype.Errors.RegistrationInProgressError.prototype=Object.create(WonderPushSDK.prototype.Errors.Error.prototype,{name:{value:"WonderPushSDK.Errors.RegistrationInProgressError"},constructor:{value:WonderPushSDK.prototype.Errors.RegistrationInProgressError}}),WonderPushSDK.prototype.Errors.PushNotificationsNotSupportedError=function(e){WonderPushSDK.prototype.Errors.Error.apply(this,arguments)},WonderPushSDK.prototype.Errors.PushNotificationsNotSupportedError.prototype=Object.create(WonderPushSDK.prototype.Errors.Error.prototype,{name:{value:"WonderPushSDK.Errors.PushNotificationsNotSupportedError"},constructor:{value:WonderPushSDK.prototype.Errors.PushNotificationsNotSupportedError}}),WonderPushSDK.prototype.Errors.PopupError=function(e){WonderPushSDK.prototype.Errors.Error.apply(this,arguments)},WonderPushSDK.prototype.Errors.PopupError.prototype=Object.create(WonderPushSDK.prototype.Errors.Error.prototype,{name:{value:"WonderPushSDK.Errors.PopupError"},constructor:{value:WonderPushSDK.prototype.Errors.PopupError}}),WonderPushSDK.prototype.Errors.NotificationPayloadError=function(e){WonderPushSDK.prototype.Errors.Error.apply(this,arguments)},WonderPushSDK.prototype.Errors.NotificationPayloadError.prototype=Object.create(WonderPushSDK.prototype.Errors.Error.prototype,{name:{value:"WonderPushSDK.Errors.NotificationPayloadError"},constructor:{value:WonderPushSDK.prototype.Errors.NotificationPayloadError}}),WonderPushSDK.prototype.Errors.PluginError=function(e){WonderPushSDK.prototype.Errors.Error.apply(this,arguments)},WonderPushSDK.prototype.Errors.PluginError.prototype=Object.create(WonderPushSDK.prototype.Errors.Error.prototype,{name:{value:"WonderPushSDK.Errors.PluginError"},constructor:{value:WonderPushSDK.prototype.Errors.PluginError}}),WonderPushSDK._protected.Errors.InternalConfigUnavailableError=function(e){WonderPushSDK.prototype.Errors.InternalError.apply(this,arguments)},WonderPushSDK._protected.Errors.InternalConfigUnavailableError.prototype=Object.create(WonderPushSDK.prototype.Errors.InternalError.prototype,{name:{value:"WonderPushSDK.Errors.InternalConfigUnavailableError"},constructor:{value:WonderPushSDK._protected.Errors.InternalConfigUnavailableError}}),WonderPushSDK._protected.Errors.InternalWrongDomainError=function(e){WonderPushSDK.prototype.Errors.InternalError.apply(this,arguments)},WonderPushSDK._protected.Errors.InternalWrongDomainError.prototype=Object.create(WonderPushSDK.prototype.Errors.InternalError.prototype,{name:{value:"WonderPushSDK.Errors.InternalWrongDomainError"},constructor:{value:WonderPushSDK._protected.Errors.InternalWrongDomainError}}),WonderPushSDK._protected.Errors.InternalWrongTargetError=function(e){WonderPushSDK.prototype.Errors.InternalError.apply(this,arguments)},WonderPushSDK._protected.Errors.InternalWrongTargetError.prototype=Object.create(WonderPushSDK.prototype.Errors.InternalError.prototype,{name:{value:"WonderPushSDK.Errors.InternalWrongTargetError"},constructor:{value:WonderPushSDK._protected.Errors.InternalWrongTargetError}})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){WonderPushSDK._protected.RunModes.registerBehavior("CoreProperties",function(e){return[WonderPushSDK._protected.RunModes.Modes.ServiceWorker,WonderPushSDK._protected.RunModes.Modes.Frame].indexOf(e)>=0}),WonderPushSDK._protected.RunModes.registerBehavior("Federated",function(e){return e===WonderPushSDK._protected.RunModes.Modes.Slave&&WonderPushSDK._protected.Integration.isOnFederatedDomain()}),WonderPushSDK._protected.RunModes.registerBehavior("Plugins",function(e){return[WonderPushSDK._protected.RunModes.Modes.WebSite,WonderPushSDK._protected.RunModes.Modes.Frame,WonderPushSDK._protected.RunModes.Modes.Popup,WonderPushSDK._protected.RunModes.Modes.ServiceWorker].indexOf(e)>=0}),WonderPushSDK._protected.RunModes.registerBehavior("Manifest",function(e){return[WonderPushSDK._protected.RunModes.Modes.WebSite,WonderPushSDK._protected.RunModes.Modes.Popup,WonderPushSDK._protected.RunModes.Modes.Frame].indexOf(e)>=0}),WonderPushSDK._protected.RunModes.registerBehavior("Stylesheets",function(){return WonderPushSDK._protected.RunModes.Behaviors.Visible}),WonderPushSDK._protected.RunModes.registerBehavior("Modal",function(){return WonderPushSDK._protected.RunModes.Behaviors.Visible}),WonderPushSDK._protected.RunModes.registerBehavior("CustomProperties",function(e){return[WonderPushSDK._protected.RunModes.Modes.Frame,WonderPushSDK._protected.RunModes.Modes.ServiceWorker].indexOf(e)>=0}),WonderPushSDK._protected.RunModes.registerBehavior("NotificationPermission",function(e){return[WonderPushSDK._protected.RunModes.Modes.WebSite,WonderPushSDK._protected.RunModes.Modes.Popup].indexOf(e)>=0}),WonderPushSDK._protected.RunModes.registerBehavior("GeolocationPermission",function(e){return e===WonderPushSDK._protected.RunModes.Modes.WebSite}),WonderPushSDK._protected.RunModes.registerBehavior("RegisterServiceWorker",function(e){return[WonderPushSDK._protected.RunModes.Modes.Frame,WonderPushSDK._protected.RunModes.Modes.Popup].indexOf(e)>=0}),WonderPushSDK._protected.RunModes.registerBehavior("UnregisterServiceWorker",function(e){return e===WonderPushSDK._protected.RunModes.Modes.ServiceWorker||WonderPushSDK._protected.RunModes.Behaviors.RegisterServiceWorker}),WonderPushSDK._protected.RunModes.registerBehavior("RefreshPushToken",function(e){return WonderPushSDK._protected.RunModes.Behaviors.SubscribeToPush&&e!==WonderPushSDK._protected.RunModes.Modes.Popup}),WonderPushSDK._protected.RunModes.registerBehavior("SubscribeToPush",function(e){return WonderPushSDK._protected.RunModes.Behaviors.RegisterServiceWorker}),WonderPushSDK._protected.RunModes.registerBehavior("UnsubscribeToPush",function(e){return e===WonderPushSDK._protected.RunModes.Modes.ServiceWorker||WonderPushSDK._protected.RunModes.Behaviors.RegisterServiceWorker}),WonderPushSDK._protected.RunModes.registerBehavior("Locking",function(e){return[WonderPushSDK._protected.RunModes.Modes.Frame,WonderPushSDK._protected.RunModes.Modes.ServiceWorker,WonderPushSDK._protected.RunModes.Modes.Popup].indexOf(e)>=0}),WonderPushSDK._protected.RunModes.registerBehavior("OptionsSource",function(e){return e===WonderPushSDK._protected.RunModes.Modes.WebSite}),WonderPushSDK._protected.RunModes.registerBehavior("GetSubscriptionState",function(e){return e!==WonderPushSDK._protected.RunModes.Modes.WebSite}),WonderPushSDK._protected.RunModes.registerBehavior("Analytics",function(e){return!1}),WonderPushSDK._protected.RunModes.registerBehavior("ReadCurrentOrigin",function(e){return[WonderPushSDK._protected.RunModes.Modes.Frame,WonderPushSDK._protected.RunModes.Modes.Popup,WonderPushSDK._protected.RunModes.Modes.ServiceWorker,WonderPushSDK._protected.RunModes.Modes.Slave].indexOf(e)>=0})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){var e="[events      ]";WonderPushSDK._protected.Events=new function(){this.WonderPushNotificationOpenedEvent=function(e){return{event:e,name:WonderPushSDK._protected.Events.WonderPushNotificationOpenedEvent.TYPE,type:WonderPushSDK._protected.Events.WonderPushNotificationOpenedEvent.TYPE}},this.WonderPushNotificationOpenedEvent.TYPE="notificationOpened",this.WonderPushSessionEvent=function(e){return{name:WonderPushSDK._protected.Events.WonderPushSessionEvent.TYPE,type:WonderPushSDK._protected.Events.WonderPushSessionEvent.TYPE,state:e}},this.WonderPushSessionEvent.TYPE="session",this.WonderPushSubscriptionEvent=function(e){return{name:WonderPushSDK._protected.Events.WonderPushSubscriptionEvent.TYPE,type:WonderPushSDK._protected.Events.WonderPushSubscriptionEvent.TYPE,state:e}},this.WonderPushSubscriptionEvent.TYPE="subscription",this.NewAppOpen=function(e){return{type:WonderPushSDK._protected.Events.NewAppOpen.TYPE,visitCount:e}},this.NewAppOpen.TYPE="newAppOpen",this.NewPageView=function(e){return{type:WonderPushSDK._protected.Events.NewPageView.TYPE,pageViews:e}},this.NewPageView.TYPE="newPageView",this.fire=function(e){e.WonderPushSDK=WonderPushSDK.this,WonderPushSDK._protected.Helper.fireEvent(WonderPushSDK._protected.gscope,"WonderPushEvent",e)},this.listen=function(t){var n=self._wp_worker_addEventListener||function(e,t){WonderPushSDK._protected.Helper.listenEvent(WonderPushSDK._protected.gscope,e,t)};try{n("WonderPushEvent",t)}catch(t){console.warn(e,"Cannot listen to WonderPushEvent")}},this.unlisten=function(t){var n=self._wp_worker_removeEventListener||function(e,t){WonderPushSDK._protected.Helper.unlistenEvent(WonderPushSDK._protected.gscope,e,t)};try{n("WonderPushEvent",t)}catch(t){console.warn(e,"Cannot remove listener to WonderPushEvent")}}}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o,r;o=[n(31)],void 0===(r=function(e){return function(WonderPushSDK){var t=new WonderPushSDK._protected.Promise.Deferred,n=function(){if(WonderPushSDK._protected.RunModes.Behaviors.Stylesheets){const t=WonderPushSDK._protected.Options.getStylesheetUrl();t&&"wonderpush.min.css"!==t?WonderPushSDK._protected.Integration.injectStylesheetLink(t):WonderPushSDK._protected.Integration.injectStylesheetInline(e.toString())}if(i(),WonderPushSDK._protected.RunModes.Behaviors.ModeWebSite){var t=WonderPushSDK._protected.gscope._wp_loaderScriptUrl;if(t){delete WonderPushSDK._protected.gscope._wp_loaderScriptUrl;var n=(t.match(/by\.wonderpush\.com\/sdk\/([0-9\.]*)\//)||[])[1];n&&WonderPushSDK._protected.Integration.getFrameReadyPromise().then(function(){WonderPushSDK._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Storage.set",["sdkLoaderUrlVersion",n])})}}WonderPushSDK._protected.RunModes.Behaviors.ModeFrame&&WonderPushSDK._protected.Storage.set("sdkVersion",WonderPushSDK._protected.Constants.SDK_VERSION)},o=function(e){var t,n=WonderPushSDK._protected.Options.getCustomDomain()||("undefined"!=typeof registration?registration.scope:void 0)||location.origin;try{t=new URL(n)}catch(o){n.indexOf(".")<0&&"localhost"!==n&&(n+=WonderPushSDK._protected.Constants.DEFAULT_DOMAIN_SUFFIX),n.endsWith("/")||(n+="/"),n="full"===e?"https://"+n+WonderPushSDK._protected.Constants.PARTNER_DOMAIN_DEFAULT_URL_SUFFIX+WonderPushSDK._protected.Constants.SDK_VERSION+"/":"short"===e?"https://"+n+WonderPushSDK._protected.Constants.PARTNER_DOMAIN_DEFAULT_URL_SUFFIX+WonderPushSDK._protected.Constants.SDK_SHORT_VERSION+"/":"https://"+n+WonderPushSDK._protected.Constants.PARTNER_DOMAIN_DEFAULT_URL_SUFFIX,t=new URL(n)}return t.protocol="https:","/"!==t.href.slice(-1)&&(t=new URL(t.href+"/")),t},r=function(e){return o(e).href};WonderPushSDK._protected.Integration.getCurrentOperatingOrigin=function(){return WonderPushSDK._protected.RunModes.Behaviors.ReadCurrentOrigin?location.origin:null},WonderPushSDK._protected.Integration.getHomeUrlObject=function(){return o()},WonderPushSDK._protected.Integration.getServiceWorkerUrl=function(){var e=new URL(WonderPushSDK._protected.Options.getServiceWorkerUrl(),r("none"));return e.protocol="https:",e.href},WonderPushSDK._protected.Integration.getFrameUrl=function(){var e=new URL(WonderPushSDK._protected.Options.getFrameUrl(),r("full"));return e.protocol="https:",e.href},WonderPushSDK._protected.Integration.getRedirectionPageUrl=function(e){var t=new URL(WonderPushSDK._protected.Options.getRedirectionPageUrl(e),r("full"));return t.protocol="https:",t.href},WonderPushSDK._protected.Integration.getManifestInjectedPromise=function(){return t.promise};var i=function(){if(WonderPushSDK._protected.RunModes.Behaviors.Manifest&&!document.head.querySelector('link[rel=manifest][href^="'+WonderPushSDK._protected.Integration.getHomeOrigin()+'"]')){var e=document.createElement("link");e.rel="manifest",e.href=((n=new URL(WonderPushSDK._protected.Options.getManifestUrl(),r("full"))).protocol="https:",n.href),document.head.appendChild(e)}var n;t.resolve()};WonderPushSDK._protected.Integration.isOnFederatedDomain=function(){return location.origin===new URL(WonderPushSDK._protected.Constants.FEDERATED_FRAME_URL).origin},WonderPushSDK.preInstantiationPromise.then(function(){WonderPushSDK._protected.Integration.getModuleInitializationPromise().then(n)})}}.apply(t,o))||(e.exports=r)},function(e,t,n){(t=e.exports=n(0)(!1)).i(n(32),""),t.i(n(33),""),t.push([e.i,"\n",""])},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,"BODY.modal-open {\n  overflow: hidden;\n}\n\n.wp-modal {\n  z-index: 10000;\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background-color: rgba(0, 0, 0, 0.75);\n  overflow: auto;\n}\n\n.wp-modal > .wp-modal-wrapper-outer {\n  display: flex;\n  height: 100%;\n}\n\n.wp-modal > .wp-modal-wrapper-outer > .wp-modal-wrapper-inner {\n  margin: auto;\n  max-height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n.wp-modal > .wp-modal-wrapper-outer > .wp-modal-wrapper-inner > .wp-modal-block {\n  display: flex;\n  flex-direction: column;\n  max-width: 30em;\n  max-height: 50em;\n  border: 1px solid #E0E0E0;\n  border-radius: 2px;\n  box-shadow: 0 0.2em 2em black;\n  background-color: #FFF;\n  color: #333;\n  margin: 1em;\n}\n\n.wp-modal-block > .wp-modal-title {\n  border-bottom: 2px solid #10ACFF;\n  color: #10ACFF;\n  padding: 0.7em 0.6em;\n  line-height: 1.2em;\n  font-size: 125%;\n  flex-shrink: 0;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n}\n\n.wp-modal-title > .wp-modal-title-icon {\n  background-size: 2em 2em;\n  background-position: 50% 50%;\n  background-repeat: no-repeat;\n  width: 2em;\n  height: 2em;\n  flex-shrink: 0;\n  flex-grow: 0;\n  margin-right: 0.7em;\n}\n\n.wp-modal-title > .wp-modal-title-text {\n  flex-grow: 1;\n}\n\nwp-modal-block > .wp-modal-content {\n  overflow: auto;\n}\n\n.wp-modal-content > .wp-modal-text {\n  padding: 0.7em 0.6em;\n}\n\n.wp-modal-block > .wp-modal-buttons {\n  flex-shrink: 0;\n  display: flex;\n  flex-direction: row;\n  border-top: 1px solid #E0E0E0;\n}\n\n.wp-modal-buttons > .wp-modal-button {\n  flex: 1;\n  -moz-user-select: none;\n  border-right: 1px solid #E0E0E0;\n  cursor: pointer;\n  font-weight: normal;\n  line-height: 1.2em;\n  padding: 0.7em 0.6em;\n  text-align: center;\n  vertical-align: middle;\n  white-space: nowrap;\n}\n\n.wp-modal-buttons > .wp-modal-button:hover {\n  background-color: #f0f0f0;\n}\n\n.wp-modal-buttons > .wp-modal-button:last-child {\n  border-right: 0;\n}\n",""])},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".wp-popup {\n  position: absolute;\n  left: 0;\n  top: 0;\n  bottom: 0;\n  right: 0;\n  font-family: arial;\n  text-align: center;\n  padding-left: 10px;\n  padding-right: 10px;\n}\n.wp-popup .wp-popup-content {\n  display: flex;\n  flex-flow: column;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  margin: 0 auto;\n  max-width: 350px;\n  min-width: 231px;\n}\n.wp-popup .wp-popup-title {\n  font: bold 18px arial;\n  margin-bottom: 12px;\n}\n.wp-popup .wp-popup-message {\n  font: 15px arial;\n  color: #777;\n  margin-bottom: 25px;\n}\n.wp-popup .wp-popup-example {\n  background-color: #fff;\n  height: 80px;\n  box-shadow: 0 0 20px #888888;\n  margin-bottom: 20px;\n  flex-flow: row nowrap;\n  display: flex;\n  align-self: stretch;\n}\n\n/* When used inside the notification example */\n.wp-popup .wp-popup-example .wp-popup-icon {\n  flex-basis: 80px;\n  width: 80px;\n  height: 80px;\n  flex-grow: 0;\n  flex-shrink: 0;\n  background-color: #efefef;\n  background-size: contain;\n  background-repeat: no-repeat;\n  background-position: 50% 50%;\n}\n\n/* When used directly on the popup */\n.wp-popup #logo.wp-popup-icon {\n  background-size: contain;\n  background-repeat: no-repeat;\n  background-position: 50% 50%;\n}\n\n.wp-popup .wp-popup-example-text {\n  text-align: left;\n  flex: 1 auto;\n  padding: 10px 17px 8px 17px;\n  display: flex;\n  flex-flow: column nowrap;\n}\n.wp-popup .wp-popup-example-text>div {\n  flex: 0 auto;\n}\n\n.wp-popup .wp-popup-example-text .wp-popup-example-title {\n  font: 13px arial;\n  color: #3c3c3c;\n  margin-bottom: 5px;\n}\n.wp-popup .wp-popup-example-text .wp-popup-example-message {\n  flex-grow: 1;\n  font: 12px arial;\n  color: #3c3c3c;\n}\n.wp-popup .wp-popup-example-text .wp-popup-example-url {\n  font: 10px arial;\n  color: #9d9d9d;\n}\n.wp-popup .wp-popup-disclaimer {\n  font: 10px arial;\n  font-style: italic;\n  color: #b0b0b0;\n}\n",""])},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){var e=WonderPushSDK._protected.Consulate.createConsulate("federated");WonderPushSDK._protected.Federated=new function(){this.ensureSetup=function(){if(WonderPushSDK._protected.RunModes.Behaviors.ContextWindow){if(WonderPushSDK._protected.RunModes.Behaviors.ModeSlave,WonderPushSDK._protected.RunModes.Behaviors.Federated)throw new WonderPushSDK._protected.Errors.InternalWrongTargetError("Must not create a frame on federated domain from a frame on federated domain");if(!e.isSetup()){var n=WonderPushSDK._protected.Options.exportInitial(),o={_mode:WonderPushSDK._protected.RunModes.Modes.Slave};"debug"in n&&(o.debug=n.debug),e.setup(t(),o)}}},this.getReadyPromise=function(){return e.getReadyPromise()},this.call=function(t,n){return WonderPushSDK._protected.Federated.ensureSetup(),WonderPushSDK._protected.Federated.getReadyPromise().then(function(){return WonderPushSDK._protected.Integration.callOnSlave(e.getPostMessageTarget(),t,n)})};var t=function(){return WonderPushSDK._protected.Constants.FEDERATED_FRAME_URL}}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){WonderPushSDK._protected.Storage.getDatabaseName=function(){return WonderPushSDK._protected.RunModes.Behaviors.Federated?(WonderPushSDK._protected.Helper.debug("[storage     ]","using federated database"),"WP_federated"):"WP_"+WonderPushSDK._protected.Options.getWebKey()}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){WonderPushSDK.prototype.SessionState={INIT_FAILED:-1,INIT_UNSTARTED:0,INIT_INPROGRESS:1,INIT_SUCCESS:2},Object.freeze(WonderPushSDK.prototype.SessionState)}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){var e,t,n=[],o=Object.freeze({supportLevels:{optOut:{accessToken:!1,internalEvents:!1,customEvents:!1},optIn:{accessToken:!0,internalEvents:!0,customEvents:!1}}});e=function(){a(),WonderPushSDK._protected.Config.addConfigProcessor(function(e){t=e;var n=e.options||{},o=n.defaults||{},r=n.override||{};"string"==typeof WonderPushSDK._protected.Options.getNotificationIcon()&&"string"==typeof o.notificationIcon&&WonderPushSDK._protected.Options.getNotificationIcon().startsWith("http://")&&o.notificationIcon.startsWith("https://")&&(r.notificationIcon=o.notificationIcon)}),WonderPushSDK._protected.Blocker.category("accessToken").add("config"),WonderPushSDK._protected.Blocker.category("integration").add("config"),WonderPushSDK._protected.Config.getModuleInitializationPromise().then(function(){WonderPushSDK._protected.RunModes.Behaviors.AccessToken&&c(),WonderPushSDK._protected.Blocker.category("accessToken").remove("config"),WonderPushSDK._protected.Blocker.category("integration").remove("config")})};var r=function(){if(!WonderPushSDK._protected.Config.isConfigLoaded())throw new WonderPushSDK._protected.Errors.InternalConfigUnavailableError("Config not loaded yet");switch(WonderPushSDK.this.Notification.getSubscriptionState()){default:case WonderPushSDK.prototype.SubscriptionState.UNSUPPORTED:case WonderPushSDK.prototype.SubscriptionState.UNSUBSCRIBED:case WonderPushSDK.prototype.SubscriptionState.NOT_SUBSCRIBED:return"optOut";case WonderPushSDK.prototype.SubscriptionState.SUBSCRIBED:return"optIn"}},i=function(){var e=r();return(t.supportLevels||{})[e]||o.supportLevels[e]},a=function(){WonderPushSDK._protected.Events.listen(function(e){t&&"subscription"===(e.detail||{}).name&&s()})},s=function(){WonderPushSDK._protected.RunModes.Behaviors.AccessToken&&c()},c=function(){var e=i(),t=r(),n=[];e.accessToken||n.push("config_"+t+"_accessToken"),p(n)},p=function(e){var t;for(t=0;t<e.length;++t)n.indexOf(e[t])>=0||WonderPushSDK._protected.Blocker.category("accessToken").add(e[t]);for(t=0;t<n.length;++t)e.indexOf(n[t])>=0||WonderPushSDK._protected.Blocker.category("accessToken").remove(n[t]);n=e.slice()};WonderPushSDK._protected.Config.isEventAllowed=function(e){var t=i(),n="@"===e.charAt(0)?t.internalEvents||!0:t.customEvents||!1;return!0===n||!1===n?n:(n.indexOf("*")>=0||n.indexOf(e)>=0)&&n.indexOf("!"+e)<0},WonderPushSDK._protected.Config.getPluginsRegistry=function(){return t&&t.pluginsRegistry||{}},e()}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o,r;o=[n(2),n(3)],void 0===(r=function(e,t){return function(WonderPushSDK){var e,t=new WonderPushSDK._protected.Promise.Deferred;return WonderPushSDK._protected.Session=new function(){e=function(){WonderPushSDK.preInstantiationPromise.then(function(){WonderPushSDK._protected.Blocker.category("accessToken").add("currentSession"),Promise.all([WonderPushSDK._protected.Options.getModuleInitializationPromise(),WonderPushSDK._protected.Storage.getModuleInitializationPromise()]).then(function(){t.resolve(),WonderPushSDK._protected.Blocker.category("accessToken").remove("currentSession")})})},this.getModuleInitializationPromise=function(){return t.promise},this.listUsedUserIds=function(){return WonderPushSDK._protected.Storage.get("sessions",{}).then(function(e){return Object.keys(e).map(function(e){return""===e?null:e})})},this.getSession=function(e){return e||(e=""),WonderPushSDK._protected.Storage.get("sessions",{}).then(function(t){return t[e]?t[e]:{}})},this.getCurrentSession=function(){return WonderPushSDK._protected.Session.getSession(WonderPushSDK._protected.Options.getUserId()).then(function(e){return e})},this.deleteSession=function(e){return e||(e=""),WonderPushSDK._protected.Storage.get("sessions",{}).then(function(t){return delete t[e],WonderPushSDK._protected.Storage.set("sessions",t)})},this.setSession=function(e){return WonderPushSDK._protected.Storage.get("sessions",{}).then(function(t){return t[e.userId||""]=e,WonderPushSDK._protected.Storage.set("sessions",t)})},this.reset=function(){return WonderPushSDK._protected.Storage.rm("sessions")},this.serialize=function(){return WonderPushSDK._protected.Storage.get("sessions",{}).then(function(e){return JSON.stringify(e)})},this.deserialize=function(e){var t=JSON.parse(e||"{}");WonderPushSDK._protected.Storage.set("sessions",t)}},e(),t.promise}}.apply(t,o))||(e.exports=r)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t,n=new e._protected.Promise.Deferred;return e._protected.Config=new function(){var o=null,r=!1,i=e._protected.Constants.CONFIG_FETCH_MAX_TRIES;t=function(){e._protected.Blocker.category("ready").add("config"),e.preInstantiationPromise.then(function(){Promise.all([e._protected.Options.getModuleInitializationPromise(),e._protected.Storage.getModuleInitializationPromise()]).then(function(){a()})})},this.isConfigLoaded=function(){return!!o},this.getModuleInitializationPromise=function(){return n.promise};var a=function(){e._protected.Options.getWebKey()?e._protected.Storage.get("config",{}).then(function(t){if(t.json&&(!t.json.cacheTtl&&+new Date<t.date+e._protected.Constants.CONFIG_CACHE_DEFAULT_TTL||t.json.cacheTtl&&+new Date<t.date+t.json.cacheTtl))c._wp_delay(0)(t.json);else{var n=function(n){n?e._protected.Storage.set("config",{date:+new Date,json:n}).then(function(){c(n)}):t.json?(console.log("Could not fetch fresh config, using the cached one."),c(t.json)):console.log("Could not fetch fresh config. Please try again later.")},o=a._wp_delay(e._protected.Constants.CONFIG_FETCH_WAIT_BEFORE_RETRY_MS);if(i<=0)n(null);else if("onLine"in navigator&&!navigator.onLine)o();else if(r);else{r=!0,--i;var s,p=e._protected.Constants.CONFIG_URL_PATTERN;p=p.replace(/\${webkey}/,e._protected.Options.getWebKey());var u={onload:function(e){e&&e.json?e.json().then(n,function(e){console.log("Failed to parse config",e),n(null)}):n(this.responseJSON)},onerror:o,ontimeout:o,onabort:o,onloadend:function(){r=!1}};e._protected.Request.request("GET",p,s,s,s,u,s)}}}):c({})},s=[];this.addConfigProcessor=function(e){s.push(e)};var c=function(e){c=function(){},s.forEach(function(t){t(e)}),o=e,p()},p=function(){var t=o.options||{},r=t.defaults||{},i=t.override||{};e._protected.Options.merge(r,i),e._protected.Blocker.category("ready").remove("config"),n.resolve()};this.invalidateConfig=function(){return e._protected.Storage.bulk([{test:{key:"config",defaultValue:null,operationsCb:function(e){return e.date=0,{put:{key:"config",value:e}}}}}])}},t(),n.promise}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){WonderPushSDK.prototype.getSessionState=function(){return WonderPushSDK._protected.Init.getSessionState()},WonderPushSDK.prototype.getNotificationIcon=function(){return WonderPushSDK._protected.Options.getNotificationIcon()},WonderPushSDK.prototype.isNativePushNotificationSupported=function(){return WonderPushSDK._protected.Notification.isNativePushNotificationSupported()},WonderPushSDK.prototype.askNativePushNotificationPermission=function(){WonderPushSDK.prototype.setNotificationEnabled(!0).catch(function(e){console.warn(e)})},WonderPushSDK.prototype.unsubscribeFromPushNotification=function(){return WonderPushSDK.prototype.setNotificationEnabled(!1)},WonderPushSDK.prototype.isRegistrationInProgress=function(){return WonderPushSDK._protected.Notification.isRegistrationInProgress()},WonderPushSDK.prototype.setNotificationEnabled=function(e,t){return WonderPushSDK._protected.Notification.setNotificationEnabled(e,t)},WonderPushSDK.prototype.getNotificationEnabled=function(){return WonderPushSDK.prototype.Notification.getSubscriptionState()===WonderPushSDK.prototype.SubscriptionState.SUBSCRIBED};var e,t=function(e,t,n,o,r){if(WonderPushSDK._protected.Config.isEventAllowed(e)){var i={};t=t||{};var a={};for(var s in t)t.hasOwnProperty(s)&&(a[s]=t[s]);if(a.type=e,a.actionDate=a.actionDate||WonderPushSDK._protected.Time.getRealTime(),a.location=a.location||WonderPushSDK._protected.Geo.getGeolocation(),a.location||delete a.location,n&&"object"==typeof n&&(a.custom=n),i.body=JSON.stringify(a),r)return WonderPushSDK.this.Rest.postBeacon("/events/",i,o);WonderPushSDK.this.Rest.postEventually("/events/",i,void 0)}};WonderPushSDK.preInstantiationPromise.then(function(){return WonderPushSDK.prototype.getInitializationPromise()}).then(function(){return WonderPushSDK._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Session.getCurrentSession")}).then(function(t){e=t}),WonderPushSDK.prototype.trackEventOnUnload=function(n,o){return"string"!=typeof n||""===n||"@"===n.charAt(0)?Promise.reject(new WonderPushSDK.prototype.Errors.InvalidArgumentError("Bad event type")):t(n,null,o,e,!0)},WonderPushSDK.prototype.trackEvent=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.trackEvent",function(e,n){if("string"!=typeof e||""===e||"@"===e.charAt(0))throw new WonderPushSDK.prototype.Errors.InvalidArgumentError("Bad event type");t(e,null,n)}),WonderPushSDK._protected.trackEventWithInternalData=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.trackEventWithInternalData",function(e,n,o){if("string"!=typeof e||""===e||"@"===e.charAt(0))throw new WonderPushSDK.prototype.Errors.InvalidArgumentError("Bad event type");t(e,n,o)}),WonderPushSDK._protected.trackInternalEvent=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.trackInternalEvent",function(e,n,o){if("@"!==e.charAt(0))throw new WonderPushSDK.prototype.Errors.InvalidArgumentError("This method must only be called for internal events, starting with an '@'");t(e,n,o)}),WonderPushSDK.prototype.getUserId=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.getUserId",function(){return WonderPushSDK._protected.Session.getCurrentSession().then(function(e){return e.userId})}),WonderPushSDK.prototype.getInstallationId=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.getInstallationId",function(){return WonderPushSDK._protected.Session.getCurrentSession().then(function(e){return e.installationId})}),WonderPushSDK.prototype.getPushToken=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.getPushToken",function(){return WonderPushSDK._protected.Installation.getCachedInstallationPushToken()}),WonderPushSDK.prototype.getDeviceId=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.getDeviceId",function(){return WonderPushSDK._protected.Init.getDeviceId()}),WonderPushSDK.prototype.getInstallation=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.getInstallation",function(){return WonderPushSDK._protected.Helper.warn("WonderPush","WonderPushSDK.getInstallation() is deprecated. Please use WonderPushSDK.getInstallationCustomProperties()."),Promise.all([WonderPushSDK._protected.Session.getCurrentSession(),WonderPushSDK._protected.JsonSyncInstallationCustom.getInstallationCustomPropertiesForUser(WonderPushSDK._protected.Options.getUserId()),WonderPushSDK._protected.Init.getDeviceId(),WonderPushSDK._protected.Installation.getCachedInstallationPushToken()]).then(function(e){var t=e[0],n=e[1],o=e[2],r=e[3];return{id:t.installationId,userId:t.userId,device:{id:o},pushToken:{data:r},custom:n}})}),WonderPushSDK.prototype.getInstallationCustomProperties=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.getInstallationCustomProperties",function(){return WonderPushSDK._protected.JsonSyncInstallationCustom.getInstallationCustomPropertiesForUser(WonderPushSDK._protected.Options.getUserId())}),WonderPushSDK.prototype.putInstallationCustomProperties=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.putInstallationCustomProperties",function(e){return e?e instanceof Object?WonderPushSDK._protected.JsonSyncInstallationCustom.putInstallationCustomPropertiesForUser(WonderPushSDK._protected.Options.getUserId(),e):(console.error("WonderPushSDK.putInstallationCustomProperties() expects an object as argument, got ",e),Promise.reject(new WonderPushSDK.prototype.Errors.InvalidArgumentError("WonderPushSDK.putInstallationCustomProperties() expects an object as argument"))):Promise.resolve()}),WonderPushSDK.prototype.getAttendance=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.getAttendance",function(){return WonderPushSDK._protected.Storage.bulk([{get:{key:"visitPageViews",defaultValue:1}},{get:{key:"pageViews",defaultValue:1}},{get:{key:"visitCount",defaultValue:1}}]).then(function(e){var t={visitPageViews:e.results.byKey.visitPageViews,pageViews:e.results.byKey.pageViews,visitCount:e.results.byKey.visitCount};return t})}),WonderPushSDK._protected.onInteraction=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.onInteraction",function(e){return WonderPushSDK._protected.Storage.bulk([{get:{key:"lastInteractionDate",defaultValue:0}},{get:{key:"lastAppOpenDate",defaultValue:0}},{get:{key:"lastAppOpenInfoJson",defaultValue:{}}},{get:{key:"lastAppCloseDate",defaultValue:0}},{get:{key:"lastReceivedNotificationInfoJson",defaultValue:{}}},{get:{key:"lastOpenedNotificationInfoJson",defaultValue:{}}}]).then(function(t){var o=[],r=t.results.byKey,i=r.lastInteractionDate,a=r.lastAppOpenDate,s=r.lastAppOpenInfoJson,c=r.lastAppCloseDate,p=r.lastReceivedNotificationInfoJson.actionDate||Number.MAX_SAFE_INTEGER,u=r.lastOpenedNotificationInfoJson,d=u.actionDate||Number.MAX_SAFE_INTEGER,l=WonderPushSDK._protected.Time.getRealTime(),f=l-i>=WonderPushSDK._protected.Constants.DIFFERENT_SESSION_REGULAR_MIN_TIME_GAP||p>i&&l-i>=WonderPushSDK._protected.Constants.DIFFERENT_SESSION_NOTIFICATION_MIN_TIME_GAP;if(e)f||o.push(WonderPushSDK._protected.Storage.set("lastInteractionDate",l));else{if(f){if(c<a){var h=WonderPushSDK._protected.Helper.plainObjectCopy(s),g=i;h.actionDate=g,h.openedTime=g-a,o.push(WonderPushSDK._protected.Storage.set("lastAppCloseDate",g))}var _={};_.actionDate=l,p<=l&&(_.lastReceivedNotificationTime=l-p),l-d<6e4&&(_.notificationId=u.notificationId,_.campaignId=u.campaignId,o.push(WonderPushSDK._protected.Storage.rm("lastOpenedNotificationInfoJson"))),n(),o.push(WonderPushSDK._protected.Storage.set("lastAppOpenDate",l)),o.push(WonderPushSDK._protected.Storage.set("lastAppOpenInfoJson",_))}o.push(WonderPushSDK._protected.Storage.set("lastInteractionDate",l))}return WonderPushSDK._protected.ensureAppOpenSent(),Promise.all(o).then(function(){})})}),WonderPushSDK._protected.reportBeforeUnload=WonderPushSDK._protected.Integration.proxifyToServiceWorker("WonderPushSDK._protected.reportBeforeUnload",function(){const e=new WonderPushSDK._protected.Promise.Deferred;return setTimeout(()=>{self.clients.matchAll({includeUncontrolled:!0,type:"window"}).then(t=>{t.length||WonderPushSDK._protected.extendPresence(0,{force:!0,autoRenew:!1}),e.resolve()})},5e3),e.promise}),WonderPushSDK._protected.extendPresence=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.extendPresence",function(e,t={}){return self.isSecureContext?WonderPushSDK._protected.Storage.bulk([{test:{key:"lastPresenceInfo",defaultValue:{},operationsCb:function(n){const o=new Date,r=n.untilDate?n.untilDate-o.getTime():0;if(!t.force&&r>WonderPushSDK._protected.Constants.PRESENCE_UPDATE_SAFETY_MARGIN){const n=r-WonderPushSDK._protected.Constants.PRESENCE_UPDATE_SAFETY_MARGIN;return void setTimeout(()=>WonderPushSDK._protected.extendPresence(e,t),n)}let i;i=r<0?o:n.fromDate?new Date(n.fromDate):o;const a=new Date(o.getTime()+e),s={fromDate:i.getTime(),untilDate:a.getTime(),elapsedTime:a.getTime()-i.getTime()};if(WonderPushSDK._protected.trackInternalEvent("@PRESENCE",{presence:s}),t.autoRenew){const n=e-WonderPushSDK._protected.Constants.PRESENCE_UPDATE_SAFETY_MARGIN;setTimeout(()=>WonderPushSDK._protected.extendPresence(e,t),n)}return[{put:{key:"lastPresenceInfo",value:s}}]}}}]):Promise.resolve()}),WonderPushSDK._protected.ensureAppOpenSent=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.ensureAppOpenSent",function(){return WonderPushSDK.prototype.getInitializationPromise().then(function(){return WonderPushSDK._protected.Storage.bulk([{test:{key:"lastAppOpenDate",defaultValue:0,operationsCb:function(e){return[{test:{key:"lastAppOpenSentDate",defaultValue:0,operationsCb:function(t){if(t<e)return[{test:{key:"lastAppOpenInfoJson",operationsCb:function(t){const n=new Date,o=WonderPushSDK._protected.Constants.PRESENCE_ANTICIPATED_TIME_MS,r=self.isSecureContext?{fromDate:n.getTime(),elapsedTime:o,untilDate:new Date(n.getTime()+o).getTime()}:{},i=Object.assign({},t,{presence:r});WonderPushSDK._protected.trackInternalEvent("@APP_OPEN",i);const a=[{put:{key:"lastAppOpenSentDate",value:e}}];return self.isSecureContext&&a.push({put:{key:"lastPresenceInfo",value:r}}),a}}}]}}}]}}}])}).catch(function(e){}).then(function(){WonderPushSDK._protected.extendPresence(WonderPushSDK._protected.Constants.PRESENCE_ANTICIPATED_TIME_MS,{autoRenew:!0})})}),WonderPushSDK.prototype.newPageLoaded=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.newPageLoaded",function(){WonderPushSDK._protected.onInteraction(!1),WonderPushSDK._protected.Integration.incrementPageViews()}),WonderPushSDK.prototype.newUserInteraction=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.newUserInteraction",function(){WonderPushSDK._protected.onInteraction(!1)});var n=function(){WonderPushSDK._protected.Storage.getModuleInitializationPromise().then(function(){return WonderPushSDK._protected.Storage.bulk([{test:{key:"visitCount",defaultValue:0,operationsCb:function(e){return++e,{put:{key:"visitCount",value:e}}}}},{put:{key:"visitPageViews",value:1}}])})};return WonderPushSDK._protected.Config.getModuleInitializationPromise().then(function(){if(WonderPushSDK._protected.RunModes.Behaviors.ModeWebSite){var e=function(){WonderPushSDK._protected.onInteraction(!0)};return window.addEventListener("hashchange",function(){WonderPushSDK._protected.onInteraction(!1)}),window.addEventListener("beforeunload",e),window.addEventListener("unload",e),WonderPushSDK._protected.Storage.getModuleInitializationPromise().then(function(){return WonderPushSDK._protected.Storage.bulk([{test:{key:"visitPageViews",defaultValue:0,operationsCb:function(e){return{put:{key:"visitPageViews",value:++e}}}}}])}).catch(function(){}).then(function(){return WonderPushSDK._protected.onInteraction(!1)})}WonderPushSDK._protected.RunModes.Behaviors.ModeFrame&&window.isSecureContext&&window.addEventListener("beforeunload",()=>WonderPushSDK._protected.reportBeforeUnload())})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){var e=null,t=null,n=null;WonderPushSDK.prototype.Geo={},WonderPushSDK.prototype.Geo.useGeolocation=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.Geo.useGeolocation",function(t){WonderPushSDK._protected.Constants.GEOLOCATION_SUPPORTED&&o().then(function(n){"auto"===t&&(t="granted"===n),t?e||(e=navigator.geolocation.watchPosition(i,a,WonderPushSDK._protected.Constants.GEOLOCATION_OPTIONS),navigator.geolocation.getCurrentPosition(i,a,WonderPushSDK._protected.Constants.GEOLOCATION_OPTIONS_FIRST_FIX)):e&&(navigator.geolocation.clearWatch(e),e=void 0)})}),WonderPushSDK.prototype.Geo.fake=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.Geo.fake",function(e){e?"lat"in e&&"lon"in e&&(n={lat:e.lat,lon:e.lon}):n=null}),WonderPushSDK._protected.Geo={},WonderPushSDK._protected.Geo.getGeolocation=function(){return n?{lat:n.lat,lon:n.lon}:!t||new Date-t.timestamp>WonderPushSDK._protected.Constants.GEOLOCATION_MAXIMUM_AGE?null:{lat:t.coords.latitude,lon:t.coords.longitude}};var o=function(){return WonderPushSDK._protected.Storage.get("geolocationPermission","prompt")},r=function(e){return WonderPushSDK._protected.Storage.set("geolocationPermission",e)},i=function(e){r("granted"),!e||new Date-e.timestamp>WonderPushSDK._protected.Constants.GEOLOCATION_MAXIMUM_AGE||(!t||e.timestamp>t.timestamp)&&(t=e)},a=function(e){e.code===e.PERMISSION_DENIED&&(r("denied"),WonderPushSDK.prototype.Geo.useGeolocation(!1))};WonderPushSDK._protected.RunModes.Behaviors.GeolocationPermission&&WonderPushSDK._protected.Config.getModuleInitializationPromise().then(function(){WonderPushSDK.prototype.Geo.useGeolocation(WonderPushSDK._protected.Options.getGeolocation())})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o,r;o=[n(43)],void 0===(r=function(e){return function(WonderPushSDK){WonderPushSDK._protected.Installation={},WonderPushSDK._protected.Installation.updateInstallationCoreProperties=function(){return WonderPushSDK.prototype.getInitializationPromise().then(function(){return WonderPushSDK._protected.Session.getCurrentSession().then(function(e){return WonderPushSDK._protected.Installation.Profile.getCoreProperties().then(function(t){if(t)return WonderPushSDK._protected.Storage.bulk([{test:{key:"installationCoreProperties",defaultValue:null,operationsCb:function(n){if(!WonderPushSDK._protected.RunModes.Behaviors.ContextServiceWorker||null!==n){n=n||{date:0,json:"{}"};var o=JSON.parse(n.json),r={};if(WonderPushSDK._protected.RunModes.Behaviors.ContextServiceWorker&&WonderPushSDK._protected.Helper.mergeObjectInplaceRecursive(r,o),WonderPushSDK._protected.Helper.stripObject(t),WonderPushSDK._protected.Helper.mergeObjectInplaceRecursive(r,t),WonderPushSDK._protected.Helper.stripObject(r),!(WonderPushSDK._protected.JsonUtil.equal(r,o)&&n.userId===e.userId&&n.installationId===e.installationId&&+new Date<n.date+WonderPushSDK._protected.Constants.INSTALLATION_CORE_PROPERTIES_CACHE))return WonderPushSDK.this.Rest.postEventually("/installation",{body:JSON.stringify(r),overwrite:"false"}),{put:{key:"installationCoreProperties",value:{json:JSON.stringify(r),installationId:e.installationId,userId:e.userId,date:+new Date}}}}}}}])})})})},WonderPushSDK._protected.Installation.getInstallationFromServer=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.getInstallationFromServer",function(){return WonderPushSDK.this.getInitializationPromise().then(function(){var e=new WonderPushSDK._protected.Promise.Deferred,t=function(){e.reject()},n={onload:function(t){e.resolve(t&&t.json&&t.json()||this.responseJSON)},onerror:t,ontimeout:t,onabort:t};return WonderPushSDK.this.Rest.get("/installation",{},n,{}),e.promise})}),WonderPushSDK._protected.Installation.addInstallationPushToken=function(e,t){e=WonderPushSDK._protected.Helper.plainObjectCopy(e),WonderPushSDK._protected.Notification.getManuallyUnsubscribed().then(function(t){t||(e?WonderPushSDK._protected.Notification.setSubscriptionState(WonderPushSDK.prototype.SubscriptionState.SUBSCRIBED):WonderPushSDK._protected.Notification.setSubscriptionState(WonderPushSDK.prototype.SubscriptionState.NOT_SUBSCRIBED))});var n=!0,o=WonderPushSDK._protected.Integration.getCurrentOperatingOrigin(),r=null,i=null,a=null,s=null,c=null;return e?(r=e.subscriptionId&&-1===e.endpoint.indexOf(e.subscriptionId)?e.endpoint+"/"+e.subscriptionId:e.endpoint,"object"==typeof e.keys&&(i=e.keys.p256dh,a=e.keys.auth),"object"==typeof e.options&&(s=e.options.applicationServerKey,c=e.options.userVisibleOnly)):n=WonderPushSDK._protected.Blocker.category("accessToken").unblocked(),(n?WonderPushSDK.prototype.getInitializationPromise():Promise.resolve()).then(function(){return WonderPushSDK._protected.Session.getCurrentSession().then(function(e){return WonderPushSDK._protected.Storage.bulk([{test:{key:"pushTokenCache",defaultValue:{pushTokenOrigin:null,pushTokenData:null,pushTokenP256dh:null,pushTokenAuth:null,pushTokenApplicationServerKey:null,pushTokenUserVisibleOnly:null,userId:e.userId,installationId:e.installationId,date:+new Date},operationsCb:function(p){if(t||p.pushTokenOrigin!==o||p.pushTokenData!==r||p.pushTokenP256dh!==i||p.pushTokenAuth!==a||p.pushTokenApplicationServerKey!==s||p.pushTokenUserVisibleOnly!==c||p.userId!==e.userId||p.installationId!==e.installationId||!(+new Date<p.date+WonderPushSDK._protected.Constants.INSTALLATION_PUSH_TOKEN_CACHE))return n&&WonderPushSDK.this.Rest.postEventually("/installation",{body:JSON.stringify({pushToken:{origin:o,data:r,p256dh:i,auth:a,applicationServerKey:s,userVisibleOnly:c}})},void 0),{put:{key:"pushTokenCache",value:{pushTokenOrigin:o,pushTokenData:r,pushTokenP256dh:i,pushTokenAuth:a,pushTokenApplicationServerKey:s,pushTokenUserVisibleOnly:c,userId:e.userId,installationId:e.installationId,date:+new Date}}}}}}])})})},WonderPushSDK._protected.Installation.getCachedInstallationPushToken=function(){return WonderPushSDK._protected.Storage.get("pushTokenCache",{pushTokenData:null}).then(function(e){return e.pushTokenData})},WonderPushSDK._protected.Installation.removeInstallationPushToken=function(){WonderPushSDK._protected.Installation.addInstallationPushToken(null)},e(WonderPushSDK)}}.apply(t,o))||(e.exports=r)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){WonderPushSDK._protected.Installation.Profile={},WonderPushSDK._protected.Installation.Profile.getCoreProperties=function(){return Promise.all([WonderPushSDK._protected.Init.getFederatedDeviceId(),new Promise(function(e){return WonderPushSDK._protected.RunModes.Behaviors.ModeWebSite?e(WonderPushSDK._protected.Helper.getLocales()):WonderPushSDK._protected.RunModes.Behaviors.ModeFrame?e(WonderPushSDK._protected.Integration.callOnParentWindow("WonderPushSDK._protected.Helper.getLocales",[])):e([])}).then(function(e){return e[0]})]).then(function(e){var t=e[0],n=e[1];return t&&(t="0:"+t),{application:{version:WonderPushSDK._protected.Options.getApplicationVersion(),sdkVersion:WonderPushSDK.this.Constants.SDK_VERSION,domain:function(){if(!WonderPushSDK._protected.RunModes.Behaviors.ContextServiceWorker&&!WonderPushSDK._protected.RunModes.Behaviors.ModeSlave)return WonderPushSDK._protected.RunModes.Behaviors.ContextFrame||WonderPushSDK._protected.RunModes.Behaviors.ModePopup?new URL(document.referrer).hostname:location.hostname}()},device:{federatedId:t,osVersion:WonderPushSDK._protected.Helper.detectBrowser().version||null,brand:WonderPushSDK._protected.Helper.detectBrowser().name||null,model:navigator.userAgent,screenWidth:"undefined"!=typeof screen&&screen.width||void 0,screenHeight:"undefined"!=typeof screen&&screen.height||void 0,configuration:{timeZone:function(){var e;if(!e&&Intl){var t=Intl.DateTimeFormat();t&&t.resolvedOptions&&(e=t.resolvedOptions().timeZone)}if(!e){var n={GMT:"GMT",EAT:"Africa/Addis_Ababa",CET:"Africa/Algiers",WAT:"Africa/Kinshasa",CAT:"Africa/Lubumbashi","CEST CET":"Europe/Berlin",SAST:"Africa/Johannesburg",EET:"Africa/Tripoli","HADT HAST":"America/Adak","AKDT AKST":"America/Anchorage",BRT:"America/Bahia",ART:"America/Buenos_Aires",EST:"America/Panama",AMT:"America/Manaus","AMST AMT":"America/Campo_Grande",MST:"America/Phoenix","PDT PST":"America/Los_Angeles","EDT EST":"America/New_York",ACT:"America/Rio_Branco","ADT AST":"America/Halifax",PST:"America/Metlakatla",FNT:"America/Noronha","CLST CLT":"America/Santiago","BRST BRT":"America/Sao_Paulo","NDT NST":"America/St_Johns",AWST:"Australia/West","NZDT NZST":"Pacific/Auckland",AQTT:"Asia/Aqtobe",TMT:"Asia/Ashgabat",ICT:"Asia/Bangkok",IST:"Asia/Kolkata",BDT:"Asia/Dhaka",GST:"Asia/Dubai",HKT:"Asia/Hong_Kong",WIB:"Asia/Jakarta","IDT IST":"Asia/Jerusalem",XJT:"Asia/Urumqi",NPT:"Asia/Katmandu",YAKT:"Asia/Yakutsk",MYT:"Asia/Kuala_Lumpur",WITA:"Asia/Makassar",KST:"Asia/Seoul",UZT:"Asia/Tashkent",SGT:"Asia/Singapore","IRDT IRST":"Asia/Tehran",BTT:"Asia/Thimphu",JST:"Asia/Tokyo",ULAT:"Asia/Ulaanbaatar",VLAT:"Asia/Vladivostok","AEDT AEST":"Australia/Victoria","ACDT ACST":"Australia/South",AEST:"Australia/Queensland",ACST:"Australia/North","LHDT LHST":"Australia/Lord_Howe","EASST EAST":"Pacific/Easter","GMT IST":"Europe/Dublin",UCT:"Etc/UCT",UTC:"UTC","BST GMT":"Europe/London",MSK:"Europe/Moscow",HST:"Pacific/Honolulu",MHT:"Pacific/Majuro","CHADT CHAST":"Pacific/Chatham",CHUT:"Pacific/Chuuk",ChST:"Pacific/Guam",SST:"Pacific/Samoa",PONT:"Pacific/Pohnpei"},o=[["America/Mexico_City",1396771200,360,300],["America/Chicago",1394352e3,360,300],["America/Havana",1394341200,300,240],["America/Denver",1394355600,420,360],["America/Chihuahua",1396774800,420,360],["America/Puerto_Rico",1420070400,240,240],["Asia/Baghdad",1420070400,-180,-180],["America/Guatemala",1420070400,360,360],["Asia/Chongqing",1420070400,-480,-480],["Africa/Cairo",1400191200,-120,-180],["Asia/Gaza",1395957600,-120,-180],["Asia/Istanbul",1396227600,-120,-180],["Europe/Athens",1396141200,-120,-180],["Africa/Casablanca",1396144800,0,-60],["Europe/Lisbon",1396141200,0,-60]];e=function(){for(var e=[],t=0;t<12;++t){var r=new Date(2014,t).toString().replace(/^.*\((.+)\)$/,"$1");-1===e.indexOf(r)&&e.push(r)}var i=e.sort().join(" ");if(i in n)return n[i];for(var a=0;a<o.length;++a){var s=o[a];if(new Date(1e3*s[1]-1).getTimezoneOffset()===s[2]&&new Date(1e3*s[1]).getTimezoneOffset()===s[3])return s[0]}return null}()}return e}(),locale:n},capabilities:{touchscreen:!!navigator.maxTouchPoints,touchscreenTwoFingers:navigator.maxTouchPoints>=2,touchscreenFullHand:navigator.maxTouchPoints>=5}}}})}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){WonderPushSDK.prototype.SubscriptionState={UNSUPPORTED:-2,UNSUBSCRIBED:-1,UNDETERMINED:0,NOT_SUBSCRIBED:1,SUBSCRIBED:2},Object.freeze(WonderPushSDK.prototype.SubscriptionState)}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){var e="[notification]",t=new WonderPushSDK._protected.Promise.Deferred,n="undefined"!=typeof Notification,o=null;return WonderPushSDK.prototype.Notification=new function(){this.requestPopupToFinalizeRegistration=function(e){return WonderPushSDK._protected.Notification.setNotificationEnabled(!0)};var e={modalBoxIcon:null,modalBoxTitle:null,modalBoxMessage:"We will send you personalized notifications.<br/>You can always unsubscribe at any time.",modalBoxButton:"Got it!",modalBoxCancellable:!0,externalBoxWidth:500,externalBoxHeight:500,externalBoxLogoUrl:null,externalBoxLogoWidth:90,externalBoxLogoHeight:90,externalBoxProcessingMessage:"Subscribing...",externalBoxSuccessMessage:"Thanks for subscribing!",externalBoxFailureMessage:"Sorry, something went wrong.",externalBoxTooLongHint:"Poor connection or private browsing?",externalBoxCloseHint:"Close",externalBoxCloseDelay:WonderPushSDK._protected.Constants.POPUP_AUTOCLOSE_SLEEP};this.setOptInOptions=function(t){WonderPushSDK._protected.Helper.mergeObjectInplaceRecursive(e,t)},this.getOptInOptions=function(){var t=WonderPushSDK._protected.Helper.plainObjectCopy(e);return t&&"Inscription en cours..."===t.externalBoxProcessingMessage&&(t=WonderPushSDK._protected.Helper.assign({externalBoxMessage:"Nous aimerions vous envoyer des notifications",externalBoxExampleTitle:"Notification exemple",externalBoxExampleMessage:"Ceci est un exemple de notification",externalBoxDisclaimer:"Vous pouvez vous désinscrire à n'importe quel moment."},t)),t};var n=function(e){var t=document.createElement("DIV");return t.innerHTML=e,t.textContent},r={requestPopupToFinalizeRegistration_icon:null,requestPopupToFinalizeRegistration_title:null,requestPopupToFinalizeRegistration_text:null,requestPopupToFinalizeRegistration_buttonLabel:null,requestPopupToFinalizeRegistration_popupContent_processing:null,requestPopupToFinalizeRegistration_popupContent_success:null,requestPopupToFinalizeRegistration_popupContent_failure:null};Object.defineProperties(this,{requestPopupToFinalizeRegistration_icon:{set:function(e){WonderPushSDK.prototype.Notification.setOptInOptions({modalBoxIcon:e}),r.requestPopupToFinalizeRegistration_icon=e},get:function(){return r.requestPopupToFinalizeRegistration_icon}},requestPopupToFinalizeRegistration_title:{set:function(e){WonderPushSDK.prototype.Notification.setOptInOptions({modalBoxTitle:e}),r.requestPopupToFinalizeRegistration_title=e},get:function(){return r.requestPopupToFinalizeRegistration_title}},requestPopupToFinalizeRegistration_text:{set:function(e){WonderPushSDK.prototype.Notification.setOptInOptions({modalBoxMessage:e}),r.requestPopupToFinalizeRegistration_text=e},get:function(){return r.requestPopupToFinalizeRegistration_text}},requestPopupToFinalizeRegistration_buttonLabel:{set:function(e){WonderPushSDK.prototype.Notification.setOptInOptions({modalBoxButton:e}),r.requestPopupToFinalizeRegistration_buttonLabel=e},get:function(){return r.requestPopupToFinalizeRegistration_buttonLabel}},requestPopupToFinalizeRegistration_popupContent_processing:{set:function(e){WonderPushSDK.prototype.Notification.setOptInOptions({externalBoxProcessingMessage:n(e),externalBoxTooLongMessage:n(e)}),r.requestPopupToFinalizeRegistration_popupContent_processing=e},get:function(){return r.requestPopupToFinalizeRegistration_popupContent_processing}},requestPopupToFinalizeRegistration_popupContent_success:{set:function(e){WonderPushSDK.prototype.Notification.setOptInOptions({externalBoxSuccessMessage:n(e)}),r.requestPopupToFinalizeRegistration_popupContent_success=e},get:function(){return r.requestPopupToFinalizeRegistration_popupContent_success}},requestPopupToFinalizeRegistration_popupContent_failure:{set:function(e){WonderPushSDK.prototype.Notification.setOptInOptions({externalBoxFailureMessage:n(e)}),r.requestPopupToFinalizeRegistration_popupContent_failure=e},get:function(){return r.requestPopupToFinalizeRegistration_popupContent_failure}}}),WonderPushSDK._protected.RunModes.Behaviors.OptionsSource?WonderPushSDK._protected.Config.getModuleInitializationPromise().then(function(){WonderPushSDK.prototype.Notification.setOptInOptions({modalBoxIcon:WonderPushSDK._protected.Options.getNotificationIcon(),modalBoxTitle:WonderPushSDK._protected.Options.getApplicationName(),externalBoxLogoUrl:WonderPushSDK._protected.Options.getNotificationIcon()}),WonderPushSDK.prototype.Notification.setOptInOptions(WonderPushSDK._protected.Options.getOptInOptions()),r.requestPopupToFinalizeRegistration_icon=WonderPushSDK._protected.Options.getNotificationIcon(),r.requestPopupToFinalizeRegistration_title=WonderPushSDK._protected.Options.getApplicationName(),r.requestPopupToFinalizeRegistration_text="We will send you personalized notifications.<br/>You can always change your preferences later.",r.requestPopupToFinalizeRegistration_buttonLabel="Got it!",r.requestPopupToFinalizeRegistration_popupContent_processing='<div style="font-family: sans-serif; text-align: center;"><p><img id="logo" width="90" height="90" border="0" src="'+WonderPushSDK._protected.Options.getNotificationIcon()+'"/></p><p>Subscribing...</p></div>',r.requestPopupToFinalizeRegistration_popupContent_toolong='<div style="font-family: sans-serif; text-align: center;"><p><img id="logo" width="90" height="90" border="0" src="'+WonderPushSDK._protected.Options.getNotificationIcon()+'"/></p><p>Subscribing...</p><p><small>Poor connection or private browsing?</small></p></div>',r.requestPopupToFinalizeRegistration_popupContent_success='<div style="font-family: sans-serif; text-align: center;"><p><img id="logo" width="90" height="90" border="0" src="'+WonderPushSDK._protected.Options.getNotificationIcon()+'"/></p><p>Thanks for subscribing!</p><p><a href="#" onclick="javascript:window.close();"><small>Close</small></a></p></div>',r.requestPopupToFinalizeRegistration_popupContent_failure='<div style="font-family: sans-serif; text-align: center;"><p><img id="logo" width="90" height="90" border="0" src="'+WonderPushSDK._protected.Options.getNotificationIcon()+'"/></p><p>Sorry, something went wrong.</p><p><a href="#" onclick="javascript:window.close();"><small>Close</small></a></p></div>',t.resolve()}):t.resolve(),this.getSubscriptionState=function(){return o}},WonderPushSDK._protected.Notification=new function(){this.PERMISSION_GRANTED="granted",this.PERMISSION_DENIED="denied",this.PERMISSION_DEFAULT="default",this.PERMISSION_UNKNOWN="unknown",this.getModuleInitializationPromise=function(){return t.promise},this.getTrustedNotificationPermissionState=function(){var e=Notification.permission;if(!1===WonderPushSDK._protected.gscope.isSecureContext||WonderPushSDK._protected.gscope.window&&WonderPushSDK._protected.gscope.window!==WonderPushSDK._protected.gscope.window.parent){var t=WonderPushSDK._protected.Helper.detectBrowser();"Chrome"===t.name&&parseInt(t.version.substr(0,t.version.indexOf(".")))>=62&&e===WonderPushSDK._protected.Notification.PERMISSION_DENIED&&(e=WonderPushSDK._protected.Notification.PERMISSION_UNKNOWN)}return e},this.getTrustedOrCachedNotificationPermissionState=function(){var e=WonderPushSDK._protected.Notification.getTrustedNotificationPermissionState();return e===WonderPushSDK._protected.Notification.PERMISSION_UNKNOWN?WonderPushSDK._protected.Notification.getTrustedNotificationPermissionStateCached().then(function(e){var t=WonderPushSDK._protected.Notification.PERMISSION_UNKNOWN;return e.checkVersion>=2&&(t=e.permission),t}):Promise.resolve(e)},this.getTrustedNotificationPermissionStateCached=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Notification.getTrustedNotificationPermissionStateCached",function(){return WonderPushSDK._protected.Storage.get("notificationPermissionStateCached",{permission:WonderPushSDK._protected.Notification.PERMISSION_UNKNOWN,date:+new Date})}),this.updateTrustedNotificationPermissionCacheIfPossible=function(){var e=+new Date;if(!WonderPushSDK._protected.Integration.isOnRightDomain())return Promise.resolve(!1);var t=WonderPushSDK._protected.Notification.getTrustedNotificationPermissionState();if(t===WonderPushSDK._protected.Notification.PERMISSION_UNKNOWN)return Promise.resolve(!1);var n=WonderPushSDK._protected.Helper.detectBrowser(),o={permission:t,date:e,checkVersion:2,sdkVersion:WonderPushSDK.prototype.Constants.SDK_VERSION,browserName:n.name,browserVersion:n.version,browserVersionMajor:parseInt(n.version.substr(0,n.version.indexOf("."))),userAgent:navigator.userAgent,isSecureContext:WonderPushSDK._protected.gscope.isSecureContext,framed:WonderPushSDK._protected.gscope!==WonderPushSDK._protected.gscope.parent,origin:location.origin,runMode:WonderPushSDK._protected.RunModes.getCurrentModeNotForBehaviorTestingPurpose()},r=!1;return WonderPushSDK._protected.Storage.getModuleInitializationPromise().then(function(){return WonderPushSDK._protected.Storage.bulk([{test:{key:"notificationPermissionStateCached",defaultValue:{permission:null,date:0},operationsCb:function(e){if(!(o.date<e.date))return r=!0,{put:{key:"notificationPermissionStateCached",value:o}}}}}])}).catch(function(e){}).then(function(){return r})},this.refreshSubscriptionState=function(){WonderPushSDK._protected.RunModes.Behaviors.GetSubscriptionState&&(WonderPushSDK._protected.Notification.isNativePushNotificationSupported()?WonderPushSDK._protected.Notification.getManuallyUnsubscribed().then(function(e){e?WonderPushSDK._protected.Notification.setSubscriptionState(WonderPushSDK.prototype.SubscriptionState.UNSUBSCRIBED):(!WonderPushSDK._protected.RunModes.Behaviors.ContextServiceWorker&&navigator.serviceWorker&&navigator.serviceWorker.controller||WonderPushSDK._protected.Installation.getCachedInstallationPushToken().then(function(e){if(!e)return Promise.reject();WonderPushSDK._protected.Notification.setSubscriptionState(WonderPushSDK.prototype.SubscriptionState.SUBSCRIBED)},function(e){return Promise.reject()}).catch(function(){WonderPushSDK._protected.Notification.setSubscriptionState(WonderPushSDK.prototype.SubscriptionState.NOT_SUBSCRIBED)}),WonderPushSDK._protected.RunModes.Behaviors.ContextServiceWorker||WonderPushSDK._protected.ServiceWorkerClient.getPushSubscription().then(function(e){e?WonderPushSDK._protected.Notification.setSubscriptionState(WonderPushSDK.prototype.SubscriptionState.SUBSCRIBED):WonderPushSDK._protected.Notification.setSubscriptionState(WonderPushSDK.prototype.SubscriptionState.NOT_SUBSCRIBED)},function(e){}))}):WonderPushSDK._protected.Notification.setSubscriptionState(WonderPushSDK.prototype.SubscriptionState.UNSUPPORTED))},this.setSubscriptionState=function(e){var t=o;o=e,WonderPushSDK._protected.Blocker.category("ready").remove("refreshSubscriptionState"),t!==o&&(WonderPushSDK._protected.Events.fire(WonderPushSDK._protected.Events.WonderPushSubscriptionEvent(e)),WonderPushSDK._protected.RunModes.Behaviors.ModeFrame&&WonderPushSDK._protected.Notification.setSubscriptionStateOnParentWindow(e),WonderPushSDK._protected.RunModes.Behaviors.ModeServiceWorker?WonderPushSDK._protected.Notification.setSubscriptionStateOnServiceWorkerClients(e):WonderPushSDK._protected.RunModes.Behaviors.ModeFrame&&WonderPushSDK._protected.Helper.supportsServiceWorker()&&WonderPushSDK._protected.Notification.setSubscriptionStateOnServiceWorker(e))},this.setSubscriptionStateOnParentWindow=WonderPushSDK._protected.Integration.proxifyToParentWindow("WonderPushSDK._protected.Notification.setSubscriptionStateOnParentWindow",function(e){WonderPushSDK._protected.Notification.setSubscriptionState(e)}),this.setSubscriptionStateOnServiceWorker=WonderPushSDK._protected.Integration.proxifyToServiceWorker("WonderPushSDK._protected.Notification.setSubscriptionStateOnServiceWorker",function(e){WonderPushSDK._protected.Notification.refreshSubscriptionState()}),this.setSubscriptionStateOnServiceWorkerClients=WonderPushSDK._protected.Integration.proxifyToServiceWorkerClients("WonderPushSDK._protected.Notification.setSubscriptionStateOnServiceWorkerClients",function(e){WonderPushSDK._protected.Notification.setSubscriptionState(e)}),this.setManuallyUnsubscribed=function(e){return WonderPushSDK._protected.Notification.getManuallyUnsubscribed().then(function(t){if(!!e!=!!t)return WonderPushSDK.this.Rest.postEventually("/installation/",{body:JSON.stringify({preferences:{subscriptionStatus:e?"optOut":"optIn"}}),overwrite:"false"}),e?WonderPushSDK._protected.Storage.set("unsubscribed",!0).then(function(){WonderPushSDK._protected.Notification.setSubscriptionState(WonderPushSDK.prototype.SubscriptionState.UNSUBSCRIBED)}):WonderPushSDK._protected.Storage.rm("unsubscribed").then(function(){WonderPushSDK._protected.Notification.refreshSubscriptionState()})})},this.getManuallyUnsubscribed=function(){return WonderPushSDK._protected.Storage.get("unsubscribed",!1).then(function(e){return e=!!e})},this.isNativePushNotificationSupported=function(){var e=n&&WonderPushSDK._protected.Helper.supportsPushManager();return e},this.askPermission=function(){var e=new WonderPushSDK._protected.Promise.Deferred;return WonderPushSDK._protected.Notification.isNativePushNotificationSupported()?WonderPushSDK._protected.Integration.isOnRightDomain()?WonderPushSDK._protected.RunModes.Behaviors.NotificationPermission?(WonderPushSDK._protected.ServiceWorkerClient.registerServiceWorker(),Notification.requestPermission(function(t){WonderPushSDK._protected.Notification.updateTrustedNotificationPermissionCacheIfPossible().then(function(){return"denied"===(t=Notification.permission)?e.reject(new WonderPushSDK.prototype.Errors.PermissionError("User denied notification permission","notification",t)):"granted"!==t?e.reject(new WonderPushSDK.prototype.Errors.UserCancellationError("User neither granted or denied notification permission")):void e.resolve(t)})}),e.promise):(e.reject(new WonderPushSDK._protected.Errors.InternalWrongTargetError),e.promise):(e.reject(new WonderPushSDK._protected.Errors.InternalWrongDomainError),e.promise):(e.reject(new WonderPushSDK.prototype.Errors.PushNotificationsNotSupportedError),e.promise)},this.askPermissionAndRegisterInWindow=function(){var e,t,n=new WonderPushSDK._protected.Promise.Deferred;if(!WonderPushSDK._protected.Integration.isOnRightDomain())return n.reject(new WonderPushSDK._protected.Errors.InternalWrongDomainError),n.promise;WonderPushSDK._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Init.getFederatedDeviceId",[]);var o=function(n){e=+new Date,t=n},r=function(){WonderPushSDK._protected.Analytics.sendEvent("askPermissionAndRegisterInWindow",t,null,+new Date-e)};return o("setManuallyUnsubscribed"),WonderPushSDK._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Notification.setManuallyUnsubscribed",[!1]).then(function(){return r(),o("askPermission"),WonderPushSDK._protected.Notification.askPermission()}).then(function(e){return r(),o("registerForPushNotifications"),WonderPushSDK._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.ServiceWorkerClient.registerForPushNotifications")}).then(function(e){return r(),o("addInstallationPushToken"),WonderPushSDK._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Installation.addInstallationPushToken",[e])}).then(function(){r(),n.resolve()}).catch(function(o){WonderPushSDK._protected.Analytics.sendEvent("askPermissionAndRegisterInWindow",t+"-error",o&&o.name,+new Date-e),n.reject(o)}),n.promise},this.openPopupAskPermissionAndRegister=function(e){var t,n,o=new WonderPushSDK._protected.Promise.Deferred,r=WonderPushSDK._protected.Integration.getFrameUrl(),i=WonderPushSDK.prototype.Notification.getOptInOptions();WonderPushSDK._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Init.getFederatedDeviceId",[]);var a=function(e){t=+new Date,n=e},s=function(){WonderPushSDK._protected.Analytics.sendEvent("openPopupAskPermissionAndRegister",n,null,+new Date-t)};return a("openAndInitPopup"),WonderPushSDK._protected.Integration.openAndInitPopup(r,function(e){if(!e)return WonderPushSDK._protected.Analytics.sendEvent("openPopupAskPermissionAndRegister",n+"-error","popup "+JSON.stringify(e),+new Date-t),void(null===e?o.reject(new WonderPushSDK.prototype.Errors.PopupError("Cannot open popup")):!1===e?o.reject(new WonderPushSDK.prototype.Errors.PopupError("Cannot initialize popup")):o.reject(new WonderPushSDK.prototype.Errors.PopupError("Failed to use popup")));var r;s(),WonderPushSDK._protected.Integration.callOnPopupWindow(e,"WonderPushSDK._protected.Notification.getTrustedNotificationPermissionState").then(function(t){t!==WonderPushSDK._protected.Notification.PERMISSION_GRANTED&&WonderPushSDK._protected.PopupUI.presentPermissionUI(e)}),a("setManuallyUnsubscribed"),WonderPushSDK._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Notification.setManuallyUnsubscribed",[!1]).then(function(){return s(),a("askPermission"),WonderPushSDK._protected.Integration.callOnPopupWindow(e,"WonderPushSDK._protected.Notification.askPermission")}).then(function(t){return s(),WonderPushSDK._protected.PopupUI.presentProcessingUI(e),r=setTimeout(function(){WonderPushSDK._protected.Analytics.sendEvent("openPopupAskPermissionAndRegister","pushManagerSubscribeTooLong"),WonderPushSDK._protected.PopupUI.presentTimeoutUI(e)},WonderPushSDK._protected.Constants.PUSH_MANAGER_SUBSCRIBE_TOO_LONG),a("registerForPushNotifications"),WonderPushSDK._protected.Integration.callOnPopupWindow(e,"WonderPushSDK._protected.ServiceWorkerClient.registerForPushNotifications")}).then(function(t){void 0!==r&&clearTimeout(r),s();var n=t?WonderPushSDK.prototype.SubscriptionState.SUBSCRIBED:WonderPushSDK.prototype.SubscriptionState.NOT_SUBSCRIBED;return a("addInstallationPushToken"),WonderPushSDK._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Installation.addInstallationPushToken",[t]).then(function(){return s(),a("setSubscriptionStateOnServiceWorker"),WonderPushSDK._protected.Integration.callOnPopupWindow(e,"WonderPushSDK._protected.Integration.callOnServiceWorker",["WonderPushSDK._protected.Notification.setSubscriptionState",[n]])})}).then(function(){s(),WonderPushSDK._protected.PopupUI.presentSuccessUI(e),i.externalBoxCloseDelay>=0&&setTimeout(function(){e.close()},i.externalBoxCloseDelay),o.resolve()}).catch(function(r){WonderPushSDK._protected.Analytics.sendEvent("openPopupAskPermissionAndRegister",n+"-error",r&&r.name,+new Date-t),r instanceof WonderPushSDK.prototype.Errors.UserCancellationError?e.close():(WonderPushSDK._protected.PopupUI.presentFailureUI(e),i.externalBoxCloseDelay>=0&&setTimeout(function(){e.close()},i.externalBoxCloseDelay)),o.reject(r)})},{width:i.externalBoxWidth,height:i.externalBoxHeight,center:"window"}),o.promise},this.presentModal=function(e,t){var n=WonderPushSDK.prototype.Notification.getOptInOptions(),o={icon:n.modalBoxIcon,title:n.modalBoxTitle,text:n.modalBoxMessage,buttons:[{label:n.modalBoxButton,onclick:function(t,n){e(t)}}],cancellable:n.modalBoxCancellable,oncancel:function(e){t(new WonderPushSDK.prototype.Errors.UserCancellationError("Modal cancelled by user"))}};WonderPushSDK._protected.Modal.show(o)};var r=!1;this.isRegistrationInProgress=function(){return r},this.setNotificationEnabled=function(e,t){return r?Promise.reject(new WonderPushSDK.prototype.Errors.RegistrationInProgressError("Registration already in progress")):new Promise(function(n,o){var i=function(e){r=!1,o(e)},a=function(e){r=!1,n(e)},s=WonderPushSDK.prototype.Notification.getSubscriptionState();if(e&&s===WonderPushSDK.prototype.SubscriptionState.SUBSCRIBED)a();else if(e||s!==WonderPushSDK.prototype.SubscriptionState.UNSUBSCRIBED)if(e){r=!0;var c=WonderPushSDK._protected.Integration.isOnRightDomain();c&&!1!==WonderPushSDK._protected.gscope.isSecureContext?WonderPushSDK._protected.Notification.askPermissionAndRegisterInWindow().then(function(){a()},function(e){i(e)}):(c&&!1===WonderPushSDK._protected.gscope.isSecureContext&&WonderPushSDK._protected.Helper.warn("Although on custom domain (location.href =",WonderPushSDK._protected.gscope.location.href,"), isSecureContext is",WonderPushSDK._protected.gscope.isSecureContext),t?WonderPushSDK._protected.Notification.openPopupAskPermissionAndRegister(t).then(a,i):WonderPushSDK._protected.Notification.presentModal(function(e){WonderPushSDK._protected.Notification.openPopupAskPermissionAndRegister(e).then(a,i)},function(e){i(e)}))}else WonderPushSDK._protected.ServiceWorkerClient.unsubscribeFromPush().then(function(){a()},function(e){i(new WonderPushSDK._protected.Errors.InternalStorageError("Failed to store unsubscription"))});else a()})},this.handleActions=function(e,t){Array.isArray(t)&&t.forEach(function(t){try{if(!(t instanceof Object))return;switch(t.type){case WonderPushSDK._protected.Constants.ACTION_TRACK_EVENT:i(e,t);break;case WonderPushSDK._protected.Constants.ACTION_UPDATE_INSTALLATION:a(t);break;case WonderPushSDK._protected.Constants.ACTION_RESYNC_INSTALLATION:s(t);break;case WonderPushSDK._protected.Constants.ACTION__OVERRIDE_NOTIFICATION_RECEIPT:c(t);break;default:console.log("Unhandled action type ",t.type," for action ",t)}}catch(e){console.error("Unexpected error while handling action ",t,e)}})};var i=function(e,t){var n=t.event||{};WonderPushSDK._protected.trackEventWithInternalData(n.type,{campaignId:e._wp.c,notificationId:e._wp.n},n.custom)},a=function(e){var t=e.installation&&e.installation.custom?e.installation.custom:e.custom;t&&Object.keys(t).length&&(e.appliedServerSide?WonderPushSDK._protected.JsonSyncInstallationCustom.receiveDiffForUser(WonderPushSDK._protected.Options.getUserId(),t):WonderPushSDK._protected.JsonSyncInstallationCustom.putInstallationCustomPropertiesForUser(WonderPushSDK._protected.Options.getUserId(),t))},s=function(e){var t=function(e){var t=e.installation,n=t?t.custom:null;if(!n){if(!t)return;n={}}e.reset?WonderPushSDK._protected.JsonSyncInstallationCustom.receiveStateForUser(WonderPushSDK._protected.Options.getUserId(),n,!!e.force):WonderPushSDK._protected.JsonSyncInstallationCustom.receiveServerStateForUser(WonderPushSDK._protected.Options.getUserId(),n),WonderPushSDK._protected.Installation.updateInstallationCoreProperties(),WonderPushSDK._protected.ServiceWorker.resendPushToken(!0);var o={preferences:{subscriptionStatus:WonderPushSDK.prototype.Notification.getSubscriptionState()===WonderPushSDK.prototype.SubscriptionState.UNSUBSCRIBED?"optOut":"optIn"}};WonderPushSDK.this.Rest.post("/installation",{body:JSON.stringify(o),overwrite:!1})};e.installation?t(e):WonderPushSDK._protected.Installation.getInstallationFromServer().then(function(n){Object.keys(n).forEach(function(e){e.startsWith("_")&&delete n[e]}),e.installation=n,t(e)},function(e){})},c=function(t){var n=t.force;WonderPushSDK._protected.Helper.log(e,"OVERRIDE notification receipt:",n),WonderPushSDK._protected.Storage.set("_overrideNotificationReceipt",n)}},WonderPushSDK._protected.Integration.getModuleInitializationPromise().then(function(){WonderPushSDK._protected.Notification.updateTrustedNotificationPermissionCacheIfPossible()}),WonderPushSDK._protected.Blocker.category("ready").add("refreshSubscriptionState"),WonderPushSDK._protected.Integration.getModuleInitializationPromise().then(function(){WonderPushSDK._protected.RunModes.Behaviors.GetSubscriptionState&&WonderPushSDK._protected.Notification.refreshSubscriptionState()}),t.promise}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){if(WonderPushSDK._protected.RunModes.Behaviors.ContextServiceWorker&&WonderPushSDK._protected.Helper.supportsPushManager()){var e=WonderPushSDK._protected.gscope;WonderPushSDK._protected.ServiceWorker.resendPushToken=function(e){return WonderPushSDK.instantiationPromise.then(function(){return WonderPushSDK.prototype.getInitializationPromise().then(function(){WonderPushSDK._protected.ServiceWorkerClient.getPushSubscriptionFromServiceWorker().then(function(t){WonderPushSDK._protected.Installation.addInstallationPushToken(t,e)},function(e){})})})},WonderPushSDK._protected.ServiceWorker.checkForCustomDomainChange=function(){return WonderPushSDK.instantiationPromise.then(function(){return WonderPushSDK.prototype.getInitializationPromise().then(function(){var e=WonderPushSDK._protected.Integration.getCurrentOperatingOrigin(),t=WonderPushSDK._protected.Integration.getHomeOrigin();e!==t&&Promise.all([WonderPushSDK._protected.Init.getDeviceId(),WonderPushSDK._protected.Init.getFederatedDeviceId(),WonderPushSDK._protected.Storage.get("customDomainMigrationInfo")]).then(function(e){var t=e[0],n=e[1],o=e[2]||{};t===n||o.deviceId===t&&o.federatedDeviceId===n||(WonderPushSDK._protected.trackInternalEvent("@WEB_CUSTOM_DOMAIN_MIGRATION"),o.deviceId=t,o.federatedDeviceId=n,o.eventDate=+new Date,WonderPushSDK._protected.Storage.set("customDomainMigrationInfo",o))})})})};var t=function(e){var t;if("data"in e&&e.data&&"object"==typeof e.data&&"json"in e.data){var n;try{n=e.data.json()}catch(t){console.error("Failed to read push data as json",t);try{console.warn("push data as text:",e.data.text())}catch(e){}}n&&"object"==typeof n&&("_wp"in n?t=Promise.resolve(n):n.data&&"object"==typeof n.data&&"_wp"in n.data&&(t=Promise.resolve(n.data))),t||(console.error("Failed to find the data in the PushEvent!"),t=Promise.reject())}else{var i=function(e,t){var n=(t=t||0)?WonderPushSDK._protected.Constants.GET_DELIVERIES_ERROR_WAIT_MS:0;return n+=WonderPushSDK._protected.Constants.GET_DELIVERIES_RANDOM_WAIT_MIN_MS+Math.random()*(WonderPushSDK._protected.Constants.GET_DELIVERIES_RANDOM_WAIT_MAX_MS-WonderPushSDK._protected.Constants.GET_DELIVERIES_RANDOM_WAIT_MIN_MS),WonderPushSDK._protected.Promise.DelayedStartPromise(function(e,t){WonderPushSDK.this.Rest.fetch("GET","/deliveries",{status:"pending"}).then(e,t)},n).then(function(e){if(200!==e.status)throw console.error("Failed to fetch last notification, got status ",e.status,e.statusText,":",e),e;return e},function(e){throw e.status&&e.statusText?console.error("Failed to fetch last notification, got status ",e.status,e.statusText,":",e):console.error("Failed to fetch last notification:",e),e}).catch(function(n){if(e>0)return console.log("Will retry"),i(e-1,t+1);throw n})};t=WonderPushSDK.this.getInitializationPromise().then(function(){return i(WonderPushSDK._protected.Constants.GET_DELIVERIES_TRIES-1)}).then(function(e){return e.json().then(function(e){if(e.deliveries.length>0)return e.deliveries[e.deliveries.length-1].data;throw new WonderPushSDK.prototype.Errors.NotificationPayloadError("No received notification")})})}return t.then(function(e){if(e)return e._wp&&e._wp.receiveActions&&WonderPushSDK._protected.Notification.handleActions(e,e._wp.receiveActions),o(e).then(function(){r(e)});console.error("Got empty notification!")},function(e){console.error("Failed to display a notification",e)})},n=function(e){return console.log("pushsubscriptionchange event",e),e.newSubscription?WonderPushSDK._protected.Installation.addInstallationPushToken(e.newSubscription):WonderPushSDK._protected.ServiceWorkerClient.refreshPushToken(registration).then(function(e){console.log("Push subscription renewed",e)},function(e){throw console.error("Failed to renew push subscription during the handling of a pushsubscriptionchange event",e),e})},o=function(t){var n=t._wp||{},o=n.alert||{},r=o.title||t.alertTitle||WonderPushSDK._protected.Options.getApplicationName(),i=WonderPushSDK._protected.Helper.plainObjectCopy(o);delete i.title,delete i.data,void 0!==i.body&&null!==i.body||(i.body=t.alert),void 0!==i.requireInteraction&&null!==i.requireInteraction||(i.requireInteraction=!0),i.icon||(i.icon=WonderPushSDK._protected.Options.getNotificationIcon());var a=WonderPushSDK._protected.Helper.detectBrowser();if("Chrome"===a.name&&"Macintosh"===a.platform&&parseInt(a.version)>=59){if(WonderPushSDK._protected.Integration.getHomeOrigin().endsWith(WonderPushSDK._protected.Constants.DEFAULT_DOMAIN_SUFFIX)){var s=[];r&&r!==WonderPushSDK._protected.Options.getApplicationName()&&s.push(r),r=WonderPushSDK._protected.Options.getApplicationName(),i.body&&s.push(i.body),s.length>0?i.body=s.join(" - "):delete i.body}i.image&&(i.icon=i.image,delete i.image)}return i.image&&!Notification.prototype.hasOwnProperty("image")&&(i.icon=i.image,delete i.image),i.icon&&navigator.userAgent.indexOf("Linux")>=0&&"Firefox"===a.name&&parseInt(a.version)<50&&delete i.icon,Notification.prototype.hasOwnProperty("data")?(i.data=t,null===i.tag?delete i.tag:"tag"in o||(i.tag=n.c)):i.tag=JSON.stringify(t),e.registration.showNotification(r,i).then(function(e){},function(e){})},r=function(e){var t={actionDate:WonderPushSDK._protected.Time.getRealTime(),campaignId:(e._wp||{}).c,notificationId:(e._wp||{}).n};WonderPushSDK._protected.Storage.set("lastReceivedNotificationInfoJson",t);var n=(e._wp||{}).receipt;return WonderPushSDK._protected.Storage.bulk([{get:{key:"pushTokenCache",defaultValue:{}}},{get:{key:"_overrideNotificationReceipt",defaultValue:null}}]).then(function(e){var o=e.results.byKey.pushTokenCache,r=e.results.byKey._overrideNotificationReceipt;void 0!==r&&null!==r&&(n=r),o.pushTokenP256dh&&o.pushTokenAuth||(n=!0),n&&WonderPushSDK._protected.trackInternalEvent("@NOTIFICATION_RECEIVED",t)}),e},i=function(t){return new Promise(function(n,o){var r;if(t.notification.tag,Notification.prototype.hasOwnProperty("data"))r=t.notification.data;else try{r=JSON.parse(t.notification.tag)}catch(e){}r&&"object"==typeof r||(r={});var i,c=r._wp||{},p=c.targetUrl,u=c.actions,d=c.locationFilter,l=(c.alert||{}).actions||[];"string"==typeof t.action&&(i=l.filter(function(e){return e&&"object"==typeof e&&e.action===t.action})[0]),i&&(p=i.targetUrl||p,d=i.locationFilter||d,u=i.actions||u),t.notification.close();var f={actionDate:WonderPushSDK._protected.Time.getRealTime(),campaignId:(c||{}).c,notificationId:(c||{}).n};if(i&&(f.buttonLabel=i.title),WonderPushSDK._protected.Storage.set("lastOpenedNotificationInfoJson",f),WonderPushSDK._protected.trackInternalEvent("@NOTIFICATION_OPENED",f),WonderPushSDK._protected.Notification.handleActions(r,u),p&&p.startsWith("wonderpush://")){if("wonderpush://notificationOpen/noop"===p)return;if("wonderpush://notificationOpen/broadcast"===p)return void WonderPushSDK._protected.Events.fire(WonderPushSDK._protected.Events.WonderPushNotificationOpenedEvent(t));p=void 0}clients.matchAll({type:"window"}).then(function(t){var n=new RegExp((d||{}).regex||"^"+WonderPushSDK._protected.Helper.escapeRegExp("string"==typeof d?d:new URL(p||WonderPushSDK._protected.Options.getDefaultNotificationUrl()||e.registration.scope,e.registration.scope).href),(d||{}).flags);return t=t.filter(function(e){return!!e.url.match(n)})}).then(function(e){var t=e;return e.some(function(e){return!!e.focused&&(t=[e],!0)}),t}).then(function(e){return e.length<2?e:Promise._wp_allTimeout(e.map(function(e){return new Promise(function(t,n){var o=new MessageChannel;o.port2.onmessage=function(e){var n=e.data&&"getLastFocusTimestamp"===e.data.type?e.data.data:0;t(n)},e.postMessage({sdk:WonderPushSDK._protected.sdkName,type:"getLastFocusTimestamp"},[o.port1])})}),WonderPushSDK._protected.Constants.SW_PING_TIMEOUT_MS,0).then(function(t){var n=-1,o=0;return t.forEach(function(e,t){e>o&&(n=t,o=e)}),n<0?[]:[e[n]]})}).then(function(e){if(e<1)return Promise.reject();s(e[0],r,"Sending notification to the most recently focused client").then(n)}).catch(function(){a(r,p).then(n,o)})})},a=function(t,n){return clients.openWindow?(n=n||WonderPushSDK._protected.Options.getDefaultNotificationUrl()||e.registration.scope,clients.openWindow(n).catch(function(e){if(e.code===e.SECURITY_ERR){var t=WonderPushSDK._protected.Integration.getRedirectionPageUrl(n);return clients.openWindow(t.href)}}).then(function(e){if(e){var n,o=new Promise(function(e,t){n=e})._wp_timeout(WonderPushSDK._protected.Constants.SW_MAX_PAGELOAD_MS);o.then(function(){return s(e,t,"Sending notification to new client")},function(){console.log("Waited "+WonderPushSDK._protected.Constants.SW_MAX_PAGELOAD_MS/1e3+"s for the newly opened window to be ready before sending it the clicked notification, aborting. (Normal if opening an external website.)")});return WonderPushSDK._protected.Promise.setIntervalUntilSettled(o,function(){var t=new MessageChannel;t.port2.onmessage=n,e.postMessage({type:"ping",sdk:WonderPushSDK._protected.sdkName},[t.port1])},WonderPushSDK._protected.Constants.SW_CHECK_PAGELOADED_INTERVAL_MS,!0),o}})):Promise.reject(new WonderPushSDK.prototype.Errors.InternalError("Cannot open new client window to display notification"))},s=function(e,t,n){var o=function(){n&&console.log(n),e.postMessage({sdk:WonderPushSDK._protected.sdkName,type:"nativeNotificationOpen",data:t})};return e.focus().then(o,o)};WonderPushSDK._protected.ServiceWorker.addEventListener("install",function(t){return WonderPushSDK.instantiationPromise.then(function(){return e.skipWaiting()})}),WonderPushSDK._protected.ServiceWorker.addEventListener("activate",function(t){return e.clients.claim()}),WonderPushSDK._protected.ServiceWorker.addEventListener("push",function(e){return WonderPushSDK.instantiationPromise.then(function(){return t(e)})}),WonderPushSDK._protected.ServiceWorker.addEventListener("pushsubscriptionchange",function(e){return WonderPushSDK.instantiationPromise.then(function(){return n(e)})}),WonderPushSDK._protected.ServiceWorker.addEventListener("notificationclick",function(e){return WonderPushSDK.instantiationPromise.then(function(){return i(e)})}),WonderPushSDK._protected.ServiceWorker.resendPushToken(),WonderPushSDK._protected.ServiceWorker.checkForCustomDomainChange()}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){var e,t,n="[sw-client   ]";e=function(){WonderPushSDK._protected.Integration.getModuleInitializationPromise().then(function(){WonderPushSDK._protected.RunModes.Behaviors.ModeWebSite&&o(),WonderPushSDK._protected.RunModes.Behaviors.RegisterServiceWorker&&WonderPushSDK._protected.Helper.supportsServiceWorker()&&WonderPushSDK._protected.Helper.supportsPushManager()&&"https:"===location.protocol&&WonderPushSDK.instantiationPromise.then(function(){r()})})};var o=function(){addEventListener("focus",a),document.hasFocus()&&a()},r=function(){WonderPushSDK._protected.Notification.getTrustedOrCachedNotificationPermissionState().then(function(e){e===WonderPushSDK._protected.Notification.PERMISSION_GRANTED&&WonderPushSDK._protected.ServiceWorkerClient.registerServiceWorker().then(function(e){return WonderPushSDK._protected.Notification.getManuallyUnsubscribed().then(function(t){!t&&WonderPushSDK._protected.RunModes.Behaviors.RefreshPushToken&&WonderPushSDK._protected.ServiceWorkerClient.refreshPushToken(e).then(function(){},function(e){})})})})};WonderPushSDK._protected.ServiceWorkerClient.refreshPushToken=function(e){WonderPushSDK._protected.gscope.isSecureContext;var t=WonderPushSDK._protected.Notification.getTrustedNotificationPermissionState();return t!==WonderPushSDK._protected.Notification.PERMISSION_GRANTED?(t!==WonderPushSDK._protected.Notification.PERMISSION_UNKNOWN&&WonderPushSDK._protected.Installation.removeInstallationPushToken(),Promise.reject(new WonderPushSDK.prototype.Errors.PermissionError("Notification permission is not granted","notification",t))):WonderPushSDK._protected.Integration.getManifestInjectedPromise().then(function(){return i(e)}).then(function(e){return e?(WonderPushSDK._protected.Installation.addInstallationPushToken(e),e):Promise.reject(new WonderPushSDK.prototype.Errors.InternalError("Could not get push token"))}).catch(function(e){throw e})};var i=function(e){if(!e||!e.pushManager)return Promise.reject(new WonderPushSDK.prototype.Errors.InvalidArgumentError("No valid registration given"));if(!e.active&&navigator.serviceWorker)return navigator.serviceWorker.ready.then(i);var t={userVisibleOnly:!0},n=2*WonderPushSDK._protected.Constants.PUSH_MANAGER_SUBSCRIBE_TOO_LONG,o=3*WonderPushSDK._protected.Constants.PUSH_MANAGER_SUBSCRIBE_TOO_LONG,r=new WonderPushSDK._protected.Locking.ExpiringUnfairNamedGlobalMutex("pushManager.subscribe",n),a=+new Date;return r.acquire({interval:500,timeout:o}).then(function(){var n=!1;return setTimeout(function(){n||console.warn("Subscribing to push notifications seems to take too long… Are you on a slow network or using private browsing?")},WonderPushSDK._protected.Constants.PUSH_MANAGER_SUBSCRIBE_TOO_LONG),e.pushManager.subscribe(t).then(function(e){return WonderPushSDK._protected.Analytics.sendEvent("serviceWorkerClient","subscribeAppropriately",null,+new Date-a),e},function(e){var t="";throw e&&(e.name&&(t+=e.name),e.message&&(t+=": "+e.message)),WonderPushSDK._protected.Analytics.sendEvent("serviceWorkerClient","subscribeAppropriately-error",t,+new Date-a),e})._wp_do(function(){n=!0,r.release()})},function(e){throw e})};WonderPushSDK._protected.ServiceWorkerClient.registerForPushNotifications=function(){return WonderPushSDK._protected.Integration.isOnRightDomain()?(!1===WonderPushSDK._protected.gscope.isSecureContext&&WonderPushSDK._protected.Helper.log(n,"[registerForPushNotifications] isSecureContext=false, likely because of opener, continuing anyway"),WonderPushSDK._protected.RunModes.Behaviors.ContextServiceWorker?Promise.reject(new WonderPushSDK._protected.Errors.InternalWrongTargetError):"granted"!==Notification.permission?Promise.reject(new WonderPushSDK.prototype.Errors.PermissionError("registerForPushNotifications called without permission granted")):navigator.serviceWorker?navigator.serviceWorker.ready.then(function(e){return i(e)}).then(function(e){return e}).catch(function(e){throw e}):new Promise((e,t)=>{})):Promise.reject(new WonderPushSDK._protected.Errors.InternalWrongDomainError)},WonderPushSDK._protected.ServiceWorkerClient.unsubscribeFromPush=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.ServiceWorkerClient.unsubscribeFromPush",function(){return WonderPushSDK._protected.Notification.setManuallyUnsubscribed(!0).then(function(){return!0}).catch(function(){return!1})});var a=function(){WonderPushSDK._protected.ServiceWorkerClient._focusHandlerCalled()};WonderPushSDK._protected.ServiceWorkerClient._focusHandlerCalled=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.ServiceWorkerClient._focusHandlerCalled",function(){t=+new Date}),WonderPushSDK._protected.ServiceWorkerClient.addMessageEventListener(function(e){if(("undefined"==typeof ServiceWorkerMessageEvent||e instanceof ServiceWorkerMessageEvent)&&e.data instanceof Object&&e.data.sdk===WonderPushSDK._protected.sdkName)switch(e.data.type){case"getLastFocusTimestamp":"ports"in e&&e.ports.length>0&&e.ports[0].postMessage({type:"getLastFocusTimestamp",data:t});break;case"nativeNotificationOpen":var n=((e.data||{}).data||{})._wp||{};n.targetUrl&&(n.targetUrl.startsWith("wonderpush://")||window.location.href===n.targetUrl||(window.location=n.targetUrl))}}),e()}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){WonderPushSDK._protected.Modal=new function(){var e=null,t=function(e,t){t instanceof Node?e.appendChild(t):t&&(e.innerHTML=t)};this.show=WonderPushSDK._protected.Integration.proxifyToParentWindow("WonderPushSDK._protected.Modal.show",function(n){if(WonderPushSDK._protected.RunModes.Behaviors.Visible&&(n=n||{},!e)){modal=document.createElement("div"),modal.classList.add("wp-modal");var o=document.createElement("div");o.classList.add("wp-modal-wrapper-outer"),!1!==n.cancellable&&o.addEventListener("click",function(e){e.target===o&&("function"==typeof n.oncancel&&n.oncancel.call(this,e),WonderPushSDK._protected.Modal.close())}),modal.appendChild(o);var r=document.createElement("div");r.classList.add("wp-modal-wrapper-inner"),o.appendChild(r);var i=document.createElement("div");if(i.classList.add("wp-modal-block"),r.appendChild(i),n.title){var a=document.createElement("div");if(a.classList.add("wp-modal-title"),i.appendChild(a),n.icon){var s=document.createElement("div");s.classList.add("wp-modal-title-icon"),s.style.backgroundImage='url("'+n.icon+'")',a.appendChild(s)}var c=document.createElement("div");c.classList.add("wp-modal-title-text"),t(c,n.title),a.appendChild(c)}var p=document.createElement("div");if(p.classList.add("wp-modal-content"),i.appendChild(p),n.content)t(p,n.content);else if(n.text){var u=document.createElement("div");u.classList.add("wp-modal-text"),p.appendChild(u),t(u,n.text)}if(n.buttons&&n.buttons.length>0){var d=document.createElement("div");d.classList.add("wp-modal-buttons"),i.appendChild(d);for(var l=function(e){return function(t){"function"==typeof e.onclick&&e.onclick.call(this,t,e),WonderPushSDK._protected.Modal.close()}},f=0;f<n.buttons.length;++f){var h=n.buttons[f],g=document.createElement("div");for(var _ in h.attributes||{})g.setAttribute(_,h.attributes[_]);g.classList.add("wp-modal-button"),t(g,h.label),g.addEventListener("click",l(h)),d.appendChild(g)}}return document.body.classList.add("modal-open"),document.body.appendChild(modal),e=modal,modal}}),this.close=WonderPushSDK._protected.Integration.proxifyToParentWindow("WonderPushSDK._protected.Modal.close",function(){document.body.classList.remove("modal-open"),document.documentElement.classList.remove("modal-open"),e&&(e.parentNode.removeChild(e),e=null)})}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){var e=new WonderPushSDK._protected.Promise.Deferred;return WonderPushSDK._protected.PopupUI=new function(){var t,n;Promise.all([WonderPushSDK._protected.Integration.getModuleInitializationPromise(),WonderPushSDK._protected.Notification.getModuleInitializationPromise()]).then(function(){var o=WonderPushSDK._protected.Integration.getFrameUrl();t=new URL(o).origin,n=WonderPushSDK.prototype.Notification.getOptInOptions(),e.resolve()}),this.presentPermissionUI=function(e){var o=n.externalBoxTitle||WonderPushSDK._protected.Options.getApplicationName(),r=void 0===n.externalBoxMessage?"We'd like to send you notifications":n.externalBoxMessage,i=n.externalBoxExampleTitle||"Example notification",a=n.externalBoxExampleMessage||"This is an example notification",s=t.replace(/^https?\:\/\//,""),c=n.externalBoxDisclaimer||"You can always unsubscribe at anytime.",p='<div class="wp-popup"><div class="wp-popup-content"><div class="wp-popup-title">'+o+"</div>"+(r?'<div class="wp-popup-message">'+r+"</div>":"")+'<div class="wp-popup-example"><div class="wp-popup-icon" style="background-image: url('+WonderPushSDK._protected.Options.getNotificationIcon()+')"></div><div class="wp-popup-example-text"><div class="wp-popup-example-title">'+i+'</div><div class="wp-popup-example-message">'+a+'</div><div class="wp-popup-example-url">'+s+'</div></div></div><div class="wp-popup-disclaimer">'+c+"</div></div></div>";e.postMessage({type:"display",sdk:WonderPushSDK._protected.sdkName,"whole-content":p},t)};var o=function(e,t){var n=WonderPushSDK.prototype.Notification.getOptInOptions();return'<div class="wp-popup"><div class="wp-popup-content"><div id="logo" class="wp-popup-icon" style="width: '+n.externalBoxLogoWidth+"px; height:"+n.externalBoxLogoHeight+"px; background-image: url("+n.externalBoxLogoUrl+');"></div><p>'+e+"</p>"+(t?"<p><small>"+t+"</small></p>":"")+"</div></div>"};this.presentProcessingUI=function(e){var n=WonderPushSDK.prototype.Notification.getOptInOptions(),r=o(n.externalBoxProcessingMessage);e.postMessage({type:"display",sdk:WonderPushSDK._protected.sdkName,"whole-content":r},t)},this.presentTimeoutUI=function(e){var n=WonderPushSDK.prototype.Notification.getOptInOptions(),r=o(n.externalBoxProcessingMessage,n.externalBoxTooLongHint);e.postMessage({sdk:WonderPushSDK._protected.sdkName,type:"display","whole-content":r},t)},this.presentSuccessUI=function(e){var n=WonderPushSDK.prototype.Notification.getOptInOptions(),r='<a href="#" onclick="window.close();">'+n.externalBoxCloseHint+"</a>",i=o(n.externalBoxSuccessMessage,r);e.postMessage({sdk:WonderPushSDK._protected.sdkName,type:"display","whole-content":i},t)},this.presentFailureUI=function(e){var n=WonderPushSDK.prototype.Notification.getOptInOptions(),r='<a href="#" onclick="window.close();">'+n.externalBoxCloseHint+"</a>",i=o(n.externalBoxFailureMessage,r);e.postMessage({type:"display",sdk:WonderPushSDK._protected.sdkName,"whole-content":i},t)},this.getModuleInitializationPromise=function(){return e.promise}},e.promise}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){WonderPushSDK._protected.JsonUtil=new function(){this.stripNulls=function(e){e instanceof Object&&!Array.isArray(e)&&Object.keys(e).forEach(function(t){var n=e[t];null==n?delete e[t]:WonderPushSDK._protected.JsonUtil.stripNulls(n)})},this.deepCopy=function(e){if(void 0!==e)return null===e?null:JSON.parse(JSON.stringify(e))},this.equal=function(e,t){if(!e||!t)return e==t;var n=this.diff(e,t);return n&&0===Object.keys(n).length},this.merge=function(e,t,n){if(n=!1!==n,e&&t)for(var o in t){var r=t[o];if(o in e)if(Array.isArray(r))e[o]=WonderPushSDK._protected.JsonUtil.deepCopy(r);else if(r instanceof Object){var i=e[o];Array.isArray(i)||"object"!=typeof i?e[o]=WonderPushSDK._protected.JsonUtil.deepCopy(r):WonderPushSDK._protected.JsonUtil.merge(i,r,n)}else null==r&&n?delete e[o]:e[o]=r;else n&&null==r||(e[o]=WonderPushSDK._protected.JsonUtil.deepCopy(r))}},this.diff=function(e,t){if("object"!=typeof e||"object"!=typeof t||Array.isArray(e)||Array.isArray(t))throw new WonderPushSDK.prototype.Errors.InvalidArgumentError("diff only accept objects as arguments");if(null==t)return null;if(null==e)return WonderPushSDK._protected.JsonUtil.deepCopy(t);var n,o,r={};for(n in e){o=n in t?t[n]:null;var i=e[n];if(i!==o)if(Array.isArray(o))if(Array.isArray(i)&&o.length===i.length){for(var a=!1,s=0;s<i.length;++s)if(null==i[s]||null==o[s]||"object"!=typeof i[s]||"object"!=typeof o[s]||Array.isArray(e)||Array.isArray(t)){if(i[s]!==o[s]){a=!0;break}}else{var c=WonderPushSDK._protected.JsonUtil.diff(i[s],o[s]);if(0!==Object.keys(c).length){a=!0;break}}a&&(r[n]=WonderPushSDK._protected.JsonUtil.deepCopy(o))}else r[n]=WonderPushSDK._protected.JsonUtil.deepCopy(o);else null==i||null==o||"object"!=typeof i||"object"!=typeof o||Array.isArray(i)||Array.isArray(o)?r[n]="object"==typeof o?WonderPushSDK._protected.JsonUtil.deepCopy(o):o:(r[n]=WonderPushSDK._protected.JsonUtil.diff(i,o),0===Object.keys(r[n]).length&&delete r[n])}for(n in t)n in e||(o=t[n],r[n]=WonderPushSDK._protected.JsonUtil.deepCopy(o));return r}}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){var e="[jsonsync    ]",t=WonderPushSDK._protected.JsonUtil;WonderPushSDK._protected.JsonSyncCallbackBuilder=function(){var e=this,t={save:function(e){return Promise.resolve()},schedulePatchCall:function(){return Promise.resolve()},serverPatchInstallation:function(e){}};e.onSave=function(n){return t.save=n,e},e.onSchedulePatchCall=function(n){return t.schedulePatchCall=n,e},e.onServerPatchInstallation=function(n){return t.serverPatchInstallation=n,e},e.build=function(){return t}},WonderPushSDK._protected.JsonSync=function(n,o,r,i,a,s,c,p){if(!n)throw new WonderPushSDK.prototype.Errors.InvalidArgumentError("callbacks cannot be null");o=t.deepCopy(o||{}),r=t.deepCopy(r||{}),i=t.deepCopy(i||{}),a=t.deepCopy(a||{}),s=t.deepCopy(s||{}),c=!!c,p="number"==typeof p?p:0,t.stripNulls(o),t.stripNulls(r);var u=function(){var e={_syncStateVersion:1};return e.sdkState=o,e.serverState=r,e.putAccumulator=i,e.inflightDiff=a,e.inflightPutAccumulator=s,e.scheduledPatchCall=c,e.inflightPatchCallDeadline=p,Promise.resolve(n.save(e))},d=function(){return 0!==p},l=function(){return d()&&+new Date>p},f=function(){return c=!0,u().then(function(){return Promise.resolve(n.schedulePatchCall())})};this.callPatch_onSuccess=function(){return p=0,s={},t.merge(r,a,!0),a={},u()},this.callPatch_onFailure=function(){return p=0,t.merge(s,i,!1),i=s,s={},f()},this.getSdkState=function(){return t.deepCopy(o)},this.hasInflightPatchCall=d,this.hasInflightPatchCallTimedout=l,this.hasScheduledPatchCall=function(){return c},this.performScheduledPatchCall=function(){return c?function(){if(d())return c?u():f();c=!1;try{a=t.diff(r,o)}catch(t){WonderPushSDK._protected.Helper.error(e,"[callPatch] Failed to diff server state and sdk state to send installation custom diff",r,o,t),a={}}if(!Object.keys(a).length)return u();p=+new Date+WonderPushSDK._protected.Constants.JSON_SYNC_MAX_INFLIGHT_TIME,s=t.deepCopy(i),i={};var l=u();return l.then(function(){n.serverPatchInstallation(a)}),l}():Promise.resolve()},this.put=function(e){return e||(e={}),t.merge(o,e,!0),t.merge(i,e,!1),f()},this.receiveDiff=function(e){return e||(e={}),t.merge(r,e,!0),this.put(e)}.bind(this),this.receiveState=function(e,n){return e||(e={}),r=t.deepCopy(e),t.stripNulls(r),o=t.deepCopy(r),n?i={}:(t.merge(o,i,!0),t.merge(o,a,!0)),f()},this.receiveServerState=function(e){return e||(e={}),r=t.deepCopy(e),t.stripNulls(r),f()},this.save=u;var h=new Promise(function(e,t){l()?e(this.callPatch_onFailure()):this.hasScheduledPatchCall()?e(f()):e()}.bind(this));this.ready=function(){return h}},WonderPushSDK._protected.JsonSync.fromSavedState=function(e,t){t||(t={});t._syncStateVersion;return new WonderPushSDK._protected.JsonSync(e,t.sdkState,t.serverState,t.putAccumulator,t.inflightDiff,t.inflightPutAccumulator,void 0==t.scheduledPatchCall||t.scheduledPatchCall,t.inflightPatchCallDeadline)}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){var e="[jsonsyncinst]";WonderPushSDK._protected.JsonSyncInstallationCustom=function(e,o){var a=function(){return WonderPushSDK.prototype.getInitializationPromise().then(function(){return t(function(){return n(e).then(function(e){return c=0,e.sync.performScheduledPatchCall()})})})}.bind(this);this.flush=function(){null!==s&&(clearTimeout(s),s=null),a()};var s=null,c=0;e=e||null;var p=(new WonderPushSDK._protected.JsonSyncCallbackBuilder).onServerPatchInstallation(function(t){return function(t){var n={body:JSON.stringify({custom:t}),overwrite:!1},o={onload:function(t){("function"==typeof t.json?t.json():Promise.resolve(this.responseJSON)).then(function(t){t&&!0===t.success?r(e):i(e)},function(t){i(e)})},onerror:function(t){i(e)},ontimeout:function(t){i(e)},onabort:function(t){i(e)}};WonderPushSDK._protected.Rest.post(e,"/installation",n,void 0,o)}(t)}).onSchedulePatchCall(function(){return function(){null!==s&&(clearTimeout(s),s=null);var e=+new Date;0===c&&(c=e);var t=Math.max(0,Math.min(WonderPushSDK._protected.Constants.CACHED_INSTALLATION_CUSTOM_PROPERTIES_MIN_DELAY,c+WonderPushSDK._protected.Constants.CACHED_INSTALLATION_CUSTOM_PROPERTIES_MAX_DELAY-e));s=setTimeout(a,t)}()}).onSave(function(t){return function(t){var n=e||"";return WonderPushSDK._protected.Storage.get(WonderPushSDK._protected.Constants.PER_USER_INSTALLATION_CUSTOM_PROPERTIES_STORAGE_KEY,{}).then(function(e){return e[n]=t,WonderPushSDK._protected.Storage.set(WonderPushSDK._protected.Constants.PER_USER_INSTALLATION_CUSTOM_PROPERTIES_STORAGE_KEY,e)})}(t)}).build();this.sync=WonderPushSDK._protected.JsonSync.fromSavedState(p,o),this.getSdkState=this.sync.getSdkState,this.put=this.sync.put,this.receiveServerState=this.sync.receiveServerState,this.receiveState=this.sync.receiveState,this.receiveDiff=this.sync.receiveDiff,this.callPatch_onSuccess=this.sync.callPatch_onSuccess,this.callPatch_onFailure=this.sync.callPatch_onFailure;var u=new WonderPushSDK._protected.Promise.Deferred;this.sync.ready().then(function(){u.resolve(this)}.bind(this)).catch(function(e){u.reject(e)}),this.ready=function(){return u.promise}};var t=function(t){var n=new WonderPushSDK._protected.Locking.ExpiringUnfairNamedGlobalMutex("jsonSyncInstallationCustom",5e3);return n.acquire({timeout:6e3}).then(function(){var e=t();return n.renewWhile({interval:2500,release:!0},e),e},function(t){throw WonderPushSDK._protected.Helper.error(e,"cannot enter synchronized section",t),t})};WonderPushSDK._protected.JsonSyncInstallationCustom.getInstallationCustomPropertiesForUser=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.JsonSyncInstallationCustom.getInstallationCustomPropertiesForUser",function(e){return WonderPushSDK.instantiationPromise.then(function(){return t(function(){return n(e).then(function(e){return e.getSdkState()})})})}),WonderPushSDK._protected.JsonSyncInstallationCustom.putInstallationCustomPropertiesForUser=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.JsonSyncInstallationCustom.putInstallationCustomPropertiesForUser",function(e,o){return WonderPushSDK.instantiationPromise.then(function(){return t(function(){return n(e).then(function(e){return e.put(o)})})})}),WonderPushSDK._protected.JsonSyncInstallationCustom.receiveDiffForUser=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.JsonSyncInstallationCustom.receiveDiffForUser",function(e,o){return WonderPushSDK.instantiationPromise.then(function(){return t(function(){return n(e).then(function(e){return e.receiveDiff(o)})})})}),WonderPushSDK._protected.JsonSyncInstallationCustom.receiveStateForUser=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.JsonSyncInstallationCustom.receiveStateForUser",function(e,o,r){return WonderPushSDK.instantiationPromise.then(function(){return t(function(){return n(e).then(function(e){return e.receiveState(o,r)})})})}),WonderPushSDK._protected.JsonSyncInstallationCustom.receiveServerStateForUser=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.JsonSyncInstallationCustom.receiveServerStateForUser",function(e,o){return WonderPushSDK.instantiationPromise.then(function(){return t(function(){return n(e).then(function(e){return e.receiveServerState(o)})})})}),WonderPushSDK._protected.JsonSyncInstallationCustom.deleteForUser=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.JsonSyncInstallationCustom.deleteForUser",function(e){return WonderPushSDK.instantiationPromise.then(function(){return t(function(){return o(e)})})});var n=function(e){return e=e||"",WonderPushSDK._protected.Storage.get(WonderPushSDK._protected.Constants.PER_USER_INSTALLATION_CUSTOM_PROPERTIES_STORAGE_KEY,{}).then(function(t){return new WonderPushSDK._protected.JsonSyncInstallationCustom(e,t[e]||null).ready()})},o=function(e){return e=e||"",WonderPushSDK._protected.Storage.bulk([{test:{key:WonderPushSDK._protected.Constants.PER_USER_INSTALLATION_CUSTOM_PROPERTIES_STORAGE_KEY,defaultValue:{},operationsCb:function(t){return delete t[e],[{put:{key:WonderPushSDK._protected.Constants.PER_USER_INSTALLATION_CUSTOM_PROPERTIES_STORAGE_KEY,value:t}}]}}}]).then(function(){})},r=function(e){t(function(){return n(e).then(function(e){return e.callPatch_onSuccess()}).then(function(){})})._wp_catchNoop()},i=function(e){t(function(){return n(e).then(function(e){return e.callPatch_onFailure()}).then(function(){})})._wp_catchNoop()},a=null,s=function(){null===a&&WonderPushSDK._protected.RunModes.Behaviors.AccessToken&&t(function(){return WonderPushSDK._protected.Storage.get(WonderPushSDK._protected.Constants.PER_USER_INSTALLATION_CUSTOM_PROPERTIES_STORAGE_KEY,{}).then(function(t){Promise.all(Object.keys(t).map(function(n){return new WonderPushSDK._protected.JsonSyncInstallationCustom(n||"",t[n]).ready().catch(function(t){WonderPushSDK._protected.Helper.error(e,"Failed to initialize JsonSyncInstallationCustom for user",n,":",t)})}))})}).catch(function(t){WonderPushSDK._protected.Helper.error(e,"Periodic check rejected with",t)}).then(function(){var e=Math.round(WonderPushSDK._protected.Constants.REQUEST_VAULT_IDLE_WAIT_MS*(1+.2*Math.random()));a=setTimeout(function(){a=null,s()},e)})};WonderPushSDK._protected.Config.getModuleInitializationPromise().then(function(){WonderPushSDK._protected.RunModes.Behaviors.AccessToken&&(WonderPushSDK.prototype.getInitializationPromise().then(function(){return WonderPushSDK._protected.Storage.get(WonderPushSDK._protected.Constants.PER_USER_INSTALLATION_CUSTOM_PROPERTIES_STORAGE_KEY,null)}).then(function(e){var o=WonderPushSDK._protected.Options.getUserId();if(!((o||"")in(e||{})))return t(function(){return n(o).then(function(e){return function(e){return WonderPushSDK.preInstantiationPromise.then(function(){var t=new WonderPushSDK._protected.Promise.Deferred,n=function(){t.reject()},o={onload:function(e){var n=e&&e.json&&e.json()||this.responseJSON;t.resolve(n&&n.custom||{})},onerror:n,ontimeout:n,onabort:n};return WonderPushSDK._protected.Rest.get(e,"/installation",{},o,{}),t.promise})}(o).then(function(t){e.receiveState(t,!1)})})})}),WonderPushSDK._protected.Locking.getModuleInitializationPromise().then(function(){s()}))})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){var e="[data        ]";WonderPushSDK._protected.Data=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Data",new function(){this.exportAsBlob=function(){var e=[],t=function(t){e.push(JSON.stringify(t)),e.push("\n")},n=function(e){var n=WonderPushSDK._protected.Rest.fetchJson(e,"GET","/authentication/accessToken",{},void 0).then(function(e){return{accessToken:e}}).then(t),o=(null===e||void 0===e||""===e?Promise.resolve(null):WonderPushSDK._protected.Rest.fetchJson(e,"GET","/user",{},void 0)).then(function(e){return{user:e}}).then(t),r=WonderPushSDK._protected.Rest.fetchJson(e,"GET","/installation",{},void 0).then(function(e){return{installation:e}}).then(t),i=function(n){return function(t){var n=t?WonderPushSDK._protected.Helper.decodeQueryString(new URL(t).search):{limit:1e3};return WonderPushSDK._protected.Rest.fetchJson(e,"GET","/events",n,void 0)}(n).then(function(e){t({eventsPage:e.data||[]});var n=(e.pagination||{}).next;if(n)return i(n)})};return Promise.all([n,r,o,i(void 0)])};return Promise.all([WonderPushSDK._protected.Storage.listObjectStores().then(function(e){return Promise.all(e.map(function(e){return WonderPushSDK._protected.Storage.listKeyValuePairs(e).then(function(n){t({indexedDbStoreKeyValuePairs:{[e]:n}})})}))}),WonderPushSDK._protected.Session.listUsedUserIds().then(function(e){return Promise.all(e.map(function(e){return n(e)}))})]).then(function(){return new Blob(e,{type:"application/json"})})},this.downloadExport=function(){return Promise.all([WonderPushSDK.this.getUserId(),WonderPushSDK.this.getInstallationId(),WonderPushSDK._protected.Data.exportAsBlob()]).then(function(e){var t=e[0],n=e[1],o=e[2];null!==t&&void 0!==t||(t="");var r=document.createElement("a");r.href=window.URL.createObjectURL(o),r.download="wonderpush-web-dataexport-"+encodeURIComponent(t).replace("-","%2D")+"-"+encodeURIComponent(n).replace("-","%2D")+"-"+(new Date).toISOString()+".json",document.body.appendChild(r),r.click(),document.body.removeChild(r)}).then(function(){})},this.clearEventsHistory=function(e){return WonderPushSDK._protected.Rest.fetchJson(e,"DELETE","/events",{},void 0).then(function(){})},this.clearPreferences=function(e){WonderPushSDK._protected.JsonSyncInstallationCustom.getInstallationCustomPropertiesForUser(e).then(function(t){return Object.keys(t).forEach(function(e){t[e]=null}),Promise.all([WonderPushSDK._protected.JsonSyncInstallationCustom.putInstallationCustomPropertiesForUser(e,t),e?WonderPushSDK._protected.Rest.fetchJson(e,"PUT","/user",{body:JSON.stringify({custom:null})},void 0):Promise.resolve()])}).then(function(){})},this.clearInstallation=function(t){return WonderPushSDK._protected.Rest.fetchJson(t,"DELETE","/installation",{},void 0).catch(function(n){WonderPushSDK._protected.Helper.error(e,"Failed to delete installation for userId",t,":",n),WonderPushSDK._protected.Helper.info(e,"Continuing cleanup anyway")}).then(function(){return Promise.all([WonderPushSDK._protected.Session.deleteSession(t),WonderPushSDK._protected.JsonSyncInstallationCustom.deleteForUser(t)])}).then(function(){})},this.clearAllLocalStorage=function(){return WonderPushSDK._protected.Storage.deleteDatabase().then(function(){})}}),WonderPushSDK.prototype.Data=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.Data",new function(){this.exportAsBlob=function(){return WonderPushSDK._protected.Data.exportAsBlob()},this.downloadExport=function(){return WonderPushSDK._protected.Data.downloadExport()},this.clearEventsHistory=function(){return WonderPushSDK._protected.Session.listUsedUserIds().then(function(e){return Promise.all(e.map(function(e){return WonderPushSDK._protected.Data.clearEventsHistory(e)}))})},this.clearPreferences=function(){return WonderPushSDK._protected.Session.listUsedUserIds().then(function(e){return Promise.all(e.map(function(e){return WonderPushSDK._protected.Data.clearPreferences(e)}))})},this.clearAll=function(){return WonderPushSDK._protected.Session.listUsedUserIds().then(function(e){return Promise.all(e.map(function(e){return WonderPushSDK._protected.Data.clearInstallation(e)})).then(function(){return WonderPushSDK._protected.Data.clearAllLocalStorage()})})}})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){if(WonderPushSDK._protected.RunModes.Behaviors.ContextWindow){var e,t,n,o="[ui          ]",r=[],i={},a=(e=WonderPushSDK._protected.sdkName.toLowerCase(),t=document.querySelector('HEAD>META[name="'+e+'-integration"]'),(n=t?(t.content||t.getAttribute("content")).trim().split(/\s*,\s*/):[]).indexOf("frame")<0&&n.indexOf("popup")<0),s=function(e,t){a||window.postMessage({type:"display",sdk:WonderPushSDK._protected.sdkName,[e]:t},window.location.origin)},c=s.bind(null,"text-content");s.bind(null,"main-content"),s.bind(null,"whole-content");i.clear=function(){c("")},i.close=function(){c("You can now close the window."),window.close()},i.wait=function(e){return new Promise(function(t){setTimeout(function(){t()},e.ms||1e3)})},i.reload=function(){c("Reloading…");var e=new URL(window.location.href),t=WonderPushSDK._protected.Helper.decodeQueryString(location.search);delete t.wonderpushUi,delete t.wonderpushUI,t.wonderpushUI=p(),e.search="",Object.keys(t).forEach(function(n){e.search+=(e.search?"&":"?")+encodeURIComponent(n)+(null===t[n]?"":"="+encodeURIComponent(t[n]))}),WonderPushSDK._protected.Helper.info(o,"[reload] Navigating to",e.href),window.location.href=e.href},i.downloadDataExport=function(){return c("Gathering data for export…"),WonderPushSDK.this.Data.downloadExport().then(function(){c("See downloaded file.")},function(e){throw c("An error occurred"),e})},i.clearEventsHistory=function(){return c("Clearing all events…"),WonderPushSDK.this.Data.clearEventsHistory().then(function(){c("All events are cleared.")},function(e){throw c("An error occurred"),e})},i.clearPreferences=function(){return c("Clearing preferences…"),WonderPushSDK.this.Data.clearPreferences().then(function(){c("Preferences are cleared.")},function(e){throw c("An error occurred"),e})},i.clearAllData=function(){return c("Clearing all local and server-side data…"),WonderPushSDK.this.Data.clearAll().then(function(){c("All local and server-side data is cleared.")},function(e){throw c("An error occurred"),e})},i.optIn=function(){return c("Opt-in you in…"),WonderPushSDK.this.setNotificationEnabled(!0).then(function(){c("You are now opted in.")},function(e){throw c("An error occurred"),e})},i.optOut=function(){return c("Opt-in you out…"),WonderPushSDK.this.setNotificationEnabled(!1).then(function(){c("You are now opted out.")},function(e){throw c("An error occurred"),e})};var p=function(){return r.map(function(e){return e.originalCall}).join(";")},u=function(){var e=r.shift();return void 0===e?Promise.resolve():Promise.resolve(e()).then(u)};WonderPush.ready(function(){var e=WonderPushSDK._protected.Helper.decodeQueryString(location.search),t=e.wonderpushUI||e.wonderpushUi;(r=(t||"").split(";").map(function(e){var t=e.split("?");t.length>2&&t.push(t.splice(1).join("?"));var n=t[0],r=WonderPushSDK._protected.Helper.decodeQueryString(t[1]);if(!i.hasOwnProperty(n))return null;var a=function(){return WonderPushSDK._protected.Helper.info(o,"Launching UI",n,r,"…"),Promise.resolve(i[n](r)).then(function(){WonderPushSDK._protected.Helper.info(o,"Launching UI",n,"done")},function(e){WonderPushSDK._protected.Helper.info(o,"Launching UI",n,"failed:",e)})};return a.originalCall=e,a}).filter(function(e){return e instanceof Function})).length&&r.unshift(i.clear.bind(null,{})),u()})}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o,r;o=[n(56)],void 0===(r=function(e){return function(WonderPushSDK){var t,n="[plugins     ]",o={},r={},i={},a={},s={};WonderPushSDK.prototype.Plugins=new function(){this.get=function(e){return WonderPushSDK._protected.Plugins.get(e)},this.getVersion=function(e){return WonderPushSDK._protected.Plugins.getVersion(e)}};var c=function(e){this.Storage=new function(){this.get=WonderPushSDK._protected.Plugins.pluginStorageGet.bind(null,e.name),this.set=WonderPushSDK._protected.Plugins.pluginStorageSet.bind(null,e.name)},this.loadStylesheet=function(){if(window)for(var t=new URL(".",e.url),n=0;n<arguments.length;n++){var o=arguments[n];if(o){var r=new URL(o,t);if(!o.match(/^https?\:/)&&r.href.startsWith(t.href)){var i=window.document.createElement("link");i.rel="stylesheet",i.href=r.href,window.document.head.appendChild(i)}else this.logError("Invalid stylesheet: stylesheets must be relative to the plugin file.")}}else this.logError("No window to add stylesheet to.")}.bind(this),this.logTrace=WonderPushSDK._protected.Helper.trace.bind(null,"[plugin      ]","["+e.name+"]"),this.logDebug=WonderPushSDK._protected.Helper.debug.bind(null,"[plugin      ]","["+e.name+"]"),this.log=WonderPushSDK._protected.Helper.log.bind(null,"[plugin      ]","["+e.name+"]"),this.logInfo=WonderPushSDK._protected.Helper.info.bind(null,"[plugin      ]","["+e.name+"]"),this.logWarn=WonderPushSDK._protected.Helper.warn.bind(null,"[plugin      ]","["+e.name+"]"),this.logError=WonderPushSDK._protected.Helper.error.bind(null,"[plugin      ]","["+e.name+"]"),this.checkTriggers=function(e,t,n){this.logDebug("[checkTriggers] config =",e),e?!0===e?e={}:(e.autoReset=void 0==e.autoReset||e.autoReset,e.delay=void 0!=e.delay?e.delay:0,e.snooze=void 0!=e.snooze?e.snooze:432e5):e={manual:!0};var o=null,r=null,i=null;t=t||function(){},n=n||function(){},e.autoReset&&(t=function(e){this.resetTriggers(),e()}.bind(this,t)),e.delay&&e.delay>0&&(t=t._wp_delay(e.delay)),t=function(e){this.logDebug("[checkTriggers] passed"),e()}.bind(this,t);var a=WonderPushSDK.prototype.getAttendance().then(function(e){o=e}),s=this.Storage.get("_triggersInfo").then(function(e){r=e._triggersInfo||{}}),c=WonderPushSDK._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Notification.getTrustedOrCachedNotificationPermissionState").then(function(e){i=e===WonderPushSDK._protected.Notification.PERMISSION_DENIED});Promise.all([a,s,c]).then(function(){var a=!0;i&&(this.logDebug("[checkTriggers] rejects (permission)",{permissionDenied:i}),a=!1);var s=WonderPushSDK.prototype.Notification.getSubscriptionState();s!==WonderPushSDK.prototype.SubscriptionState.NOT_SUBSCRIBED&&(this.logDebug("[checkTriggers] rejects (subscription state)",{subscriptionState:s}),a=!1),e.manual&&(this.logDebug("[checkTriggers] rejects (manual)",{manual:e.manual}),a=!1),(!0===r.snoozeUntilDate||"number"==typeof r.snoozeUntilDate&&r.snoozeUntilDate>(new Date).getTime())&&(this.logDebug("[checkTriggers] rejects (snoozeUntilDate)",{snoozeUntilDate:r.snoozeUntilDate}),a=!1),e.snooze&&r.resetDate&&r.resetDate+e.snooze>(new Date).getTime()&&(this.logDebug("[checkTriggers] rejects (snooze)",{snooze:e.snooze,resetDate:r.resetDate}),a=!1),e.minVisits&&o.visitCount<e.minVisits&&(this.logDebug("[checkTriggers] rejects (visits < minVisits)",{visits:o.visitCount,minVisits:e.minVisits}),a=!1),e.minVisitsSinceReset&&r.resetVisits&&o.visitCount-r.resetVisits<e.minVisitsSinceReset&&(this.logDebug("[checkTriggers] rejects (visitsSinceReset < minVisitsSinceReset)",{visitsSinceReset:o.visitCount-r.resetVisits,minVisitsSinceReset:e.minVisitsSinceReset}),a=!1),e.minPages&&o.pageViews<e.minPages&&(this.logDebug("[checkTriggers] rejects (pages < minPages)",{pages:o.pageViews,minPages:e.minPages}),a=!1),e.minPagesSinceReset&&r.resetPages&&o.pageViews-r.resetPages<e.minPagesSinceReset&&(this.logDebug("[checkTriggers] rejects (pagesSinceReset < minPagesSinceReset)",{pagesSinceReset:o.pageViews-r.resetPages,minPagesSinceReset:e.minPagesSinceReset}),a=!1),e.minVisitPages&&o.visitPageViews<e.minVisitPages&&(this.logDebug("[checkTriggers] rejects (visitPages < minVisitPages)",{visitPages:o.visitPageViews,minVisitPages:e.minVisitPages}),a=!1),a?t():n()}.bind(this))}.bind(this),this.resetTriggers=function(){return Promise.all([this.getAttendance(),this.Storage.get("_triggersInfo")]).then(function(e){var t=e[0],n=e[1]._triggersInfo||{};return n.resetDate=(new Date).getTime(),n.resetVisits=t.visitCount,n.resetPages=t.pageViews,this.Storage.set("_triggersInfo",n).then(function(){})}.bind(this))}.bind(this),this.snoozeTriggers=function(e){return"number"==typeof e&&(e+=(new Date).getTime()),this.Storage.get("_triggersInfo").then(function(t){var n=t._triggersInfo||{};return n.snoozeUntilDate=e,this.Storage.set("_triggersInfo",n).then(function(){})}.bind(this))}.bind(this)};c.prototype=new WonderPushSDK.constructor,WonderPushSDK._protected.Plugins=new function(){var c=function(e,t){this.key=e,this.options=t;var n=e.match(/^([-_a-zA-Z0-9]+)(?::(\d+(?:\.\d+(?:\.\d+)?)?))?$/);if(n){var o=[];this.name=n[1],n[2]?(o=n[2].split(".").map(function(e){return""+parseInt(e)}),this.version=o.join(".")):(this.version="latest",o=[this.version]),3===o.length?this.url=new URL(WonderPushSDK._protected.Constants.PLUGIN_ROOT_URL+this.name+"/"+this.version+"/"+this.name+".js"):this.url=new URL(WonderPushSDK._protected.Constants.PLUGIN_ROOT_URL+this.name+"/"+this.version)}else{var r;try{r=new URL(e.endsWith(".js")?e:e+".js")}catch(t){throw Error('Invalid plugin name (allowed characters: a-z, A-Z, 0-9, "-", "_") or version (3 dot-separated digits): '+e)}if(r.pathname.endsWith("/"))throw Error("Invalid plugin URL (should end with the name of your plugin, not /): "+e);if("https:"!==r.protocol)throw Error("Invalid plugin URL (HTTP is not supported, please use HTTPS): "+e);this.name=r.pathname.replace(/^(?:.*\/)?([^\/]*?)(?:\.js)?$/,"$1"),this.url=r,this.version=r}this.resolveVersion=function(){if("string"!=typeof this.version||3===this.version.split(".").length)return Promise.resolve(this);var e=this;return new Promise(function(n,o){var r=function(o){(o&&o.text?o.text():Promise.resolve("string"==typeof o?o:this.responseText)).then(function(o){o=o.trim(),n(new c(e.name+":"+o,t))})},i=function(t){console.error("Failed to resolve full version for plugin "+e.name+":"+e.version,t),o(new WonderPushSDK.prototype.Errors.InternalError("Failed to resolve full version for plugin "+e.name+":"+e.version))};const a=s&&s[e.name],p=a&&a.shortVersions,u=p&&p[e.version];u?r(u):WonderPushSDK._protected.Request.request("GET",e.url.href,null,null,null,{onload:r,onerror:i,ontimeout:i,onabort:i})})}.bind(this)};t=function(){e(WonderPushSDK);var t=function(){s=WonderPushSDK._protected.Config.getPluginsRegistry(),Object.keys(a).forEach(e=>{const t=a[e].loaderByVersion||{};Object.keys(t).forEach(t=>{const n=t.split("."),o=n[0],r=`${n[0]}.${n[1]}`;e in s||(s[e]={}),s[e].shortVersions||(s[e].shortVersions={}),["latest",o,r].forEach(n=>{const o=s[e].shortVersions[n];(!o||WonderPushSDK._protected.Helper.compareVersions(t,o)>0)&&(s[e].shortVersions[n]=t)})})});var e,t,i=function(e){var t={"optin-switch":{switchElementId:e.switchElementId||WonderPushSDK._protected.Constants.SUBSCRIPTION_SWITCH_ELEMENT_ID_DEFAULT}};if("visits"===e.mode?t["optin-dialog"]={triggers:{minVisits:void 0!==e.minVisits?e.minVisits:WonderPushSDK._protected.Constants.SUBSCRIPTION_MIN_VISITS_DEFAULT}}:"pages"===e.mode?t["optin-dialog"]={triggers:{minPages:void 0!==e.minPages?e.minPages:WonderPushSDK._protected.Constants.SUBSCRIPTION_MIN_PAGES_DEFAULT}}:"direct"===e.mode&&(t["optin-dialog"]={triggers:{}}),t["optin-dialog"]&&t["optin-dialog"].triggers){t["optin-dialog"].triggers.delay=void 0!==e.delay?e.delay:WonderPushSDK._protected.Constants.SUBSCRIPTION_DELAY_DEFAULT,t["optin-dialog"].triggers.snooze=void 0!==e.snooze?e.snooze:WonderPushSDK._protected.Constants.SUBSCRIPTION_SNOOZE_DEFAULT;var n=WonderPushSDK.prototype.Notification.getOptInOptions();n&&"Recevez désormais nos news en temps réel.<br/>Vous pouvez vous désinscrire à n'importe quel moment."===n.modalBoxMessage&&(t["optin-dialog"].title="Voulez-vous recevoir nos news en temps réel ?",t["optin-dialog"].message="Vous pouvez vous désinscrire à n'importe quel moment.",t["optin-dialog"].positiveButton="S'enregistrer",t["optin-dialog"].negativeButton="Plus tard")}return t}(WonderPushSDK._protected.Options.getSubscriptionOptions()),u=WonderPushSDK._protected.Options.getPlugins();if(WonderPushSDK._protected.RunModes.Behaviors.ContextWindow?e=function(e){var t=document.createElement("script");t.src=e.url,document.body.appendChild(t)}:WonderPushSDK._protected.RunModes.Behaviors.ContextServiceWorker&&(e=function(e){importScripts(e.url)}),e){const t=e;e=function(e){const n=a[e.name],o=n&&n.loaderByVersion,r=o&&o[e.version];r?r():t(e)}}for(var d in e&&WonderPushSDK._protected.RunModes.Behaviors.Plugins||(e=function(e){l[e.name].resolve()},u={},i={}),WonderPush.registerPlugin=function(e,t){var n,r;"function"==typeof t?n=t:"object"==typeof t&&("function"==typeof t.window&&(n=t.window),"function"==typeof t.serviceWorker&&(r=t.serviceWorker)),WonderPushSDK._protected.RunModes.Behaviors.ModeWebSite?o[e]=n:WonderPushSDK._protected.RunModes.Behaviors.ModeServiceWorker&&(o[e]=r);var i=l[e];i&&i.resolve()},r=p(u),i)d in r||(t=new c(d,i[d]),r[t.name]=t);var l={};Object.keys(r).forEach(function(t){try{var o=r[t];l[o.name]=new WonderPushSDK._protected.Promise.Deferred,o.options?o.resolveVersion().then(function(t){r[t.name]=t,e(t)},function(e){console.error("Cannot load plugin "+o.name+" at "+o.url.href,e)}):l[o.name].resolve()}catch(e){WonderPushSDK._protected.Helper.error(n,e.message)}}),Promise.all(Object.keys(l).map(function(e){return l[e].promise})).then(function(){delete WonderPush.registerPlugin,WonderPushSDK._protected.Blocker.category("ready").remove("plugin")})};WonderPushSDK._protected.Blocker.category("ready").add("plugin");var i=[WonderPushSDK._protected.Config,WonderPushSDK._protected.Integration];Promise.all(i.map(function(e){return e.getModuleInitializationPromise()})).then(function(){t()})};var p=function(e){var t={};for(var o in e)if(e.hasOwnProperty(o))try{var i=new c(o,e[o]);if(i.name in r){WonderPushSDK._protected.Helper.error(n,"Multiple plugin versions specified for "+i.name),WonderPushSDK._protected.Helper.error(n,"We had "+r[i.name].version+" and saw "+i.version),console.error(new WonderPushSDK.prototype.Errors.PluginError("Multiple plugin versions specified for "+i.name));continue}t[i.name]=i}catch(e){WonderPushSDK._protected.Helper.error(n,e.message)}return t};this.mergeOptionsPlugins=function(e,t){for(var n=[{}],o=0;o<arguments.length;o++)n.push(p(arguments[o]||{}));return function(e){var t={};for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];t[o.key]=o.options}return t}(WonderPushSDK._protected.Helper.assign.apply(null,n))},this.get=function(e){return i[e]},this.getVersion=function(e){var t=(r[e]||{}).version;return t instanceof URL&&(t=new URL(t.href)),t},this.pluginStorageGet=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Plugins.pluginStorageGet",function(e){var t=Array.prototype.slice.call(arguments);return t.shift(),WonderPushSDK._protected.Storage.get("pluginsStorage:"+e,{}).then(function(e){var n={};return t.forEach(function(t){n[t]=e[t]}),n})}),this.pluginStorageSet=WonderPushSDK._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Plugins.pluginStorageSet",function(e){var t;return 3!==arguments.length||arguments[1]instanceof Object?t=arguments[1]:(t={})[arguments[1]]=arguments[2],WonderPushSDK._protected.Storage.bulk([{test:{key:"pluginsStorage:"+e,defaultValue:{},operationsCb:function(n){return WonderPushSDK._protected.Helper.assign(n,t),[{put:{key:"pluginsStorage:"+e,value:n}}]}}}]).then(function(){})}),this.preregisterInlinedPlugin=function(e,t,n){a[e]||(a[e]={loaderByVersion:{}});a[e].loaderByVersion[t]=n}},t(),WonderPushSDK.preInstantiationPromise.then(function(){WonderPushSDK._protected.Init.addWillBecomeReadyCallback(function(){Object.keys(r).forEach(function(e){var t=o[e];if(t){var n=r[e];i[e]=new t(new c(n),n.options),delete o[e]}})})})}}.apply(t,o))||(e.exports=r)},function(e,t,n){var o,r;o=[n(57),n(58),n(59),n(60)],void 0===(r=function(){var e=Array.prototype.slice.call(arguments);return function(WonderPushSDK){e.forEach(e=>e(WonderPushSDK))}}.apply(t,o))||(e.exports=r)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){WonderPushSDK._protected.Plugins.preregisterInlinedPlugin("optin-automatic","1.0.0",function(){WonderPush.registerPlugin("optin-automatic",function(e,t){e.checkTriggers(t.triggers,function(){e.setNotificationEnabled(!0)})})})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){WonderPushSDK._protected.Plugins.preregisterInlinedPlugin("optin-dialog","1.3.0",function(){WonderPush.registerPlugin("optin-dialog",function(e,t){var n=void 0!==t.title?t.title:"Would you like to subscribe to push notifications?",o=void 0!==t.message?t.message:"You can always unsubscribe at any time.",r=t.positiveButton||"Subscribe",i=t.negativeButton||"Later",a=t.style,s=void 0!==t.icon?t.icon:e.getNotificationIcon(),c=!!t.hidePoweredBy,p=void 0!==t.closeSnooze&&t.closeSnooze,u=void 0!==t.negativeSnooze?t.negativeSnooze:6048e5,d=t.triggers;!function(){var e=document.createElement("style");e.type="text/css",e.appendChild(document.createTextNode(".wp-optin-dialog-container{z-index:10000;width:420px;max-width:100%;box-sizing:border-box;background-image:linear-gradient(to bottom,#eae9ea,#eeedee);position:fixed;top:0;left:50%;transform:translateX(-50%);padding:15px 20px 10px 20px;border:1px solid #dfdfdf;box-shadow:0 0 20px #888}.wp-optin-dialog-container .wp-optin-dialog-body{display:flex;flex-direction:row}.wp-optin-dialog-container .wp-optin-dialog-icon{flex-shrink:0;flex-basis:64px;width:64px;height:64px;background-size:contain;background-repeat:no-repeat;background-position:50% 50%;margin-right:20px}.wp-optin-dialog-container .wp-optin-dialog-text{display:flex;flex-direction:column;flex-grow:1}.wp-optin-dialog-container .wp-optin-dialog-text .wp-optin-dialog-title{font:bold 16px arial;margin-bottom:15px}.wp-optin-dialog-container .wp-optin-dialog-text .wp-optin-dialog-message{font:12px arial}.wp-optin-dialog-container .wp-optin-dialog-buttons{display:flex;flex-direction:row;margin-top:1em}.wp-optin-dialog-container .wp-optin-dialog-powered-by{flex-grow:1;align-self:flex-end;font:10px arial;color:#333;opacity:.8;background-position:bottom right;background-repeat:no-repeat;text-decoration:none;margin-right:.5em}.wp-optin-dialog-container .wp-optin-dialog-button{flex-grow:1;border-radius:4px;border:1px solid #d3d3d3;background:#fff;text-decoration:none;font:15px arial;color:#333;text-align:center;display:flex;min-width:5em;padding:.25em .5em}.wp-optin-dialog-container .wp-optin-dialog-button label{cursor:inherit;margin:auto}.wp-optin-dialog-container .wp-optin-dialog-button.wp-optin-dialog-positiveButton{border-color:#46a4f3;color:#fff;background-image:linear-gradient(to bottom,#62b3f4,#0486f6);margin-left:.5em}.wp-optin-dialog-container .wp-optin-dialog-close{position:absolute;top:4px;right:4px;width:10px;height:10px;text-decoration:none;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJCAYAAADgkQYQAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYxIDY0LjE0MDk0OSwgMjAxMC8xMi8wNy0xMDo1NzowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNS4xIE1hY2ludG9zaCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo1MDVDQUVGMDQzOUIxMUU3ODE2N0YyM0EyNDc4QTZCNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo1MDVDQUVGMTQzOUIxMUU3ODE2N0YyM0EyNDc4QTZCNyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjI4NjdCN0UxNDM5QTExRTc4MTY3RjIzQTI0NzhBNkI3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjI4NjdCN0UyNDM5QTExRTc4MTY3RjIzQTI0NzhBNkI3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+JRvgJAAAAEdJREFUeNpiYmBgOAPEDP///8eKYfIMuBQiK8CqEEUBVABFIYYJSDoZsCkAyTGhmQhSYIJsNQNON6C5Eacv0K0+Q8iNAAEGAG9QVX0F8yI2AAAAAElFTkSuQmCC);background-size:cover;background-repeat:no-repeat;background-position:50% 50%}")),document.head.appendChild(e)}();var l,f,h=!1;e.checkTriggers(d,function(){this.showDialog()}.bind(this)),this.hideDialog=function(){f&&l.dispatchEvent(new Event("wonderpush-webplugin-optin-dialog.hide",{bubbles:!0,cancelable:!0}))&&(f(),h=!1,f=void 0,l=void 0)}.bind(this),this.showDialog=function(){var t=this;if(h)e.logDebug("Registration already in progress");else{h=!0;var d="wp-optin-dialog-",g=document.createElement("div");if(g.className=d+"container",a)for(var _ in a)g.style[_]=a[_];f=function(){g.parentNode.removeChild(g)},l=g;var m=document.createElement("div");if(m.className=d+"body",g.appendChild(m),s){var v=document.createElement("div");v.className=d+"icon",v.style.backgroundImage="url("+s+")",m.appendChild(v)}var S=document.createElement("div");if(S.className=d+"text",m.appendChild(S),n){var y=document.createElement("div");y.className=d+"title",y.innerHTML=n,S.appendChild(y)}if(o){var E=document.createElement("div");E.className=d+"message",E.innerHTML=o,S.appendChild(E)}var I=document.createElement("div");if(I.className=d+"buttons",g.appendChild(I),!c){var w=document.createElement("a");w.innerHTML="Powered by WonderPush",w.href="https://www.wonderpush.com/",w.className=d+"powered-by",I.appendChild(w)}var b={positiveButton:{label:r,click:function(n){n.target.dispatchEvent(new Event("wonderpush-webplugin-optin-dialog.positiveButton.click",{bubbles:!0,cancelable:!0}))&&(e.setNotificationEnabled(!0,n),t.hideDialog())}},negativeButton:{label:i,click:function(n){void 0!==u&&!1!==u&&e.snoozeTriggers&&e.snoozeTriggers(u),n.target.dispatchEvent(new Event("wonderpush-webplugin-optin-dialog.negativeButton.click",{bubbles:!0,cancelable:!0}))&&t.hideDialog()}}};["negativeButton","positiveButton"].forEach(function(e){var t=document.createElement("a");t.href="#",t.className=d+"button "+d+e,t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),b[e].click(t)}),I.appendChild(t);var n=document.createElement("label");n.innerHTML=b[e].label,t.appendChild(n)});var P=document.createElement("a");g.appendChild(P),P.href="#",P.className=d+"close",P.addEventListener("click",function(n){n.preventDefault(),n.stopPropagation(),void 0!==p&&!1!==p&&e.snoozeTriggers&&e.snoozeTriggers(p),n.target.dispatchEvent(new Event("wonderpush-webplugin-optin-dialog.closeButton.click",{bubbles:!0,cancelable:!0}))&&t.hideDialog()}),document.body.dispatchEvent(new Event("wonderpush-webplugin-optin-dialog.show",{bubbles:!0,cancelable:!0}))?document.body.appendChild(g):(h=!1,f=void 0,l=void 0)}}.bind(this)})})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){WonderPushSDK._protected.Plugins.preregisterInlinedPlugin("optin-switch","1.0.1",function(){WonderPush.registerPlugin("optin-switch",function(e,t){!function(){var e=document.createElement("style");e.type="text/css",e.appendChild(document.createTextNode(".wp-switch{position:relative;display:inline-block;vertical-align:middle;width:auto;height:auto;padding:.2em;border-radius:1.25em;box-shadow:inset 0 -1px rgba(0,0,0,.05),inset 0 1px 1px rgba(0,0,0,.05);cursor:pointer;background-image:linear-gradient(to bottom,rgba(0,0,0,.2),rgba(255,255,255,.3) 1.5em)}.wp-switch-input{display:none}.wp-switch-label{position:relative;display:block;height:2em;font-size:60%;text-transform:uppercase;background:#eceeef;border-radius:inherit;box-shadow:inset 0 1px 2px rgba(0,0,0,.12),inset 0 0 2px rgba(0,0,0,.15);transition:.15s ease-out;transition-property:opacity,background}.wp-switch-label:after,.wp-switch-label:before{line-height:0;clear:both;transition:inherit;white-space:nowrap;display:inline-block}.wp-switch-label:before{content:attr(data-off);right:1em;color:#aaa;text-shadow:0 1px rgba(255,255,255,.5);float:right;margin-top:1em;margin-right:1em;margin-left:2.5em}.wp-switch-label:after{content:attr(data-on);left:1em;color:#fff;text-shadow:0 1px rgba(0,0,0,.2);opacity:0;float:left;margin-top:0;margin-left:1em;margin-right:2.5em}.wp-switch-input:checked~.wp-switch-label{background:#47a8d8;box-shadow:inset 0 1px 2px rgba(0,0,0,.15),inset 0 0 3px rgba(0,0,0,.2)}.wp-switch-input:checked~.wp-switch-label:before{opacity:0}.wp-switch-input:checked~.wp-switch-label:after{opacity:1}.wp-switch-handle{position:absolute;top:.24em;left:.24em;width:1.125em;height:1.125em;background:#fff;border-radius:100%;box-shadow:1px 1px 5px rgba(0,0,0,.2);background-image:linear-gradient(to bottom,#fff 40%,#f0f0f0);transition:.15s ease-out;transition-property:left,margin-left}.wp-switch-handle:before{content:'';position:absolute;top:0;left:0;margin:.1875em 0 0 .1875em;width:.75em;height:.75em;background:#f9f9f9;border-radius:100%;box-shadow:inset 0 1px rgba(0,0,0,.02);background-image:linear-gradient(to bottom,#eee,#fff)}.wp-switch-input:checked~.wp-switch-handle{left:100%;margin-left:-1.365em;box-shadow:-1px 1px 5px rgba(0,0,0,.2)}.wp-switch-input:disabled~.wp-switch-handle{background-image:linear-gradient(to bottom,silver 40%,grey)}.wp-switch-input:disabled~.wp-switch-handle:before{background:#b0b0b0}.wp-switch-input:disabled~.wp-switch-label{background:silver}.wp-switch-input:disabled~.wp-switch-label:before{color:#eee}.wp-switch-off-gray>.wp-switch-label{background:#eceeef}.wp-switch-off-gray>.wp-switch-label:before{color:#aaa;text-shadow:0 1px rgba(255,255,255,.5)}.wp-switch-off-grey>.wp-switch-label{background:#eceeef}.wp-switch-off-grey>.wp-switch-label:before{color:#aaa;text-shadow:0 1px rgba(255,255,255,.5)}.wp-switch-off-red>.wp-switch-label{background:#ed2121}.wp-switch-off-red>.wp-switch-label:before{color:#fff;text-shadow:0 1px rgba(0,0,0,.2)}.wp-switch-on-green>.wp-switch-input:checked~.wp-switch-label{background:#4fb845;text-shadow:0 1px rgba(0,0,0,.2)}.wp-switch-on-blue>.wp-switch-input:checked~.wp-switch-label{background:#47a8d8;text-shadow:0 1px rgba(0,0,0,.2)}")),document.head.appendChild(e)}();var n=null,o=function(){"loading"!==document.readyState?this.setupSubscriptionSwitch():document.addEventListener("DOMContentLoaded",function(){this.setupSubscriptionSwitch()}.bind(this))}.bind(this);this.setupSubscriptionSwitch=function(){if(!n&&null!==t.switchElementId){var o=t.switchElementId||"wonderpush-subscription-switch",s=document.querySelectorAll("#"+o),c=t.unsupported||"",p=t.classPrefix||"wp-",u=t.prepend||"",d=t.append||"",l=t.sentence||"",f=t.cssClass||"",h=t.on||"ON",g=t.off||"OFF",_=t.colorOn,m=t.colorOff;Array.prototype.slice.call(s).forEach(function(t){if(t&&"true"!==t.dataset.wpInitialized)if(n=t,t.dataset.wpInitialized="true",e.isNativePushNotificationSupported()){var o=t.dataset.classPrefix||p;t.innerHTML=(t.dataset.prepend||u)+'<div class="'+o+'switch-wrapper"></div>'+(t.dataset.append||d);var s=t.querySelector("."+o+"switch-wrapper"),v=document.createElement("SPAN");v.innerHTML=t.dataset.sentence||l;var S=document.createElement("LABEL");S.classList.add(o+"switch"),S.className+=" "+(t.dataset.class||f),(t.dataset.colorOn||_)&&S.classList.add(o+"switch-on-"+(t.dataset.colorOn||_)),(t.dataset.colorOff||m)&&S.classList.add(o+"switch-off-"+(t.dataset.colorOff||m));var y=document.createElement("INPUT");y.id=t.id+"-input",y.type="checkbox",y.classList.add(o+"switch-input"),S.appendChild(y);var E=document.createElement("SPAN");E.classList.add(o+"switch-label"),E.dataset.on=t.dataset.on||h,E.dataset.off=t.dataset.off||g,S.appendChild(E);var I=document.createElement("SPAN");I.classList.add(o+"switch-handle"),S.appendChild(I),s.appendChild(v),s.appendChild(S),y.addEventListener("click",r),window.addEventListener("WonderPushEvent",a(y)),i(y,e.Notification.getSubscriptionState())}else t.innerHTML=t.dataset.unsupported||c})}};var r=function(t){var n=t.target.checked;return t.stopPropagation(),t.preventDefault(),e.setNotificationEnabled(n,t),!1},i=function(t,n){switch(n){case e.SubscriptionState.UNSUPPORTED:t.disabled=!0,t.checked=!1;break;case e.SubscriptionState.UNDETERMINED:case e.SubscriptionState.NOT_SUBSCRIBED:case e.SubscriptionState.UNSUBSCRIBED:t.disabled=!1,t.checked=!1;break;case e.SubscriptionState.SUBSCRIBED:t.disabled=!1,t.checked=!0}},a=function(e){return function(t){var n=(t.originalEvent||t).detail||{};"subscription"===n.name&&i(e,n.state)}};o()})})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){WonderPushSDK._protected.Plugins.preregisterInlinedPlugin("tag-switch","1.0.1",function(){WonderPush.registerPlugin("tag-switch",function(e,t){!function(){var e=document.createElement("style");e.type="text/css",e.appendChild(document.createTextNode(".wp-tag-switch{position:relative;display:inline-block;vertical-align:middle;width:auto;height:auto;padding:.2em;border-radius:1.25em;box-shadow:inset 0 -1px rgba(0,0,0,.05),inset 0 1px 1px rgba(0,0,0,.05);cursor:pointer;background-image:linear-gradient(to bottom,rgba(0,0,0,.2),rgba(255,255,255,.3) 1.5em)}.wp-tag-switch-input{display:none}.wp-tag-switch-label{position:relative;display:block;height:2em;font-size:60%;text-transform:uppercase;background:#eceeef;border-radius:inherit;box-shadow:inset 0 1px 2px rgba(0,0,0,.12),inset 0 0 2px rgba(0,0,0,.15);transition:.15s ease-out;transition-property:opacity,background}.wp-tag-switch-label:after,.wp-tag-switch-label:before{line-height:0;clear:both;transition:inherit;white-space:nowrap;display:inline-block}.wp-tag-switch-label:before{content:attr(data-off);right:1em;color:#aaa;text-shadow:0 1px rgba(255,255,255,.5);float:right;margin-top:1em;margin-right:1em;margin-left:2.5em}.wp-tag-switch-label:after{content:attr(data-on);left:1em;color:#fff;text-shadow:0 1px rgba(0,0,0,.2);opacity:0;float:left;margin-top:0;margin-left:1em;margin-right:2.5em}.wp-tag-switch-input:checked~.wp-tag-switch-label{background:#47a8d8;box-shadow:inset 0 1px 2px rgba(0,0,0,.15),inset 0 0 3px rgba(0,0,0,.2)}.wp-tag-switch-input:checked~.wp-tag-switch-label:before{opacity:0}.wp-tag-switch-input:checked~.wp-tag-switch-label:after{opacity:1}.wp-tag-switch-handle{position:absolute;top:.24em;left:.24em;width:1.125em;height:1.125em;background:#fff;border-radius:100%;box-shadow:1px 1px 5px rgba(0,0,0,.2);background-image:linear-gradient(to bottom,#fff 40%,#f0f0f0);transition:.15s ease-out;transition-property:left,margin-left}.wp-tag-switch-handle:before{content:'';position:absolute;top:0;left:0;margin:.1875em 0 0 .1875em;width:.75em;height:.75em;background:#f9f9f9;border-radius:100%;box-shadow:inset 0 1px rgba(0,0,0,.02);background-image:linear-gradient(to bottom,#eee,#fff)}.wp-tag-switch-input:checked~.wp-tag-switch-handle{left:100%;margin-left:-1.365em;box-shadow:-1px 1px 5px rgba(0,0,0,.2)}.wp-tag-switch-input:disabled~.wp-tag-switch-handle{background-image:linear-gradient(to bottom,silver 40%,grey)}.wp-tag-switch-input:disabled~.wp-tag-switch-handle:before{background:#b0b0b0}.wp-tag-switch-input:disabled~.wp-tag-switch-label{background:silver}.wp-tag-switch-input:disabled~.wp-tag-switch-label:before{color:#eee}.wp-tag-switch-off-gray>.wp-tag-switch-label{background:#eceeef}.wp-tag-switch-off-gray>.wp-tag-switch-label:before{color:#aaa;text-shadow:0 1px rgba(255,255,255,.5)}.wp-tag-switch-off-grey>.wp-tag-switch-label{background:#eceeef}.wp-tag-switch-off-grey>.wp-tag-switch-label:before{color:#aaa;text-shadow:0 1px rgba(255,255,255,.5)}.wp-tag-switch-off-red>.wp-tag-switch-label{background:#ed2121}.wp-tag-switch-off-red>.wp-tag-switch-label:before{color:#fff;text-shadow:0 1px rgba(0,0,0,.2)}.wp-tag-switch-on-green>.wp-tag-switch-input:checked~.wp-tag-switch-label{background:#4fb845;text-shadow:0 1px rgba(0,0,0,.2)}.wp-tag-switch-on-blue>.wp-tag-switch-input:checked~.wp-tag-switch-label{background:#47a8d8;text-shadow:0 1px rgba(0,0,0,.2)}")),document.head.appendChild(e)}();var n=t.switchElementClass||"wonderpush-tag-switch",o=function(){"loading"!==document.readyState?this.setupTagSwitch():document.addEventListener("DOMContentLoaded",function(){this.setupTagSwitch()}.bind(this))}.bind(this),r=function(e){return void 0===e||null===e?[]:Array.isArray(e)?e:[e]};this.setupTagSwitch=function(){if(null!==t.switchElementClass){e.getInstallationCustomProperties();var o=document.querySelectorAll("."+n),a=t.unsupported||"",s=t.classPrefix||"wp-tag-",c=t.prepend||"",p=t.append||"",u=t.sentence||"",d=t.cssClass||"",l=t.label,f=t.on||l||"ON",h=t.off||l||"OFF",g=t.colorOn,_=t.colorOff;return e.getInstallationCustomProperties().then(function(t){Array.prototype.slice.call(o).forEach(function(n){if(n&&"true"!==n.dataset.wpInitialized)if(n.dataset.wpInitialized="true",e.isNativePushNotificationSupported())if(n.dataset.field&&n.dataset.value){var o=n.dataset.classPrefix||s;n.innerHTML=(n.dataset.prepend||c)+'<div class="'+o+'switch-wrapper"></div>'+(n.dataset.append||p);var m=n.querySelector("."+o+"switch-wrapper"),v=document.createElement("SPAN");v.innerHTML=n.dataset.sentence||u;var S=document.createElement("LABEL");S.classList.add(o+"switch"),S.className+=" "+(n.dataset.class||d),(n.dataset.colorOn||g)&&S.classList.add(o+"switch-on-"+(n.dataset.colorOn||g)),(n.dataset.colorOff||_)&&S.classList.add(o+"switch-off-"+(n.dataset.colorOff||_));var y=document.createElement("INPUT");y.id=n.id+"-input",y.type="checkbox",y.classList.add(o+"switch-input"),S.appendChild(y);var E=document.createElement("SPAN");E.classList.add(o+"switch-label"),E.dataset.on=n.dataset.label||n.dataset.on||l||f,E.dataset.off=n.dataset.label||n.dataset.off||l||h,S.appendChild(E);var I=document.createElement("SPAN");I.classList.add(o+"switch-handle"),S.appendChild(I),y.addEventListener("click",i),y.disabled=!e.isNativePushNotificationSupported();var w=r(t[n.dataset.field]);y.checked=w.indexOf(n.dataset.value)>=0,m.appendChild(v),m.appendChild(S)}else e.logWarn("Missing field or value data attribute for",n);else n.innerHTML=n.dataset.unsupported||a})})}};var i=function(t){var o=t.target.closest("."+n),i=t.target.checked;i&&e.setNotificationEnabled(i,t),e.getInstallationCustomProperties().then(function(t){var n=r(t[o.dataset.field]),a={};if(i)n.indexOf(o.dataset.value)<0&&(n.push(o.dataset.value),a[o.dataset.field]=n);else for(;n.indexOf(o.dataset.value)>=0;)n.splice(n.indexOf(o.dataset.value),1),a[o.dataset.field]=n;Object.keys(a).length&&e.putInstallationCustomProperties(a)})};o()})})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(WonderPushSDK){WonderPushSDK.prototype.Developer=new function(){this.invalidateConfig=function(){return Promise.all([WonderPushSDK._protected.Config.invalidateConfig(),WonderPushSDK._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Config.invalidateConfig",[])]).then(function(){},function(e){throw WonderPushSDK._protected.Helper.warn("[developer   ]","Failed to invalidate config",e),new WonderPushSDK.prototype.Errors.InternalError("Failed to invalidate config")})}}}}.apply(t,[]))||(e.exports=o)}]);